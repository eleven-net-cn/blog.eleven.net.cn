<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>ImageTools æŒ‡å—</title>
      <link href="/2025/08/26/vite/imagetools/"/>
      <url>/2025/08/26/vite/imagetools/</url>
      
        <content type="html"><![CDATA[<blockquote><p>åŸºäº <a href="https://github.com/JonasKruckenberg/imagetools">vite-imagetools</a> çš„å›¾ç‰‡ä¼˜åŒ–è§£å†³æ–¹æ¡ˆï¼Œå®˜æ–¹çš„æ–‡æ¡£å¤ªè¿‡äºç®€å•ï¼Œå› æ­¤ï¼Œå€ŸåŠ© AI æ•´ç†äº†å®Œæ•´æœ‰æ•ˆçš„ä½¿ç”¨æŒ‡å—ã€‚</p><p>å½“å‰æ–‡æ¡£é€‚ç”¨ç‰ˆæœ¬ vite-imagetools 6.2.9</p></blockquote><h2 id="ğŸ“–-ç®€ä»‹"><a href="#ğŸ“–-ç®€ä»‹" class="headerlink" title="ğŸ“– ç®€ä»‹"></a>ğŸ“– ç®€ä»‹</h2><p>ImageTools æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ Vite æ’ä»¶ï¼Œä¸“é—¨è´Ÿè´£é‡è¦å›¾ç‰‡çš„æ ¼å¼è½¬æ¢ï¼ˆPNG/JPG â†’ WebP/AVIFï¼‰ï¼Œé€šè¿‡æŸ¥è¯¢å‚æ•°çš„æ–¹å¼åœ¨æ„å»ºæ—¶å¯¹å›¾ç‰‡è¿›è¡Œä¼˜åŒ–å¤„ç†ã€‚</p><p><strong>âš ï¸ é‡è¦æé†’</strong>ï¼šå›¾ç‰‡å¿…é¡»é€šè¿‡ <code>import</code> å¯¼å…¥ï¼Œæ‰èƒ½è®© imagetools æ’ä»¶å·¥ä½œç”Ÿæ•ˆã€‚</p><h2 id="âš™ï¸-æ’ä»¶é…ç½®å‚æ•°"><a href="#âš™ï¸-æ’ä»¶é…ç½®å‚æ•°" class="headerlink" title="âš™ï¸ æ’ä»¶é…ç½®å‚æ•°"></a>âš™ï¸ æ’ä»¶é…ç½®å‚æ•°</h2><h3 id="include-æ–‡ä»¶åŒ…å«è§„åˆ™"><a href="#include-æ–‡ä»¶åŒ…å«è§„åˆ™" class="headerlink" title="include - æ–‡ä»¶åŒ…å«è§„åˆ™"></a><code>include</code> - æ–‡ä»¶åŒ…å«è§„åˆ™</h3><p><strong>ä½œç”¨</strong>ï¼šå†³å®šå“ªäº›æ–‡ä»¶ä¼šè¢« imagetools æ’ä»¶å¤„ç†<br><strong>ç±»å‹</strong>ï¼š<code>string | RegExp | Array&lt;string | RegExp&gt;</code><br><strong>é»˜è®¤å€¼</strong>ï¼š<code>&#39;**/*.(heif,avif,jpeg,jpg,png,tiff,webp,gif)?*&#39;</code></p><pre><code class="typescript">imagetools(&#123;  // åªå¤„ç† assets ç›®å½•ä¸‹çš„å›¾ç‰‡  include: &#39;src/assets/**/*.&#123;jpg,jpeg,png,webp&#125;&#39;,  // æˆ–ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼  include: /^.*\.(jpg|jpeg|png|webp)$/,  // æˆ–ä½¿ç”¨æ•°ç»„å¤„ç†å¤šä¸ªè§„åˆ™  include: [&#39;src/assets/**/*.&#123;jpg,jpeg,png&#125;&#39;, &#39;src/images/**/*.webp&#39;],&#125;)</code></pre><p><strong>ç¼–è¯‘ç»“æœå½±å“</strong>ï¼š</p><ul><li>âœ… åŒ¹é…çš„æ–‡ä»¶ï¼šä¼šè¢« imagetools å¤„ç†ï¼Œæ”¯æŒæŸ¥è¯¢å‚æ•°</li><li>âŒ ä¸åŒ¹é…çš„æ–‡ä»¶ï¼šç›´æ¥å¤åˆ¶åˆ° distï¼Œä¸æ”¯æŒæŸ¥è¯¢å‚æ•°</li></ul><h3 id="exclude-æ–‡ä»¶æ’é™¤è§„åˆ™"><a href="#exclude-æ–‡ä»¶æ’é™¤è§„åˆ™" class="headerlink" title="exclude - æ–‡ä»¶æ’é™¤è§„åˆ™"></a><code>exclude</code> - æ–‡ä»¶æ’é™¤è§„åˆ™</h3><p><strong>ä½œç”¨</strong>ï¼šæŒ‡å®šå“ªäº›æ–‡ä»¶ä¸è¢« imagetools å¤„ç†ï¼Œå³ä½¿åŒ¹é…äº† include<br><strong>ç±»å‹</strong>ï¼š<code>string | RegExp | Array&lt;string | RegExp&gt;</code><br><strong>é»˜è®¤å€¼</strong>ï¼š<code>&#39;public/**/*&#39;</code></p><pre><code class="typescript">imagetools(&#123;  exclude: [    &#39;public/**/*&#39;, // æ’é™¤ public ç›®å½•    &#39;src/assets/icons/**/*&#39;, // æ’é™¤å›¾æ ‡ç›®å½•    /.*\.svg$/, // æ’é™¤æ‰€æœ‰ SVG æ–‡ä»¶  ],&#125;)</code></pre><p><strong>ç¼–è¯‘ç»“æœå½±å“</strong>ï¼š</p><ul><li>è¢«æ’é™¤çš„æ–‡ä»¶ä¸ä¼šè¢«å¤„ç†ï¼Œå³ä½¿è·¯å¾„åŒ¹é… <code>include</code> è§„åˆ™</li><li>è¿™äº›æ–‡ä»¶ä¼šæŒ‰ç…§ Vite çš„é»˜è®¤è§„åˆ™å¤„ç†</li></ul><h3 id="defaultDirectives-é»˜è®¤å¤„ç†æŒ‡ä»¤"><a href="#defaultDirectives-é»˜è®¤å¤„ç†æŒ‡ä»¤" class="headerlink" title="defaultDirectives - é»˜è®¤å¤„ç†æŒ‡ä»¤"></a><code>defaultDirectives</code> - é»˜è®¤å¤„ç†æŒ‡ä»¤</h3><p><strong>ä½œç”¨</strong>ï¼šä¸ºæ‰€æœ‰å›¾ç‰‡è®¾ç½®é»˜è®¤çš„å¤„ç†å‚æ•°<br><strong>ç±»å‹</strong>ï¼š<code>URLSearchParams | ((url: URL, metadata: () =&gt; Promise&lt;Metadata&gt;) =&gt; URLSearchParams)</code></p><h4 id="é™æ€é…ç½®æ–¹å¼ï¼š"><a href="#é™æ€é…ç½®æ–¹å¼ï¼š" class="headerlink" title="é™æ€é…ç½®æ–¹å¼ï¼š"></a>é™æ€é…ç½®æ–¹å¼ï¼š</h4><pre><code class="typescript">imagetools(&#123;  defaultDirectives: new URLSearchParams(&#123;    format: &#39;webp&#39;, // é»˜è®¤è½¬æ¢ä¸º WebP    quality: &#39;85&#39;, // é»˜è®¤è´¨é‡ 85%    progressive: &#39;true&#39;, // é»˜è®¤å¯ç”¨æ¸è¿›å¼åŠ è½½  &#125;),&#125;)</code></pre><h4 id="åŠ¨æ€é…ç½®æ–¹å¼ï¼š"><a href="#åŠ¨æ€é…ç½®æ–¹å¼ï¼š" class="headerlink" title="åŠ¨æ€é…ç½®æ–¹å¼ï¼š"></a>åŠ¨æ€é…ç½®æ–¹å¼ï¼š</h4><pre><code class="typescript">imagetools(&#123;  defaultDirectives: (url, metadata) =&gt; &#123;    const params = new URLSearchParams()    // æ ¹æ®æ–‡ä»¶è·¯å¾„è®¾ç½®ä¸åŒé»˜è®¤å€¼    if (url.pathname.includes(&#39;/hero/&#39;)) &#123;      params.set(&#39;format&#39;, &#39;webp&#39;)      params.set(&#39;quality&#39;, &#39;90&#39;)      params.set(&#39;w&#39;, &#39;1920&#39;)    &#125; else if (url.pathname.includes(&#39;/thumb/&#39;)) &#123;      params.set(&#39;format&#39;, &#39;webp&#39;)      params.set(&#39;quality&#39;, &#39;75&#39;)      params.set(&#39;w&#39;, &#39;300&#39;)      params.set(&#39;h&#39;, &#39;300&#39;)      params.set(&#39;fit&#39;, &#39;cover&#39;)    &#125; else &#123;      params.set(&#39;format&#39;, &#39;webp&#39;)      params.set(&#39;quality&#39;, &#39;85&#39;)    &#125;    return params  &#125;,&#125;)</code></pre><p><strong>ç¼–è¯‘ç»“æœå½±å“</strong>ï¼š</p><ul><li>é»˜è®¤æŒ‡ä»¤ä¼šä¸æŸ¥è¯¢å‚æ•°åˆå¹¶ï¼ŒæŸ¥è¯¢å‚æ•°ä¼˜å…ˆçº§æ›´é«˜</li><li>å¦‚æœæ²¡æœ‰æŸ¥è¯¢å‚æ•°ï¼Œä¼šä½¿ç”¨é»˜è®¤æŒ‡ä»¤å¤„ç†</li></ul><h3 id="removeMetadata-ç§»é™¤å…ƒæ•°æ®"><a href="#removeMetadata-ç§»é™¤å…ƒæ•°æ®" class="headerlink" title="removeMetadata - ç§»é™¤å…ƒæ•°æ®"></a><code>removeMetadata</code> - ç§»é™¤å…ƒæ•°æ®</h3><p><strong>ä½œç”¨</strong>ï¼šæ˜¯å¦ç§»é™¤å›¾ç‰‡çš„ EXIFã€GPSã€ä½œè€…ç­‰éšç§ä¿¡æ¯<br><strong>ç±»å‹</strong>ï¼š<code>boolean</code><br><strong>é»˜è®¤å€¼</strong>ï¼š<code>true</code></p><pre><code class="typescript">imagetools(&#123;  removeMetadata: true, // ç§»é™¤å…ƒæ•°æ®ï¼Œå‡å°æ–‡ä»¶å¤§å°&#125;)</code></pre><p><strong>ç¼–è¯‘ç»“æœå½±å“</strong>ï¼š</p><ul><li><code>true</code>ï¼šç§»é™¤æ‰€æœ‰å…ƒæ•°æ®ï¼Œæ–‡ä»¶æ›´å°ï¼Œä¿æŠ¤éšç§</li><li><code>false</code>ï¼šä¿ç•™å…ƒæ•°æ®ï¼Œæ–‡ä»¶ç¨å¤§ï¼Œä¿ç•™åŸå§‹ä¿¡æ¯</li></ul><h3 id="namedExports-å‘½åå¯¼å‡º"><a href="#namedExports-å‘½åå¯¼å‡º" class="headerlink" title="namedExports - å‘½åå¯¼å‡º"></a><code>namedExports</code> - å‘½åå¯¼å‡º</h3><p><strong>ä½œç”¨</strong>ï¼šæ˜¯å¦ç”Ÿæˆå‘½åå¯¼å‡ºï¼ˆå¦‚ srcsetã€metadataï¼‰<br><strong>ç±»å‹</strong>ï¼š<code>boolean</code><br><strong>é»˜è®¤å€¼</strong>ï¼š<code>undefined</code></p><pre><code class="typescript">imagetools(&#123;  namedExports: true,&#125;)</code></pre><p><strong>ç¼–è¯‘ç»“æœå½±å“</strong>ï¼š</p><pre><code class="typescript">// namedExports: true æ—¶import img, &#123; srcset, metadata &#125; from &#39;./pic.jpg?w=400;800&amp;as=srcset&#39;// namedExports: false æ—¶import img from &#39;./pic.jpg?w=400;800&amp;as=srcset&#39; // åªæœ‰é»˜è®¤å¯¼å‡º</code></pre><h2 id="ğŸ¯-æŸ¥è¯¢å‚æ•°è¯¦è§£"><a href="#ğŸ¯-æŸ¥è¯¢å‚æ•°è¯¦è§£" class="headerlink" title="ğŸ¯ æŸ¥è¯¢å‚æ•°è¯¦è§£"></a>ğŸ¯ æŸ¥è¯¢å‚æ•°è¯¦è§£</h2><h3 id="å°ºå¯¸æ§åˆ¶å‚æ•°"><a href="#å°ºå¯¸æ§åˆ¶å‚æ•°" class="headerlink" title="å°ºå¯¸æ§åˆ¶å‚æ•°"></a>å°ºå¯¸æ§åˆ¶å‚æ•°</h3><h4 id="w-å®½åº¦è®¾ç½®"><a href="#w-å®½åº¦è®¾ç½®" class="headerlink" title="w - å®½åº¦è®¾ç½®"></a><code>w</code> - å®½åº¦è®¾ç½®</h4><p><strong>ä½œç”¨</strong>ï¼šè®¾ç½®è¾“å‡ºå›¾ç‰‡çš„å®½åº¦ï¼ˆåƒç´ ï¼‰</p><pre><code class="typescript">// å•ä¸€å®½åº¦import img from &#39;./pic.jpg?w=400&#39;// ç¼–è¯‘ç»“æœï¼šç”Ÿæˆ 400px å®½çš„å›¾ç‰‡// å¤šä¸ªå®½åº¦ï¼ˆå“åº”å¼ï¼‰import img from &#39;./pic.jpg?w=400;800;1200&#39;// ç¼–è¯‘ç»“æœï¼šç”Ÿæˆ 3 ä¸ªä¸åŒå®½åº¦çš„å›¾ç‰‡æ–‡ä»¶</code></pre><h4 id="h-é«˜åº¦è®¾ç½®"><a href="#h-é«˜åº¦è®¾ç½®" class="headerlink" title="h - é«˜åº¦è®¾ç½®"></a><code>h</code> - é«˜åº¦è®¾ç½®</h4><p><strong>ä½œç”¨</strong>ï¼šè®¾ç½®è¾“å‡ºå›¾ç‰‡çš„é«˜åº¦ï¼ˆåƒç´ ï¼‰</p><pre><code class="typescript">import img from &#39;./pic.jpg?h=300&#39;// ç¼–è¯‘ç»“æœï¼šç”Ÿæˆ 300px é«˜çš„å›¾ç‰‡ï¼Œå®½åº¦æŒ‰æ¯”ä¾‹ç¼©æ”¾import img from &#39;./pic.jpg?w=400&amp;h=300&#39;// ç¼–è¯‘ç»“æœï¼šç”Ÿæˆ 400x300 çš„å›¾ç‰‡ï¼Œå¯èƒ½ä¼šè£å‰ª</code></pre><h4 id="aspect-å®½é«˜æ¯”"><a href="#aspect-å®½é«˜æ¯”" class="headerlink" title="aspect - å®½é«˜æ¯”"></a><code>aspect</code> - å®½é«˜æ¯”</h4><p><strong>ä½œç”¨</strong>ï¼šå¼ºåˆ¶è®¾ç½®å›¾ç‰‡çš„å®½é«˜æ¯”<br><strong>æ ¼å¼</strong>ï¼š<code>16:9</code>ã€<code>4:3</code>ã€<code>1:1</code> ç­‰</p><pre><code class="typescript">import img from &#39;./pic.jpg?w=400&amp;aspect=16:9&#39;// ç¼–è¯‘ç»“æœï¼šç”Ÿæˆ 400x225 çš„å›¾ç‰‡ï¼ˆ16:9 æ¯”ä¾‹ï¼‰</code></pre><h4 id="fit-é€‚é…æ¨¡å¼"><a href="#fit-é€‚é…æ¨¡å¼" class="headerlink" title="fit - é€‚é…æ¨¡å¼"></a><code>fit</code> - é€‚é…æ¨¡å¼</h4><p><strong>ä½œç”¨</strong>ï¼šå½“æŒ‡å®šäº†å®½åº¦å’Œé«˜åº¦æ—¶ï¼Œå†³å®šå¦‚ä½•å¤„ç†å›¾ç‰‡ä»¥é€‚åº”ç›®æ ‡å°ºå¯¸</p><pre><code class="typescript">// coverï¼šè£å‰ªå¡«æ»¡ï¼ˆé»˜è®¤ï¼‰import cover from &#39;./pic.jpg?w=400&amp;h=300&amp;fit=cover&#39;// ç¼–è¯‘ç»“æœï¼š400x300ï¼Œå¯èƒ½è£å‰ªå›¾ç‰‡è¾¹ç¼˜// containï¼šå®Œæ•´æ˜¾ç¤ºimport contain from &#39;./pic.jpg?w=400&amp;h=300&amp;fit=contain&#39;// ç¼–è¯‘ç»“æœï¼šå›¾ç‰‡å®Œæ•´æ˜¾ç¤ºåœ¨ 400x300 åŒºåŸŸå†…ï¼Œå¯èƒ½æœ‰ç©ºç™½// fillï¼šæ‹‰ä¼¸å¡«æ»¡import fill from &#39;./pic.jpg?w=400&amp;h=300&amp;fit=fill&#39;// ç¼–è¯‘ç»“æœï¼šå¼ºåˆ¶æ‹‰ä¼¸åˆ° 400x300ï¼Œå¯èƒ½å˜å½¢// insideï¼šç¼©å°åˆ°åŒºåŸŸå†…import inside from &#39;./pic.jpg?w=400&amp;h=300&amp;fit=inside&#39;// ç¼–è¯‘ç»“æœï¼šåªç¼©å°ï¼Œä¸æ”¾å¤§// outsideï¼šæ”¾å¤§åˆ°è¦†ç›–åŒºåŸŸimport outside from &#39;./pic.jpg?w=400&amp;h=300&amp;fit=outside&#39;// ç¼–è¯‘ç»“æœï¼šæ”¾å¤§åˆ°å®Œå…¨è¦†ç›–åŒºåŸŸ</code></pre><h4 id="position-è£å‰ªä½ç½®"><a href="#position-è£å‰ªä½ç½®" class="headerlink" title="position - è£å‰ªä½ç½®"></a><code>position</code> - è£å‰ªä½ç½®</h4><p><strong>ä½œç”¨</strong>ï¼šå½“ä½¿ç”¨ <code>fit=cover</code> æ—¶ï¼ŒæŒ‡å®šä»å›¾ç‰‡çš„å“ªä¸ªéƒ¨åˆ†å¼€å§‹è£å‰ª</p><pre><code class="typescript">import img from &#39;./pic.jpg?w=400&amp;h=300&amp;fit=cover&amp;position=top&#39;// ç¼–è¯‘ç»“æœï¼šä»å›¾ç‰‡é¡¶éƒ¨å¼€å§‹è£å‰ª// å¯é€‰å€¼ï¼štop, right, bottom, left, center// ä¹Ÿå¯ä»¥ç»„åˆï¼štop left, bottom right ç­‰</code></pre><h3 id="æ ¼å¼è½¬æ¢å‚æ•°"><a href="#æ ¼å¼è½¬æ¢å‚æ•°" class="headerlink" title="æ ¼å¼è½¬æ¢å‚æ•°"></a>æ ¼å¼è½¬æ¢å‚æ•°</h3><h4 id="format-è¾“å‡ºæ ¼å¼"><a href="#format-è¾“å‡ºæ ¼å¼" class="headerlink" title="format - è¾“å‡ºæ ¼å¼"></a><code>format</code> - è¾“å‡ºæ ¼å¼</h4><p><strong>ä½œç”¨</strong>ï¼šè½¬æ¢å›¾ç‰‡æ ¼å¼<br><strong>æ”¯æŒæ ¼å¼</strong>ï¼š<code>webp</code>ã€<code>avif</code>ã€<code>jpeg</code>ã€<code>jpg</code>ã€<code>png</code>ã€<code>tiff</code>ã€<code>gif</code>ã€<code>heif</code></p><pre><code class="typescript">// å•ä¸€æ ¼å¼import webp from &#39;./pic.jpg?format=webp&#39;// ç¼–è¯‘ç»“æœï¼šç”Ÿæˆ .webp æ–‡ä»¶// å¤šæ ¼å¼è¾“å‡ºimport multi from &#39;./pic.jpg?format=webp;avif;jpg&#39;// ç¼–è¯‘ç»“æœï¼šç”Ÿæˆ 3 ä¸ªä¸åŒæ ¼å¼çš„æ–‡ä»¶</code></pre><h4 id="quality-å›¾ç‰‡è´¨é‡"><a href="#quality-å›¾ç‰‡è´¨é‡" class="headerlink" title="quality - å›¾ç‰‡è´¨é‡"></a><code>quality</code> - å›¾ç‰‡è´¨é‡</h4><p><strong>ä½œç”¨</strong>ï¼šè®¾ç½®æœ‰æŸå‹ç¼©çš„è´¨é‡<br><strong>èŒƒå›´</strong>ï¼š0-100<br><strong>é€‚ç”¨æ ¼å¼</strong>ï¼šJPEGã€WebPï¼ˆæœ‰æŸæ¨¡å¼ï¼‰ã€AVIF</p><pre><code class="typescript">import high from &#39;./pic.jpg?format=webp&amp;quality=95&#39;// ç¼–è¯‘ç»“æœï¼šé«˜è´¨é‡ WebPï¼ˆæ–‡ä»¶è¾ƒå¤§ï¼‰import low from &#39;./pic.jpg?format=webp&amp;quality=60&#39;// ç¼–è¯‘ç»“æœï¼šä½è´¨é‡ WebPï¼ˆæ–‡ä»¶è¾ƒå°ï¼‰</code></pre><p><strong>æ¨èè´¨é‡è®¾ç½®</strong>ï¼š</p><ul><li><strong>WebP</strong>: <code>quality=85</code> æ˜¯è§†è§‰æ— æŸçš„æœ€ä½³å¹³è¡¡ç‚¹</li><li><strong>AVIF</strong>: <code>quality=80</code> æä¾›æ›´å¥½çš„å‹ç¼©ç‡</li></ul><h4 id="progressive-æ¸è¿›å¼åŠ è½½"><a href="#progressive-æ¸è¿›å¼åŠ è½½" class="headerlink" title="progressive - æ¸è¿›å¼åŠ è½½"></a><code>progressive</code> - æ¸è¿›å¼åŠ è½½</h4><p><strong>ä½œç”¨</strong>ï¼šç”Ÿæˆæ”¯æŒæ¸è¿›å¼åŠ è½½çš„å›¾ç‰‡<br><strong>æ”¯æŒæ ¼å¼</strong>ï¼šåªæœ‰ JPEG</p><pre><code class="typescript">import prog from &#39;./pic.jpg?format=jpeg&amp;progressive=true&#39;// ç¼–è¯‘ç»“æœï¼šç”Ÿæˆæ¸è¿›å¼ JPEGï¼Œæ”¯æŒé€æ­¥åŠ è½½æ˜¾ç¤º</code></pre><h4 id="lossless-æ— æŸå‹ç¼©"><a href="#lossless-æ— æŸå‹ç¼©" class="headerlink" title="lossless - æ— æŸå‹ç¼©"></a><code>lossless</code> - æ— æŸå‹ç¼©</h4><p><strong>ä½œç”¨</strong>ï¼šå¯¹æ”¯æŒçš„æ ¼å¼ä½¿ç”¨æ— æŸå‹ç¼©<br><strong>æ”¯æŒæ ¼å¼</strong>ï¼šWebPã€PNG</p><pre><code class="typescript">import lossless from &#39;./pic.png?format=webp&amp;lossless=true&#39;// ç¼–è¯‘ç»“æœï¼šç”Ÿæˆæ— æŸ WebPï¼Œè´¨é‡å®Œç¾ä½†æ–‡ä»¶è¾ƒå¤§</code></pre><h3 id="è§†è§‰æ•ˆæœå‚æ•°"><a href="#è§†è§‰æ•ˆæœå‚æ•°" class="headerlink" title="è§†è§‰æ•ˆæœå‚æ•°"></a>è§†è§‰æ•ˆæœå‚æ•°</h3><h4 id="blur-æ¨¡ç³Šæ•ˆæœ"><a href="#blur-æ¨¡ç³Šæ•ˆæœ" class="headerlink" title="blur - æ¨¡ç³Šæ•ˆæœ"></a><code>blur</code> - æ¨¡ç³Šæ•ˆæœ</h4><p><strong>ä½œç”¨</strong>ï¼šåº”ç”¨é«˜æ–¯æ¨¡ç³Š<br><strong>èŒƒå›´</strong>ï¼š0.3-1000ï¼ˆå®é™…å¸¸ç”¨ 1-20ï¼‰</p><pre><code class="typescript">import blurred from &#39;./pic.jpg?blur=5&#39;// ç¼–è¯‘ç»“æœï¼šåº”ç”¨ 5px åŠå¾„çš„é«˜æ–¯æ¨¡ç³Š// å¸¸ç”¨å€¼ï¼š1-10ï¼Œæ•°å€¼è¶Šå¤§è¶Šæ¨¡ç³Š</code></pre><h4 id="grayscale-ç°åº¦è½¬æ¢"><a href="#grayscale-ç°åº¦è½¬æ¢" class="headerlink" title="grayscale - ç°åº¦è½¬æ¢"></a><code>grayscale</code> - ç°åº¦è½¬æ¢</h4><p><strong>ä½œç”¨</strong>ï¼šè½¬æ¢ä¸ºç°åº¦å›¾ç‰‡</p><pre><code class="typescript">import gray from &#39;./pic.jpg?grayscale=true&#39;// ç¼–è¯‘ç»“æœï¼šè½¬æ¢ä¸ºç°åº¦å›¾ç‰‡</code></pre><h4 id="invert-é¢œè‰²åè½¬"><a href="#invert-é¢œè‰²åè½¬" class="headerlink" title="invert - é¢œè‰²åè½¬"></a><code>invert</code> - é¢œè‰²åè½¬</h4><p><strong>ä½œç”¨</strong>ï¼šåè½¬æ‰€æœ‰é¢œè‰²ï¼ˆç±»ä¼¼åº•ç‰‡æ•ˆæœï¼‰</p><pre><code class="typescript">import inverted from &#39;./pic.jpg?invert=true&#39;// ç¼–è¯‘ç»“æœï¼šåè½¬æ‰€æœ‰é¢œè‰²</code></pre><h4 id="tint-è‰²è°ƒè°ƒæ•´"><a href="#tint-è‰²è°ƒè°ƒæ•´" class="headerlink" title="tint - è‰²è°ƒè°ƒæ•´"></a><code>tint</code> - è‰²è°ƒè°ƒæ•´</h4><p><strong>ä½œç”¨</strong>ï¼šç»™å›¾ç‰‡æ·»åŠ é¢œè‰²è‰²è°ƒ<br><strong>æ ¼å¼</strong>ï¼šåå…­è¿›åˆ¶é¢œè‰²å€¼ï¼ˆä¸éœ€è¦ # å‰ç¼€ï¼‰</p><pre><code class="typescript">import tinted from &#39;./pic.jpg?tint=ff0000&#39;// ç¼–è¯‘ç»“æœï¼šæ·»åŠ çº¢è‰²è‰²è°ƒ// ä½¿ç”¨åå…­è¿›åˆ¶é¢œè‰²å€¼ï¼Œä¸éœ€è¦ # å‰ç¼€</code></pre><h4 id="rotate-æ—‹è½¬"><a href="#rotate-æ—‹è½¬" class="headerlink" title="rotate - æ—‹è½¬"></a><code>rotate</code> - æ—‹è½¬</h4><p><strong>ä½œç”¨</strong>ï¼šæ—‹è½¬å›¾ç‰‡<br><strong>èŒƒå›´</strong>ï¼šä»»æ„è§’åº¦</p><pre><code class="typescript">import rotated from &#39;./pic.jpg?rotate=90&#39;// ç¼–è¯‘ç»“æœï¼šé¡ºæ—¶é’ˆæ—‹è½¬ 90 åº¦// æ”¯æŒä»»æ„è§’åº¦ï¼Œè´Ÿæ•°è¡¨ç¤ºé€†æ—¶é’ˆ</code></pre><h4 id="flip-flop-ç¿»è½¬"><a href="#flip-flop-ç¿»è½¬" class="headerlink" title="flip / flop - ç¿»è½¬"></a><code>flip</code> / <code>flop</code> - ç¿»è½¬</h4><p><strong>ä½œç”¨</strong>ï¼šç¿»è½¬å›¾ç‰‡</p><pre><code class="typescript">import flipped from &#39;./pic.jpg?flip=true&#39;// ç¼–è¯‘ç»“æœï¼šæ°´å¹³ç¿»è½¬ï¼ˆå·¦å³ç¿»è½¬ï¼‰import flopped from &#39;./pic.jpg?flop=true&#39;// ç¼–è¯‘ç»“æœï¼šå‚ç›´ç¿»è½¬ï¼ˆä¸Šä¸‹ç¿»è½¬ï¼‰</code></pre><h3 id="é«˜çº§å‚æ•°"><a href="#é«˜çº§å‚æ•°" class="headerlink" title="é«˜çº§å‚æ•°"></a>é«˜çº§å‚æ•°</h3><h4 id="background-èƒŒæ™¯è‰²"><a href="#background-èƒŒæ™¯è‰²" class="headerlink" title="background - èƒŒæ™¯è‰²"></a><code>background</code> - èƒŒæ™¯è‰²</h4><p><strong>ä½œç”¨</strong>ï¼šä¸ºé€æ˜åŒºåŸŸæˆ–ç©ºç™½åŒºåŸŸè®¾ç½®èƒŒæ™¯è‰²</p><pre><code class="typescript">import withBg from &#39;./pic.png?w=400&amp;h=300&amp;fit=contain&amp;background=ffffff&#39;// ç¼–è¯‘ç»“æœï¼šé€æ˜åŒºåŸŸæˆ–ç©ºç™½åŒºåŸŸå¡«å……ç™½è‰²// ç”¨äº PNG è½¬ JPEG æ—¶ç§»é™¤é€æ˜åº¦</code></pre><h4 id="flatten-å›¾å±‚åˆå¹¶"><a href="#flatten-å›¾å±‚åˆå¹¶" class="headerlink" title="flatten - å›¾å±‚åˆå¹¶"></a><code>flatten</code> - å›¾å±‚åˆå¹¶</h4><p><strong>ä½œç”¨</strong>ï¼šå°†é€æ˜å›¾å±‚åˆå¹¶åˆ°èƒŒæ™¯ä¸Š</p><pre><code class="typescript">import flattened from &#39;./pic.png?flatten=true&amp;background=ffffff&#39;// ç¼–è¯‘ç»“æœï¼šå°†é€æ˜å›¾å±‚åˆå¹¶åˆ°ç™½è‰²èƒŒæ™¯ä¸Š</code></pre><h4 id="normalize-å½’ä¸€åŒ–"><a href="#normalize-å½’ä¸€åŒ–" class="headerlink" title="normalize - å½’ä¸€åŒ–"></a><code>normalize</code> - å½’ä¸€åŒ–</h4><p><strong>ä½œç”¨</strong>ï¼šå¢å¼ºå›¾ç‰‡å¯¹æ¯”åº¦</p><pre><code class="typescript">import normalized from &#39;./pic.jpg?normalize=true&#39;// ç¼–è¯‘ç»“æœï¼šå¢å¼ºå›¾ç‰‡å¯¹æ¯”åº¦ï¼Œæ‹‰ä¼¸äº®åº¦åˆ†å¸ƒ</code></pre><h4 id="median-ä¸­å€¼æ»¤æ³¢"><a href="#median-ä¸­å€¼æ»¤æ³¢" class="headerlink" title="median - ä¸­å€¼æ»¤æ³¢"></a><code>median</code> - ä¸­å€¼æ»¤æ³¢</h4><p><strong>ä½œç”¨</strong>ï¼šå»é™¤å›¾ç‰‡å™ªç‚¹</p><pre><code class="typescript">import filtered from &#39;./pic.jpg?median=3&#39;// ç¼–è¯‘ç»“æœï¼šåº”ç”¨ 3x3 ä¸­å€¼æ»¤æ³¢ï¼Œå»é™¤å™ªç‚¹</code></pre><h2 id="ğŸ“¤-è¾“å‡ºæ ¼å¼è¯¦è§£"><a href="#ğŸ“¤-è¾“å‡ºæ ¼å¼è¯¦è§£" class="headerlink" title="ğŸ“¤ è¾“å‡ºæ ¼å¼è¯¦è§£"></a>ğŸ“¤ è¾“å‡ºæ ¼å¼è¯¦è§£</h2><h3 id="é»˜è®¤è¾“å‡ºï¼ˆURL-å­—ç¬¦ä¸²ï¼‰"><a href="#é»˜è®¤è¾“å‡ºï¼ˆURL-å­—ç¬¦ä¸²ï¼‰" class="headerlink" title="é»˜è®¤è¾“å‡ºï¼ˆURL å­—ç¬¦ä¸²ï¼‰"></a>é»˜è®¤è¾“å‡ºï¼ˆURL å­—ç¬¦ä¸²ï¼‰</h3><pre><code class="typescript">import img from &#39;./pic.jpg?w=400&amp;format=webp&#39;// ç±»å‹ï¼šstring// å€¼ï¼š&quot;/assets/pic.hash.webp&quot;// ç”¨é€”ï¼šç›´æ¥ç”¨ä½œ img src</code></pre><h3 id="as-srcset-å“åº”å¼å›¾ç‰‡é›†"><a href="#as-srcset-å“åº”å¼å›¾ç‰‡é›†" class="headerlink" title="as=srcset - å“åº”å¼å›¾ç‰‡é›†"></a><code>as=srcset</code> - å“åº”å¼å›¾ç‰‡é›†</h3><pre><code class="typescript">import &#123; srcset &#125; from &#39;./pic.jpg?w=400;800;1200&amp;format=webp&amp;as=srcset&#39;// ç±»å‹ï¼šstring// å€¼ï¼š&quot;/assets/pic-400.hash.webp 400w, /assets/pic-800.hash.webp 800w, /assets/pic-1200.hash.webp 1200w&quot;// ç”¨é€”ï¼šimg æ ‡ç­¾çš„ srcset å±æ€§</code></pre><h3 id="as-metadata-å›¾ç‰‡å…ƒä¿¡æ¯"><a href="#as-metadata-å›¾ç‰‡å…ƒä¿¡æ¯" class="headerlink" title="as=metadata - å›¾ç‰‡å…ƒä¿¡æ¯"></a><code>as=metadata</code> - å›¾ç‰‡å…ƒä¿¡æ¯</h3><pre><code class="typescript">import &#123; metadata &#125; from &#39;./pic.jpg?w=400&amp;as=metadata&#39;// ç±»å‹ï¼š&#123; src: string, width: number, height: number, format: string &#125;// å€¼ï¼š&#123; src: &quot;/assets/pic.hash.webp&quot;, width: 400, height: 300, format: &quot;webp&quot; &#125;// ç”¨é€”ï¼šè·å–å¤„ç†åçš„å›¾ç‰‡ä¿¡æ¯</code></pre><h3 id="as-img-å›¾ç‰‡å¯¹è±¡"><a href="#as-img-å›¾ç‰‡å¯¹è±¡" class="headerlink" title="as=img - å›¾ç‰‡å¯¹è±¡"></a><code>as=img</code> - å›¾ç‰‡å¯¹è±¡</h3><pre><code class="typescript">import img from &#39;./pic.jpg?w=400&amp;as=img&#39;// ç±»å‹ï¼š&#123; src: string, w: number, h: number &#125;// å€¼ï¼š&#123; src: &quot;/assets/pic.hash.webp&quot;, w: 400, h: 300 &#125;// ç”¨é€”ï¼šåŒæ—¶è·å– URL å’Œå°ºå¯¸ä¿¡æ¯</code></pre><h3 id="as-picture-Picture-å…ƒç´ æ•°æ®"><a href="#as-picture-Picture-å…ƒç´ æ•°æ®" class="headerlink" title="as=picture - Picture å…ƒç´ æ•°æ®"></a><code>as=picture</code> - Picture å…ƒç´ æ•°æ®</h3><pre><code class="typescript">import picture from &#39;./pic.jpg?format=webp;avif;jpg&amp;w=800&amp;as=picture&#39;// ç±»å‹ï¼š&#123; sources: Record&lt;string, string&gt;, img: &#123; src: string, w: number, h: number &#125; &#125;// å€¼ï¼š&#123;//   sources: &#123;//     webp: &quot;/assets/pic.hash.webp 800w&quot;,//     avif: &quot;/assets/pic.hash.avif 800w&quot;//   &#125;,//   img: &#123; src: &quot;/assets/pic.hash.jpg&quot;, w: 800, h: 600 &#125;// &#125;// ç”¨é€”ï¼šç”Ÿæˆ &lt;picture&gt; å…ƒç´ </code></pre><h2 id="ğŸš€-å®é™…ä½¿ç”¨ç¤ºä¾‹"><a href="#ğŸš€-å®é™…ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="ğŸš€ å®é™…ä½¿ç”¨ç¤ºä¾‹"></a>ğŸš€ å®é™…ä½¿ç”¨ç¤ºä¾‹</h2><h3 id="1-åŸºç¡€-WebP-è½¬æ¢"><a href="#1-åŸºç¡€-WebP-è½¬æ¢" class="headerlink" title="1. åŸºç¡€ WebP è½¬æ¢"></a>1. åŸºç¡€ WebP è½¬æ¢</h3><pre><code class="vue">&lt;template&gt;  &lt;img    :src=&quot;heroImage&quot;    alt=&quot;Hero image&quot;  /&gt;&lt;/template&gt;&lt;script setup lang=&quot;ts&quot;&gt;// å°† PNG è½¬æ¢ä¸º WebP æ ¼å¼import heroImage from &#39;@/assets/images/hero.png?format=webp&amp;quality=85&#39;&lt;/script&gt;</code></pre><h3 id="2-å“åº”å¼å›¾åƒ"><a href="#2-å“åº”å¼å›¾åƒ" class="headerlink" title="2. å“åº”å¼å›¾åƒ"></a>2. å“åº”å¼å›¾åƒ</h3><pre><code class="vue">&lt;template&gt;  &lt;img    :srcset=&quot;srcset&quot;    sizes=&quot;(max-width: 600px) 300px, 600px&quot;    alt=&quot;Responsive image&quot;  /&gt;&lt;/template&gt;&lt;script setup lang=&quot;ts&quot;&gt;// ç”Ÿæˆå¤šç§å°ºå¯¸çš„ WebP å›¾åƒimport &#123; srcset &#125; from &#39;@/assets/images/banner.png?w=300;600;900&amp;format=webp&amp;quality=85&#39;&lt;/script&gt;</code></pre><h3 id="3-å¤šæ ¼å¼æ”¯æŒ"><a href="#3-å¤šæ ¼å¼æ”¯æŒ" class="headerlink" title="3. å¤šæ ¼å¼æ”¯æŒ"></a>3. å¤šæ ¼å¼æ”¯æŒ</h3><pre><code class="vue">&lt;template&gt;  &lt;picture&gt;    &lt;source      :srcset=&quot;avifSrcset&quot;      type=&quot;image/avif&quot;    /&gt;    &lt;source      :srcset=&quot;webpSrcset&quot;      type=&quot;image/webp&quot;    /&gt;    &lt;img      :src=&quot;fallbackSrc&quot;      alt=&quot;Multi-format image&quot;    /&gt;  &lt;/picture&gt;&lt;/template&gt;&lt;script setup lang=&quot;ts&quot;&gt;// ç”Ÿæˆ WebP å’Œ AVIF æ ¼å¼import &#123; srcset as webpSrcset &#125; from &#39;@/assets/images/photo.png?format=webp&amp;quality=85&amp;w=300;600&#39;import &#123; srcset as avifSrcset &#125; from &#39;@/assets/images/photo.png?format=avif&amp;quality=80&amp;w=300;600&#39;import fallbackSrc from &#39;@/assets/images/photo.png?w=600&#39;&lt;/script&gt;</code></pre><h3 id="4-æ¸è¿›å¼-WebP-å›¾åƒ"><a href="#4-æ¸è¿›å¼-WebP-å›¾åƒ" class="headerlink" title="4. æ¸è¿›å¼ WebP å›¾åƒ"></a>4. æ¸è¿›å¼ WebP å›¾åƒ</h3><pre><code class="vue">&lt;template&gt;  &lt;img    :src=&quot;progressiveImage&quot;    alt=&quot;Progressive WebP&quot;  /&gt;&lt;/template&gt;&lt;script setup lang=&quot;ts&quot;&gt;// ç”Ÿæˆæ¸è¿›å¼ WebP å›¾åƒimport progressiveImage from &#39;@/assets/images/large-image.png?format=webp&amp;quality=85&amp;progressive=true&#39;&lt;/script&gt;</code></pre><h3 id="5-èƒŒæ™¯å›¾åƒä¼˜åŒ–"><a href="#5-èƒŒæ™¯å›¾åƒä¼˜åŒ–" class="headerlink" title="5. èƒŒæ™¯å›¾åƒä¼˜åŒ–"></a>5. èƒŒæ™¯å›¾åƒä¼˜åŒ–</h3><pre><code class="vue">&lt;template&gt;  &lt;div    class=&quot;hero-bg&quot;    :style=&quot;&#123; backgroundImage: `url($&#123;bgImage&#125;)` &#125;&quot;  &gt;&lt;/div&gt;&lt;/template&gt;&lt;script setup lang=&quot;ts&quot;&gt;// ä¼˜åŒ–èƒŒæ™¯å›¾åƒimport bgImage from &#39;@/assets/images/background.png?format=webp&amp;quality=80&amp;w=1920&#39;&lt;/script&gt;</code></pre><h3 id="6-é«˜çº§ç”¨æ³•ï¼šPicture-å…ƒç´ "><a href="#6-é«˜çº§ç”¨æ³•ï¼šPicture-å…ƒç´ " class="headerlink" title="6. é«˜çº§ç”¨æ³•ï¼šPicture å…ƒç´ "></a>6. é«˜çº§ç”¨æ³•ï¼šPicture å…ƒç´ </h3><pre><code class="vue">&lt;template&gt;  &lt;picture&gt;    &lt;source      v-for=&quot;(srcset, format) in modernSources&quot;      :key=&quot;format&quot;      :srcset=&quot;srcset&quot;      :type=&quot;`image/$&#123;format&#125;`&quot;    /&gt;    &lt;img      :src=&quot;img.src&quot;      :width=&quot;img.w&quot;      :height=&quot;img.h&quot;      alt=&quot;Banner&quot;    /&gt;  &lt;/picture&gt;&lt;/template&gt;&lt;script setup lang=&quot;ts&quot;&gt;import &#123; sources as modernSources, img &#125; from &#39;@/assets/hero.jpg?format=webp;avif&amp;w=800&amp;as=picture&#39;&lt;/script&gt;</code></pre><h2 id="ğŸ“Š-æ€§èƒ½å½±å“å¯¹æ¯”"><a href="#ğŸ“Š-æ€§èƒ½å½±å“å¯¹æ¯”" class="headerlink" title="ğŸ“Š æ€§èƒ½å½±å“å¯¹æ¯”"></a>ğŸ“Š æ€§èƒ½å½±å“å¯¹æ¯”</h2><h3 id="æ–‡ä»¶å¤§å°å¯¹æ¯”ï¼ˆä»¥-1MB-åŸå§‹-JPEG-ä¸ºä¾‹ï¼‰"><a href="#æ–‡ä»¶å¤§å°å¯¹æ¯”ï¼ˆä»¥-1MB-åŸå§‹-JPEG-ä¸ºä¾‹ï¼‰" class="headerlink" title="æ–‡ä»¶å¤§å°å¯¹æ¯”ï¼ˆä»¥ 1MB åŸå§‹ JPEG ä¸ºä¾‹ï¼‰"></a>æ–‡ä»¶å¤§å°å¯¹æ¯”ï¼ˆä»¥ 1MB åŸå§‹ JPEG ä¸ºä¾‹ï¼‰</h3><table><thead><tr><th>é…ç½®</th><th>è¾“å‡ºå¤§å°</th><th>è´¨é‡</th><th>ç”¨é€”</th></tr></thead><tbody><tr><td><code>?format=webp&amp;quality=90</code></td><td>~400KB</td><td>ä¼˜ç§€</td><td>é«˜è´¨é‡å±•ç¤º</td></tr><tr><td><code>?format=webp&amp;quality=85</code></td><td>~300KB</td><td>å¾ˆå¥½</td><td>é€šç”¨åœºæ™¯</td></tr><tr><td><code>?format=webp&amp;quality=75</code></td><td>~200KB</td><td>è‰¯å¥½</td><td>ç¼©ç•¥å›¾</td></tr><tr><td><code>?format=avif&amp;quality=85</code></td><td>~250KB</td><td>å¾ˆå¥½</td><td>ç°ä»£æµè§ˆå™¨</td></tr><tr><td><code>?w=400&amp;format=webp&amp;quality=85</code></td><td>~50KB</td><td>å¾ˆå¥½</td><td>å°å°ºå¯¸å›¾ç‰‡</td></tr></tbody></table><h3 id="æ„å»ºæ—¶é—´å½±å“"><a href="#æ„å»ºæ—¶é—´å½±å“" class="headerlink" title="æ„å»ºæ—¶é—´å½±å“"></a>æ„å»ºæ—¶é—´å½±å“</h3><table><thead><tr><th>æ“ä½œ</th><th>ç›¸å¯¹è€—æ—¶</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>æ ¼å¼è½¬æ¢</td><td>1x</td><td>åŸºç¡€æ“ä½œ</td></tr><tr><td>å°ºå¯¸è°ƒæ•´</td><td>1.2x</td><td>è½»å¾®å¢åŠ </td></tr><tr><td>å¤šå°ºå¯¸ç”Ÿæˆ</td><td>2-3x</td><td>æŒ‰å°ºå¯¸æ•°é‡å€å¢</td></tr><tr><td>å¤šæ ¼å¼è¾“å‡º</td><td>2-4x</td><td>æŒ‰æ ¼å¼æ•°é‡å€å¢</td></tr><tr><td>å¤æ‚æ»¤é•œ</td><td>1.5-2x</td><td>æ¨¡ç³Šã€è‰²è°ƒç­‰</td></tr></tbody></table><h2 id="ğŸ’¡-æœ€ä½³å®è·µ"><a href="#ğŸ’¡-æœ€ä½³å®è·µ" class="headerlink" title="ğŸ’¡ æœ€ä½³å®è·µ"></a>ğŸ’¡ æœ€ä½³å®è·µ</h2><h3 id="1-é€‰æ‹©åˆé€‚çš„å›¾ç‰‡"><a href="#1-é€‰æ‹©åˆé€‚çš„å›¾ç‰‡" class="headerlink" title="1. é€‰æ‹©åˆé€‚çš„å›¾ç‰‡"></a>1. é€‰æ‹©åˆé€‚çš„å›¾ç‰‡</h3><ul><li><strong>é‡è¦å›¾ç‰‡</strong>ï¼šä½¿ç”¨ imagetools è¿›è¡Œæ ¼å¼è½¬æ¢</li><li><strong>æ™®é€šå›¾ç‰‡</strong>ï¼šä¾èµ– vite-plugin-image-optimizer è¿›è¡Œå‹ç¼©</li></ul><h3 id="2-è´¨é‡è®¾ç½®"><a href="#2-è´¨é‡è®¾ç½®" class="headerlink" title="2. è´¨é‡è®¾ç½®"></a>2. è´¨é‡è®¾ç½®</h3><ul><li><strong>WebP</strong>: <code>quality=85</code> æ˜¯è§†è§‰æ— æŸçš„æœ€ä½³å¹³è¡¡ç‚¹</li><li><strong>AVIF</strong>: <code>quality=80</code> æä¾›æ›´å¥½çš„å‹ç¼©ç‡</li></ul><h3 id="3-å“åº”å¼å›¾åƒ"><a href="#3-å“åº”å¼å›¾åƒ" class="headerlink" title="3. å“åº”å¼å›¾åƒ"></a>3. å“åº”å¼å›¾åƒ</h3><ul><li>ä¸ºä¸åŒè®¾å¤‡ç”Ÿæˆåˆé€‚çš„å°ºå¯¸</li><li>ä½¿ç”¨ <code>sizes</code> å±æ€§é…åˆ <code>srcset</code></li></ul><h3 id="4-é™çº§æ–¹æ¡ˆ"><a href="#4-é™çº§æ–¹æ¡ˆ" class="headerlink" title="4. é™çº§æ–¹æ¡ˆ"></a>4. é™çº§æ–¹æ¡ˆ</h3><ul><li>ä½¿ç”¨ <code>&lt;picture&gt;</code> æ ‡ç­¾æä¾›å¤šæ ¼å¼æ”¯æŒ</li><li>ç¡®ä¿æœ‰ PNG/JPG æ ¼å¼çš„é™çº§æ–¹æ¡ˆ</li></ul><h3 id="5-åŸºç¡€é…ç½®æ¨è"><a href="#5-åŸºç¡€é…ç½®æ¨è" class="headerlink" title="5. åŸºç¡€é…ç½®æ¨è"></a>5. åŸºç¡€é…ç½®æ¨è</h3><pre><code class="typescript">// vite.config.mtsimagetools(&#123;  defaultDirectives: new URLSearchParams(&#123;    format: &#39;webp&#39;,    quality: &#39;85&#39;,    progressive: &#39;true&#39;,  &#125;),  removeMetadata: true,&#125;)</code></pre><h3 id="6-æŒ‰ç”¨é€”åˆ†ç±»å¤„ç†"><a href="#6-æŒ‰ç”¨é€”åˆ†ç±»å¤„ç†" class="headerlink" title="6. æŒ‰ç”¨é€”åˆ†ç±»å¤„ç†"></a>6. æŒ‰ç”¨é€”åˆ†ç±»å¤„ç†</h3><pre><code class="typescript">// è‹±é›„å›¾ç‰‡ - é«˜è´¨é‡import hero from &#39;@/assets/hero.jpg?format=webp&amp;quality=90&amp;w=1920&#39;// ç¼©ç•¥å›¾ - å°å°ºå¯¸ï¼Œä½è´¨é‡import thumb from &#39;@/assets/photo.jpg?w=200&amp;h=200&amp;fit=cover&amp;quality=75&#39;// èƒŒæ™¯å›¾ - æ¨¡ç³Šï¼Œä½è´¨é‡import bgBlur from &#39;@/assets/bg.jpg?blur=10&amp;quality=60&amp;w=1200&#39;// å“åº”å¼å›¾ç‰‡import &#123; srcset &#125; from &#39;@/assets/banner.jpg?w=400;800;1200&amp;format=webp&amp;as=srcset&#39;</code></pre><h2 id="ğŸ”§-é¡¹ç›®é…ç½®"><a href="#ğŸ”§-é¡¹ç›®é…ç½®" class="headerlink" title="ğŸ”§ é¡¹ç›®é…ç½®"></a>ğŸ”§ é¡¹ç›®é…ç½®</h2><h3 id="å½“å‰é¡¹ç›®é…ç½®"><a href="#å½“å‰é¡¹ç›®é…ç½®" class="headerlink" title="å½“å‰é¡¹ç›®é…ç½®"></a>å½“å‰é¡¹ç›®é…ç½®</h3><pre><code class="typescript">// vite.config.mtsimagetools(&#123;  // æ¯å¼ å›¾ç‰‡é»˜è®¤ç”Ÿæ•ˆçš„æŒ‡ä»¤ï¼Œæ‹¼æ¥é»˜è®¤å‚æ•°  defaultDirectives: new URLSearchParams(&#123;    progressive: &#39;true&#39;,  &#125;),&#125;),</code></pre><h3 id="TypeScript-ç±»å‹å£°æ˜"><a href="#TypeScript-ç±»å‹å£°æ˜" class="headerlink" title="TypeScript ç±»å‹å£°æ˜"></a>TypeScript ç±»å‹å£°æ˜</h3><p>é¡¹ç›®å·²åœ¨ <code>env.d.ts</code> ä¸­é…ç½®äº†å®Œæ•´çš„ ImageTools ç±»å‹å£°æ˜ï¼Œæ”¯æŒæ‰€æœ‰æŸ¥è¯¢å‚æ•°çš„ç±»å‹æ£€æŸ¥ã€‚</p><pre><code class="ts">// Imagetools ç±»å‹å£°æ˜declare module &#39;*.png?format=webp&#39; &#123;  const src: string  export default src&#125;declare module &#39;*.jpg?format=webp&#39; &#123;  const src: string  export default src&#125;declare module &#39;*.jpeg?format=webp&#39; &#123;  const src: string  export default src&#125;declare module &#39;*.png?format=avif&#39; &#123;  const src: string  export default src&#125;declare module &#39;*.jpg?format=avif&#39; &#123;  const src: string  export default src&#125;declare module &#39;*.jpeg?format=avif&#39; &#123;  const src: string  export default src&#125;declare module &#39;*.png?format=webp,avif&#39; &#123;  const src: string  export default src&#125;declare module &#39;*.jpg?format=webp,avif&#39; &#123;  const src: string  export default src&#125;declare module &#39;*.jpeg?format=webp,avif&#39; &#123;  const src: string  export default src&#125;// å¸¦å°ºå¯¸å‚æ•°çš„ WebPdeclare module &#39;*.png?w=*&amp;format=webp&#39; &#123;  const srcset: string  export &#123; srcset &#125;&#125;declare module &#39;*.jpg?w=*&amp;format=webp&#39; &#123;  const srcset: string  export &#123; srcset &#125;&#125;declare module &#39;*.jpeg?w=*&amp;format=webp&#39; &#123;  const srcset: string  export &#123; srcset &#125;&#125;// å¸¦å°ºå¯¸å‚æ•°çš„ AVIFdeclare module &#39;*.png?w=*&amp;format=avif&#39; &#123;  const srcset: string  export &#123; srcset &#125;&#125;declare module &#39;*.jpg?w=*&amp;format=avif&#39; &#123;  const srcset: string  export &#123; srcset &#125;&#125;declare module &#39;*.jpeg?w=*&amp;format=avif&#39; &#123;  const srcset: string  export &#123; srcset &#125;&#125;// é€šç”¨æŸ¥è¯¢å‚æ•°æ”¯æŒdeclare module &#39;*.png?*&#39; &#123;  const src: string  export default src  export const srcset: string  export const metadata: any&#125;declare module &#39;*.jpg?*&#39; &#123;  const src: string  export default src  export const srcset: string  export const metadata: any&#125;declare module &#39;*.jpeg?*&#39; &#123;  const src: string  export default src  export const srcset: string  export const metadata: any&#125;declare module &#39;*.webp?*&#39; &#123;  const src: string  export default src  export const srcset: string  export const metadata: any&#125;declare module &#39;*.avif?*&#39; &#123;  const src: string  export default src  export const srcset: string  export const metadata: any&#125;</code></pre><h2 id="âš ï¸-æ³¨æ„äº‹é¡¹"><a href="#âš ï¸-æ³¨æ„äº‹é¡¹" class="headerlink" title="âš ï¸ æ³¨æ„äº‹é¡¹"></a>âš ï¸ æ³¨æ„äº‹é¡¹</h2><ol><li><strong>å›¾ç‰‡å¿…é¡»é€šè¿‡ import å¯¼å…¥</strong>ï¼šåªæœ‰é€šè¿‡ ES6 import å¯¼å…¥çš„å›¾ç‰‡æ‰ä¼šè¢« imagetools å¤„ç†</li><li><strong>Node.js ç‰ˆæœ¬è¦æ±‚</strong>ï¼šæœ€æ–°ç‰ˆæœ¬çš„ imagetools éœ€è¦ Node.js 18+ï¼Œå½“å‰é¡¹ç›®ä½¿ç”¨å…¼å®¹ç‰ˆæœ¬</li><li><strong>æ„å»ºæ—¶é—´</strong>ï¼šå¤æ‚çš„å›¾ç‰‡å¤„ç†ä¼šå¢åŠ æ„å»ºæ—¶é—´ï¼Œå»ºè®®åˆç†ä½¿ç”¨</li><li><strong>æ–‡ä»¶å¤§å°æƒè¡¡</strong>ï¼šè¿‡åº¦ä¼˜åŒ–å¯èƒ½å¯¼è‡´è´¨é‡æŸå¤±ï¼Œéœ€è¦åœ¨æ–‡ä»¶å¤§å°å’Œè´¨é‡ä¹‹é—´æ‰¾åˆ°å¹³è¡¡</li></ol><h2 id="ğŸŒ-WebP-AVIF-æµè§ˆå™¨å…¼å®¹æ€§"><a href="#ğŸŒ-WebP-AVIF-æµè§ˆå™¨å…¼å®¹æ€§" class="headerlink" title="ğŸŒ WebP/AVIF æµè§ˆå™¨å…¼å®¹æ€§"></a>ğŸŒ WebP/AVIF æµè§ˆå™¨å…¼å®¹æ€§</h2><h3 id="WebP-æ”¯æŒ"><a href="#WebP-æ”¯æŒ" class="headerlink" title="WebP æ”¯æŒ"></a>WebP æ”¯æŒ</h3><ul><li><strong>Chrome</strong>: 23+</li><li><strong>Firefox</strong>: 65+</li><li><strong>Safari</strong>: 14+</li><li><strong>Edge</strong>: 18+</li></ul><h3 id="AVIF-æ”¯æŒ"><a href="#AVIF-æ”¯æŒ" class="headerlink" title="AVIF æ”¯æŒ"></a>AVIF æ”¯æŒ</h3><ul><li><strong>Chrome</strong>: 85+</li><li><strong>Firefox</strong>: 93+</li><li><strong>Safari</strong>: 16.1+</li><li><strong>Edge</strong>: 85+</li></ul><h3 id="ç§»åŠ¨ç«¯æ”¯æŒ"><a href="#ç§»åŠ¨ç«¯æ”¯æŒ" class="headerlink" title="ç§»åŠ¨ç«¯æ”¯æŒ"></a>ç§»åŠ¨ç«¯æ”¯æŒ</h3><ul><li><strong>iOS Safari</strong>: iOS 14+ æ”¯æŒ WebP</li><li><strong>Android Chrome</strong>: åŸç”Ÿæ”¯æŒ WebP</li><li><strong>å¾®ä¿¡æµè§ˆå™¨</strong>: æ”¯æŒ WebP</li></ul><h3 id="æ–‡ä»¶å¤§å°å¯¹æ¯”"><a href="#æ–‡ä»¶å¤§å°å¯¹æ¯”" class="headerlink" title="æ–‡ä»¶å¤§å°å¯¹æ¯”"></a>æ–‡ä»¶å¤§å°å¯¹æ¯”</h3><ul><li><strong>WebP</strong>: é€šå¸¸æ¯” PNG å° 25-35%</li><li><strong>AVIF</strong>: é€šå¸¸æ¯” WebP å° 20-30%</li></ul><h2 id="ğŸ“š-ç›¸å…³é“¾æ¥"><a href="#ğŸ“š-ç›¸å…³é“¾æ¥" class="headerlink" title="ğŸ“š ç›¸å…³é“¾æ¥"></a>ğŸ“š ç›¸å…³é“¾æ¥</h2><ul><li><a href="https://github.com/JonasKruckenberg/imagetools">ImageTools å®˜æ–¹æ–‡æ¡£</a></li><li><a href="https://sharp.pixelplumbing.com/">Sharp æ–‡æ¡£</a></li><li><a href="https://developers.google.com/speed/webp">WebP æ ¼å¼è¯´æ˜</a></li><li><a href="https://web.dev/compress-images-avif/">AVIF æ ¼å¼è¯´æ˜</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Vite </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vite </tag>
            
            <tag> æ€§èƒ½ä¼˜åŒ– </tag>
            
            <tag> å›¾ç‰‡ä¼˜åŒ– </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½ä»£ç æ ¸å¿ƒå®ç° - ç»„ä»¶é—´æ•°æ®å’Œè¡Œä¸ºäº¤äº’</title>
      <link href="/2025/04/17/lowcode/core/behavior/"/>
      <url>/2025/04/17/lowcode/core/behavior/</url>
      
        <content type="html"><![CDATA[<p>æ¯ä¸€ä¸ªç»„ä»¶å¯ä»¥å¯¹å¤–æä¾›ï¼š</p><ol><li>æŠ›å‡ºå¯è”åŠ¨çš„æ•°æ®</li><li>æŠ›å‡ºå¯è°ƒç”¨çš„æ–¹æ³•</li><li>æä¾›å¯ç›‘å¬çš„äº‹ä»¶</li></ol><h3 id="æŠ›å‡ºå¯è”åŠ¨çš„æ•°æ®"><a href="#æŠ›å‡ºå¯è”åŠ¨çš„æ•°æ®" class="headerlink" title="æŠ›å‡ºå¯è”åŠ¨çš„æ•°æ®"></a>æŠ›å‡ºå¯è”åŠ¨çš„æ•°æ®</h3><p>æ¯ä¸ªç»„ä»¶å¯ä»¥å‘å¤–æŠ›å‡ºæ•°æ®ï¼Œåº”ç”¨ä¼šæ”¶é›†ç»´æŠ¤åœ¨å…¨å±€å­˜å‚¨ï¼Œè¯¥æ•°æ®åº”æ˜¯å¯å“åº”å¼çš„ï¼Œåœ¨åº”ç”¨é¡¶å±‚é€šè¿‡ Provider å‘ä¸‹ä¼ é€’ï¼Œæ¯ä¸€ä¸ªç»„ä»¶éƒ½å¯ä»¥è¯»å–åˆ°ã€‚</p><p>ç»„ä»¶æŠ›å‡ºçš„æ•°æ®ï¼Œåœ¨ç¼–è¾‘å™¨ä¸­æ‹–åŠ¨é…ç½®ç»„ä»¶æ—¶ï¼Œä¸ºäº†èƒ½å¤Ÿè¢«å…¶å®ƒç»„ä»¶ä½¿ç”¨ï¼Œéœ€è¦åœ¨è¯¥ç»„ä»¶ä¸­é¢„å…ˆå®šä¹‰å¥½å¾…æŠ›å‡ºçš„æ•°æ®ã€‚</p><pre><code class="typescript">export default defineComponent&lt;Options&gt;(&#123;  declarations: &#123;    // æ­¤ç»„ä»¶å¯è”åŠ¨çš„æ•°æ®    linkState: &#123;      // å®šä¹‰æ­¤ç»„ä»¶ä¼šå‘å¤–æŠ›å‡ºâ€å·²é¢„çº¦äººæ•°â€œçš„æ•°æ®      numFollowed: &#123;        label: &#39;å·²é¢„çº¦äººæ•°&#39;,        type: &#39;number&#39;,        default: 0,      &#125;,    &#125;,  &#125;,&#125;);</code></pre><p>ç»„ä»¶å®ç°ä¸­å€ŸåŠ©ç»Ÿä¸€æä¾›çš„å‡½æ•°æŠ›å‡ºæ•°æ®ï¼š</p><pre><code class="typescript">const num = await getFollowedNum(); // ç¤ºä¾‹ä»æ¥å£è·å–// æŠ›å‡ºå‡½æ•°ç”±å…¨å±€ä¸‹å‘ï¼Œå†…éƒ¨å®ç°æ—¶ï¼Œéœ€å…³è”å½“å‰ç»„ä»¶çš„å”¯ä¸€ ID å°†å…¶æŒ‚è½½åˆ°å…¨å±€å­˜å‚¨syncState(&#123;  numFollowed: num,&#125;);</code></pre><p>è€Œå…¶å®ƒç»„ä»¶å¯é€šè¿‡ä»¥ä¸‹æ–¹å¼ä½¿ç”¨æ•°æ®ï¼š</p><ol><li><p>è‡ªå·±çš„é…ç½®é¡¹ï¼Œç›´æ¥ç»‘å®šæ¥è‡ªäºæŸç»„ä»¶ä¸‹çš„æŸæ•°æ®</p></li><li><p>é…ç½®è”åŠ¨ç›®æ ‡ç»„ä»¶çš„æŸé¡¹æ•°æ®ï¼Œå½“å…¶â€å¤§äºã€å°äºã€ç­‰äºâ€œç›®æ ‡å€¼æ—¶ï¼Œè”åŠ¨åˆ‡æ¢æŒ‡å®šçš„çŠ¶æ€</p></li></ol><h3 id="æŠ›å‡ºå¯è°ƒç”¨çš„æ–¹æ³•"><a href="#æŠ›å‡ºå¯è°ƒç”¨çš„æ–¹æ³•" class="headerlink" title="æŠ›å‡ºå¯è°ƒç”¨çš„æ–¹æ³•"></a>æŠ›å‡ºå¯è°ƒç”¨çš„æ–¹æ³•</h3><p>ç»„ä»¶ä¸­å®šä¹‰å¯è°ƒç”¨çš„æ–¹æ³•åï¼ŒåŠé…ç½®æ–¹æ³•æ—¶çš„è¡¨å•é…ç½®ã€‚</p><pre><code class="typescript">export default defineComponent&lt;Options&gt; (&#123;  declarations: &#123;    // å¯è¢«å…¶å®ƒç»„ä»¶è°ƒç”¨çš„æ–¹æ³•    methods: [      &#123;        label: &#39;åˆ·æ–°åˆ—è¡¨&#39;,        name: &#39;refresh&#39;,        form: &#123;          label: &#39;åˆ·æ–°ç¬¬å‡ é¡µ&#39;          placeholder: &#39;è¯·è¾“å…¥åˆ·æ–°ç¬¬å‡ é¡µï¼Œè‹¥ç¼ºçœé»˜è®¤åˆ·æ–°å½“å‰é¡µ&#39;        &#125;      &#125;    ]  &#125;&#125;)</code></pre><pre><code class="typescript">const refresh = () =&gt; &#123;&#125;;// ç¤ºä¾‹ Vue çš„å®ç°defineExpose(&#123;  refresh,&#125;);</code></pre><h3 id="æä¾›å¯ç›‘å¬çš„äº‹ä»¶"><a href="#æä¾›å¯ç›‘å¬çš„äº‹ä»¶" class="headerlink" title="æä¾›å¯ç›‘å¬çš„äº‹ä»¶"></a>æä¾›å¯ç›‘å¬çš„äº‹ä»¶</h3><pre><code class="typescript">export default defineComponent&lt;Options&gt;(&#123;  declarations: &#123;    // å¯è¢«å…¶å®ƒç»„ä»¶ç›‘å¬çš„äº‹ä»¶    events: [      &#123;        label: &#39;åŠ è½½å®Œæˆæ—¶&#39;,        name: &#39;loaded&#39;,      &#125;,    ],  &#125;,&#125;);</code></pre>]]></content>
      
      
      <categories>
          
          <category> LowCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> LowCode </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vite ç–‘éš¾æ‚ç—‡</title>
      <link href="/2024/12/15/vite/qa/"/>
      <url>/2024/12/15/vite/qa/</url>
      
        <content type="html"><![CDATA[<p>åœ¨ 2022 å¹´åˆæŠ•äº§äº†ç¬¬ä¸€ä¸ª Vite åº”ç”¨åˆ°äº§çº¿ï¼Œé™†ç»­å¤„ç†çš„é—®é¢˜ Caseï¼ŒæŒ‘é€‰ä¸€äº›è®°å½•ä¸‹æ¥ã€‚</p><p>è‹¥æ”¹é€ æ—§çš„ webpack åº”ç”¨ï¼Œæ¨èå‚ç…§ <a href="https://github.com/originjs/webpack-to-vite/blob/main/README-zh.md">webpack-to-vite</a> ç†è§£æ›´å¤šå·®å¼‚ã€‚</p><h2 id="åº”ç”¨ä¸­éœ€è¦æ”¯æŒ-require-è¯­æ³•"><a href="#åº”ç”¨ä¸­éœ€è¦æ”¯æŒ-require-è¯­æ³•" class="headerlink" title="åº”ç”¨ä¸­éœ€è¦æ”¯æŒ require è¯­æ³•"></a>åº”ç”¨ä¸­éœ€è¦æ”¯æŒ <code>require</code> è¯­æ³•</h2><p>åº”ç”¨ä»£ç ä¸­ï¼Œé€šå¸¸ä¸å†å»ºè®®ä½¿ç”¨ <code>require</code>ï¼Œåº”å½“éƒ½æ›¿æ¢ä¸º <code>import</code>.</p><p>ä½†æ˜¯ï¼Œè‹¥ä¸ºè¿ç§»æ—§ä»£ç æˆ–å…¶å®ƒåŸå› ï¼Œç¤¾åŒºæœ‰å¤šæ¬¾æ’ä»¶å¯ä»¥é€‰ç”¨ã€‚</p><p>ç®€å•çš„åœºæ™¯æ¨èï¼š<a href="https://github.com/wangzongming/vite-plugin-require">https://github.com/wangzongming/vite-plugin-require</a></p><p>å¦‚æœæ˜¯ä¸‰æ–¹ä¾èµ–åŒ…çš„äº§ç‰©ä¸­åŒ…å«äº† <code>require()</code> ä»£ç å‘¢ï¼Ÿ</p><p>è¿™ç§åœºæ™¯æ›´åŠ å¤æ‚ä¸€äº›ï¼Œåœ¨ esbuild é¢„æ„å»ºæ—¶å¯èƒ½é‡åˆ°æ¨¡å—å¯¼å‡ºçš„å€¼ä¸ç¬¦åˆé¢„æœŸï¼Œåœ¨è°ƒç ”å¯¹æ¯”å¤šä¸ªç¤¾åŒºæ–¹æ¡ˆåï¼Œæ¨èè€ƒè™‘ä½¿ç”¨ä»¥ä¸‹æ’ä»¶ï¼š</p><p><a href="https://github.com/vite-plugin/vite-plugin-commonjs">https://github.com/vite-plugin/vite-plugin-commonjs</a></p><h2 id="lib-æ¨¡å¼ç¼–è¯‘ï¼Œå¦‚ä½•å¼•å…¥-polyfillï¼Ÿ"><a href="#lib-æ¨¡å¼ç¼–è¯‘ï¼Œå¦‚ä½•å¼•å…¥-polyfillï¼Ÿ" class="headerlink" title="lib æ¨¡å¼ç¼–è¯‘ï¼Œå¦‚ä½•å¼•å…¥ polyfillï¼Ÿ"></a>lib æ¨¡å¼ç¼–è¯‘ï¼Œå¦‚ä½•å¼•å…¥ polyfillï¼Ÿ</h2><p>åœ¨æ‰“åŒ… App åº”ç”¨æ—¶å¯ä»¥ä¾é  <a href="https://github.com/vitejs/vite/tree/main/packages/plugin-legacy">@vitejs/plugin-legacy</a> å¤„ç† Polyfillï¼Œè€Œ lib æ¨¡å¼ç¼–è¯‘ç±»åº“æ—¶ï¼Œä¸ä¼šå¼•å…¥ Polyfillã€‚</p><p>æ¨èä½¿ç”¨ Rollup æ’ä»¶ï¼Œé€šè¿‡ Babel åœ¨æœ€åé˜¶æ®µå†å¤„ç† Polyfillã€‚</p><pre><code class="typescript">import &#123; defineConfig &#125; from &#39;vite&#39;;import &#123; getBabelOutputPlugin &#125; from &#39;@rollup/plugin-babel&#39;;export default defineConfig(&#123;  build: &#123;    rollupOptions: &#123;      plugins: [        /**         * Running Babel on the generated code:         *  https://github.com/rollup/plugins/blob/master/packages/babel/README.md#running-babel-on-the-generated-code         *         * Transforming ES6+ syntax to ES5 is not supported yet, there are two ways to do:         *  https://github.com/evanw/esbuild/issues/1010#issuecomment-803865232         * We choose to run Babel on the output files after esbuild.         *         * @vitejs/plugin-legacy does not support library mode:         *  https://github.com/vitejs/vite/issues/1639         */        getBabelOutputPlugin(&#123;          allowAllFormats: true,          presets: [            [              &#39;@babel/preset-env&#39;,              &#123;                useBuiltIns: false,                exclude: [&#39;transform-typeof-symbol&#39;],                modules: false,              &#125;,            ],          ],          plugins: [            [              &#39;@babel/plugin-transform-runtime&#39;,              &#123;                corejs: false,                // version: require(&#39;@babel/runtime&#39;).version,              &#125;,            ],          ].filter(Boolean),        &#125;),      ],    &#125;,  &#125;,&#125;);</code></pre><h2 id="Vite-lib-æ¨¡å¼æ‰“åŒ…æ—¶ï¼Œé™æ€èµ„æºä¼šè¢«å†…è”ï¼ˆå®˜æ–¹è§£é‡Šï¼‰ï¼Œå¦‚ä½•å¤„ç†ï¼Ÿ"><a href="#Vite-lib-æ¨¡å¼æ‰“åŒ…æ—¶ï¼Œé™æ€èµ„æºä¼šè¢«å†…è”ï¼ˆå®˜æ–¹è§£é‡Šï¼‰ï¼Œå¦‚ä½•å¤„ç†ï¼Ÿ" class="headerlink" title="Vite lib æ¨¡å¼æ‰“åŒ…æ—¶ï¼Œé™æ€èµ„æºä¼šè¢«å†…è”ï¼ˆå®˜æ–¹è§£é‡Šï¼‰ï¼Œå¦‚ä½•å¤„ç†ï¼Ÿ"></a>Vite lib æ¨¡å¼æ‰“åŒ…æ—¶ï¼Œé™æ€èµ„æºä¼šè¢«å†…è”ï¼ˆ<a href="https://cn.vite.dev/config/build-options.html#build-assetsinlinelimit">å®˜æ–¹è§£é‡Š</a>ï¼‰ï¼Œå¦‚ä½•å¤„ç†ï¼Ÿ</h2><p>å½“æˆ‘ä»¬ä½¿ç”¨ Vite ç¼–è¯‘ç»„ä»¶ã€ç±»åº“æ—¶ï¼Œæ­¤é—®é¢˜æš´éœ²å°¤å…¶æ˜æ˜¾ã€‚ä¾‹å¦‚ç»„ä»¶ä¸­ä½¿ç”¨çš„æŸå‡ å¼ å›¾ç‰‡ï¼Œç•™å¾…ä½¿ç”¨è¯¥ç»„ä»¶çš„åº”ç”¨æ‰“åŒ…åº”å±æœ€ä½³ï¼Œå¦åˆ™ï¼Œå¤§é‡çš„å›¾ç‰‡è¢«å†…è”åœ¨ js ä»£ç ä¸­ï¼Œä¼šä¸¥é‡å½±å“åŠ è½½é€Ÿåº¦ã€‚</p><p>åœ¨æˆ‘ä»¬çš„åœºæ™¯ä¸‹æ­¤é—®é¢˜ååˆ†é‡è¦ï¼Œç¤¾åŒºå†…æ²¡æœ‰å¯ä½¿ç”¨çš„æ–¹æ¡ˆï¼Œlayne åŒå­¦ç¼–å†™äº†ä»¥ä¸‹æ’ä»¶å®Œç¾è§£å†³é—®é¢˜ã€‚</p><p><a href="https://github.com/laynezh/vite-plugin-lib-assets">https://github.com/laynezh/vite-plugin-lib-assets</a></p><ul><li><code>iife</code> èµ„æºè·¯å¾„è½¬æ‹¼æ¥æŒ‡å®šçš„ <code>publicUrl</code></li><li><code>esm</code> è½¬æ¢ä¸ºç›¸å¯¹è·¯å¾„å¼•å…¥</li><li><code>commonjs</code> è½¬æ¢ä¸ºç›¸å¯¹è·¯å¾„å¼•å…¥</li></ul><pre><code class="typescript">import &#123; defineConfig &#125; from &#39;vite&#39;;import assetsPlugin from &#39;@laynezh/vite-plugin-lib-assets&#39;;export default defineConfig(&#123;  plugins: [    assetsPlugin(&#123;      name: &#39;[name].[contenthash:8].[ext]&#39;,      limit: 1024 * 8,      publicUrl: undefined,    &#125;),  ],&#125;);</code></pre><h2 id="commonjs-æ¨¡å—ä¸­å¼•ç”¨çš„èµ„æºåº”åŸæ ·è¾“å‡º"><a href="#commonjs-æ¨¡å—ä¸­å¼•ç”¨çš„èµ„æºåº”åŸæ ·è¾“å‡º" class="headerlink" title="commonjs æ¨¡å—ä¸­å¼•ç”¨çš„èµ„æºåº”åŸæ ·è¾“å‡º"></a>commonjs æ¨¡å—ä¸­å¼•ç”¨çš„èµ„æºåº”åŸæ ·è¾“å‡º</h2><pre><code class="typescript">import &#123; defineConfig &#125; from &#39;vite&#39;;export default defineConfig(&#123;  build: &#123;    commonjsOptions: &#123;      /**       * https://github.com/rollup/plugins/tree/master/packages/commonjs#requirereturnsdefault       *       * require(&#39;./images/123.png&#39;) =&gt; import Img123 from &#39;./images/123.png&#39;       *       * and &#39;./images/123.png&#39; ä¼šè¢« vite å¤„ç†æˆ base64 æ ¼å¼å®ç°è½½å…¥       */      requireReturnsDefault(id) &#123;        const [pureId] = id.split(&#39;?&#39;, 2);        return commonjsAssetsFilter(pureId);      &#125;,    &#125;,  &#125;,&#125;);</code></pre><h2 id="ä¿®æ”¹-lib-æ¨¡å¼è¾“å‡ºçš„æ ·å¼æ–‡ä»¶å"><a href="#ä¿®æ”¹-lib-æ¨¡å¼è¾“å‡ºçš„æ ·å¼æ–‡ä»¶å" class="headerlink" title="ä¿®æ”¹ lib æ¨¡å¼è¾“å‡ºçš„æ ·å¼æ–‡ä»¶å"></a>ä¿®æ”¹ lib æ¨¡å¼è¾“å‡ºçš„æ ·å¼æ–‡ä»¶å</h2><p>ä¸åŒäºä¿®æ”¹ js æ–‡ä»¶è¾“å‡ºçš„åç§°ï¼Œæ ·å¼æ–‡ä»¶éœ€è¦ä¸ä¸€æ ·çš„å¤„ç†æ–¹å¼ã€‚</p><pre><code class="typescript">import defineConfig from &#39;vite&#39;;export default defineConfig(&#123;  build: &#123;    rollupOptions: &#123;      output: &#123;        assetFileNames(assetInfo) &#123;          // https://github.com/vitejs/vite/issues/4863          if (!ignoreStyles &amp;&amp; assetInfo.name === &#39;style.css&#39;) &#123;            return `$&#123;fileName&#125;.css`;          &#125;          return assetInfo.name;        &#125;,      &#125;,    &#125;,  &#125;,&#125;);</code></pre>]]></content>
      
      
      <categories>
          
          <category> Vite </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vite </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å‰ç«¯ä¾èµ–æ²»ç†</title>
      <link href="/2022/07/22/fe/dependency-cruiser/"/>
      <url>/2022/07/22/fe/dependency-cruiser/</url>
      
        <content type="html"><![CDATA[<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><blockquote><p>Validate and visualise dependencies. With your rules. JavaScript. TypeScript. CoffeeScript. ES6, CommonJS, AMD.</p></blockquote><p>dependency-cruiserï¼Œç”¨äºå‰ç«¯ä¾èµ–æ¨¡å—çš„å¯è§†åŒ–å’Œä¾èµ–çš„æ ¡éªŒï¼Œæ”¯æŒä½¿ç”¨å®šåˆ¶çš„è§„åˆ™ï¼Œæ”¯æŒå‰ç«¯å¸¸ç”¨çš„ JSã€TS è¯­è¨€ä»¥åŠ ES Moduleã€CommonJS ç­‰æ¨¡å—è§„èŒƒã€‚</p><p>GitHubï¼š<a href="https://github.com/sverweij/dependency-cruiser">https://github.com/sverweij/dependency-cruiser</a></p><h2 id="æ¨¡å—ä¾èµ–å¯è§†åŒ–"><a href="#æ¨¡å—ä¾èµ–å¯è§†åŒ–" class="headerlink" title="æ¨¡å—ä¾èµ–å¯è§†åŒ–"></a>æ¨¡å—ä¾èµ–å¯è§†åŒ–</h2><p>æ¨èä½œä¸ºé˜…è¯»é¡¹ç›®æˆ–å¼€æºåº“æºç çš„è¾…åŠ©å·¥å…·ï¼Œæ›´æ˜“ç†æ¸…é¡¹ç›®å†…éƒ¨çš„ç»“æ„ã€ä¾èµ–å…³ç³»ã€‚</p><p>å®˜æ–¹ç¤ºä¾‹å›¾</p><p><img src="https://static.eleven.net.cn/images/dependency-cruiser-archi-graph.svg" alt=""></p><p>å®˜æ–¹ç¤ºä¾‹å›¾ï¼ˆReactï¼‰</p><p><img src="https://static.eleven.net.cn/images/react-high-level-dependencies.svg" alt=""></p><p>æ›´å¤šç¤ºä¾‹ï¼š<a href="https://github.com/sverweij/dependency-cruiser/blob/develop/doc/real-world-samples.md">https://github.com/sverweij/dependency-cruiser/blob/develop/doc/real-world-samples.md</a></p><h3 id="ä½¿ç”¨æ–¹å¼"><a href="#ä½¿ç”¨æ–¹å¼" class="headerlink" title="ä½¿ç”¨æ–¹å¼"></a>ä½¿ç”¨æ–¹å¼</h3><p>æ¨èæœ€ç®€å•çš„æŸ¥çœ‹æ–¹å¼ï¼Œå®‰è£… VS Code æ’ä»¶ â˜ Dependency Cruiser Extension</p><p><img src="/imgs/dependency_cruiser_vscode_plugin.png" alt=""></p><p>å®‰è£…å¥½æ’ä»¶åï¼Œåœ¨ vscode ä¸­ç›®æ ‡é¡¹ç›®ç›®å½•ä¸Šï¼Œç‚¹å‡»å³é”® - â€œView Dependenciesâ€ï¼Œå³å¯è‡ªåŠ¨ç”Ÿæˆç›¸å…³ä¾èµ–åˆ†æå›¾ï¼Œç¤ºä¾‹å¦‚ä¸‹ã€‚</p><h3 id="æ›´å¤šæ–¹å¼"><a href="#æ›´å¤šæ–¹å¼" class="headerlink" title="æ›´å¤šæ–¹å¼"></a>æ›´å¤šæ–¹å¼</h3><p>å¦‚æœæœ‰æ›´åŠ å…·ä½“çš„éœ€æ±‚åœºæ™¯ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å·¥å…·ç”Ÿæˆ svg ä¾èµ–å…³ç³»å›¾ç‰‡ï¼Œè¯¦ç»†å‚ç…§å®˜æ–¹è¯´æ˜ <a href="https://github.com/sverweij/dependency-cruiser#show-stuff-to-your-grandma">https://github.com/sverweij/dependency-cruiser#show-stuff-to-your-grandma</a> ã€‚</p><p>ä¸€èˆ¬éœ€è¦åšè¿™äº›äº‹æƒ…ï¼š</p><ol><li><p>å®‰è£… graphvizï¼Œç”¨æ¥ç”Ÿæˆä¾èµ–å…³ç³»å›¾</p><pre><code class="bash">brew install graphviz</code></pre></li><li><p>åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹å®‰è£… dependency-cruiser</p><pre><code class="bash">npm i dependency-cruiser -D</code></pre></li><li><p>è¿è¡Œå‘½ä»¤ï¼Œç”Ÿæˆ svg ä¾èµ–å…³ç³»å›¾ç‰‡</p><pre><code class="bash">npx depcruise --include-only &quot;^src&quot; â€”output-type dot src | dot -T svg &gt; dependency-graph.svg</code></pre></li></ol><p>ç›¸å…³å‚æ•°ï¼š</p><ul><li><p><code>-output-type dot</code> ï¼šè¡¨ç¤ºè¾“å‡ºæ ¼å¼ä¸º dotï¼Œæ„å‘³ç€ä½¿ç”¨ Graphviz æ¥è¾“å‡º</p></li><li><p><code>dot -T svg &gt; dependency-graph.svg</code> ï¼šä¸º Graphviz çš„å‘½ä»¤è¡Œè¯­æ³•ï¼Œè¡¨ç¤ºè¾“å‡ºåä¸º dependency-graph çš„ svg æ–‡ä»¶</p></li><li><p><code>-exclude</code>ï¼šç”¨äºè¿‡æ»¤æ‰å›¾ä¸Šä¸å…³å¿ƒçš„ä¾èµ–</p></li><li><p><code>-include-only</code>ï¼šä¸ â€“exclude ç›¸åï¼Œåªä¿ç•™èŒƒå›´å†…çš„ä¾èµ–</p></li><li><p><code>-do-not-follow</code>ï¼šä¼šè¿‡æ»¤æ‰æŸä¸ªä¾èµ–çš„åç»­ä¾èµ–</p></li><li><p><code>-max-depth</code>ï¼šæŒ‡å®šä¾èµ–æ ‘çš„æ·±åº¦</p></li></ul><h2 id="æ¨¡å—ä¾èµ–æ ¡éªŒ"><a href="#æ¨¡å—ä¾èµ–æ ¡éªŒ" class="headerlink" title="æ¨¡å—ä¾èµ–æ ¡éªŒ"></a>æ¨¡å—ä¾èµ–æ ¡éªŒ</h2><p>å€ŸåŠ© dependency-cruiser å¯¹é¡¹ç›®çš„ä¾èµ–å…³ç³»åšæ ¡éªŒï¼Œæ ¹æ®æŒ‡å®šçš„è§„åˆ™ï¼Œæˆ–è‡ªå®šä¹‰çš„è§„åˆ™ï¼Œè§„é¿é¡¹ç›®ä¸­å¯èƒ½äº§ç”Ÿçš„é—®é¢˜é£é™©ã€‚</p><p>åœ¨æŸäº›å¤æ‚åœºæ™¯ï¼Œæˆ–æœ‰è¾ƒå¤šæ¨¡å—ä½¿ç”¨çº¦å®šçš„é¡¹ç›®ï¼Œéå¸¸é€‚åˆä½¿ç”¨ dependency-cruiser å»åšè§„åˆ™æ ¡éªŒï¼Œé™åˆ¶ä¸è§„èŒƒæˆ–å±é™©çš„è¡Œä¸ºã€‚</p><h3 id="ä½¿ç”¨æ–¹å¼-1"><a href="#ä½¿ç”¨æ–¹å¼-1" class="headerlink" title="ä½¿ç”¨æ–¹å¼"></a>ä½¿ç”¨æ–¹å¼</h3><ol><li><p>åœ¨é¡¹ç›®ä¸­åˆå§‹åŒ–é…ç½®æ–‡ä»¶</p><pre><code class="bash">npx -p dependency-cruiser depcruise --init</code></pre><p><img src="/imgs/dependency_cruiser_init.gif" alt=""></p><p>ä¼šåœ¨æ ¹ç›®å½•ä¸‹ç”Ÿæˆ .dependency-cruiser.js é…ç½®æ–‡ä»¶</p></li><li><p>åœ¨é¡¹ç›®ä¸­å®‰è£…ä¾èµ–</p><pre><code class="bash">npm i dependency-cruiser -D</code></pre></li><li><p>åœ¨ package.json ä¸­æ·»åŠ å‘½ä»¤</p><pre><code class="json">&#123;  &quot;scripts&quot;: &#123;    &quot;start&quot;: &quot;vite --port 4000&quot;,    &quot;build&quot;: &quot;vue-tsc --noEmit &amp;&amp; vite build&quot;,    &quot;preview&quot;: &quot;vite preview&quot;,  + &quot;lint&quot;: &quot;depcruise src --config .dependency-cruiser.cjs&quot;  &#125;,  +&quot;gitHooks&quot;: &#123;  + &quot;pre-commit&quot;: &quot;lint-staged --allow-empty&quot;  +&#125;,  + &quot;lint-staged&quot;: &#123;  +   &quot;src/**/*.&#123;js?(x),ts?(x)&#125;&quot;: [  +    &quot;yarn lint&quot;  +  ]  +&#125;&#125;</code></pre><p>æ·»åŠ å‘½ä»¤ lintï¼Œéšæ—¶è¿è¡Œæ ¡éªŒã€‚</p><p>æ¨èåŠ å…¥åˆ° Git Hooks ä¸­ï¼Œä¾‹å¦‚ï¼šæ”¾åˆ° pre-commit é˜¶æ®µæ‰§è¡Œæ ¡éªŒï¼Œæœªé€šè¿‡ç¦æ­¢æäº¤ä»£ç ã€‚</p><p><img src="/imgs/dependency_cruiser_lint.png" alt=""></p><p>è¿™é‡Œä¸ºäº†æ–¹ä¾¿æ¼”ç¤ºï¼ŒGit Hooks ç”¨çš„ yorkieï¼Œè‹¥ä½¿ç”¨ husky åˆ™æ›´æ¢å¯¹åº”é…ç½®ã€‚</p></li></ol><h3 id="è§„åˆ™æ–‡ä»¶"><a href="#è§„åˆ™æ–‡ä»¶" class="headerlink" title="è§„åˆ™æ–‡ä»¶"></a>è§„åˆ™æ–‡ä»¶</h3><p>æ¥çœ‹ä¸€ä¸‹è§„åˆ™æ–‡ä»¶éƒ½æœ‰ä»€ä¹ˆï¼Ÿ</p><p>æ–‡ä»¶ç»“æ„</p><pre><code class="js">// .dependency-cruiser.cjsmodule.exports = &#123;  forbidden: [ // è¢«ç¦æ­¢çš„è§„åˆ™åˆ—è¡¨    &#123;...&#125;, // è§„åˆ™1    &#123;...&#125;, // è§„åˆ™2    &#123;...&#125;, // è§„åˆ™3    // ...  ],  options: &#123; // å·¥å…·å±‚é¢çš„è‹¥å¹²é…ç½®   // ...  &#125;&#125;</code></pre><h3 id="è§„åˆ™å®šä¹‰"><a href="#è§„åˆ™å®šä¹‰" class="headerlink" title="è§„åˆ™å®šä¹‰"></a>è§„åˆ™å®šä¹‰</h3><pre><code class="json">&#123;  // ----- è§„åˆ™åŸºæœ¬é…ç½® -----  name: &#39;no-non-package-json&#39;, // è§„åˆ™åç§°  severity: &#39;error&#39;, // ä¸¥é‡ç­‰çº§  comment: &quot;This module depends on an npm package that isn&#39;t in the &#39;dependencies&#39; section of your package.json. &quot; +        &quot;That&#39;s problematic as the package either (1) won&#39;t be available on live (2 - worse) will be &quot; +        &#39;available on live with an non-guaranteed version. Fix it by adding the package to the dependencies &#39; +        &#39;in your package.json.&#39;, // è§„åˆ™æè¿°  // ----- è§„åˆ™å†…å®¹ -----  from: &#123;&#125;, // ä¸å¡«åˆ™è¡¨ç¤ºæ‰€æœ‰å¼•ç”¨ â˜ å“ªäº›æ¨¡å—ã€ç›®å½•ä¼šè¢«é™åˆ¶  to: &#123; // å‘½ä¸­å“ªäº›è§„åˆ™é™åˆ¶    dependencyTypes: [ // å‘½ä¸­çš„è§„åˆ™      &#39;npm-no-pkg&#39;,      &#39;npm-unknown&#39;,    ],    pathNot: [], // æ’é™¤æ‰å“ªäº›  &#125;,&#125;,</code></pre><p>from å’Œ to æè¿°è§„åˆ™çš„å…·ä½“å†…å®¹ï¼Œfrom è¡¨ç¤ºã€Œä¾èµ–æ–¹ã€ï¼Œto è¡¨ç¤ºã€Œè¢«ä¾èµ–æ–¹ã€ã€‚</p><h3 id="å¸¸ç”¨è§„åˆ™"><a href="#å¸¸ç”¨è§„åˆ™" class="headerlink" title="å¸¸ç”¨è§„åˆ™"></a>å¸¸ç”¨è§„åˆ™</h3><p>å¸¸ç”¨è§„åˆ™åŸºæœ¬éƒ½å·²é»˜è®¤å†…ç½®åœ¨ç”Ÿæˆçš„é…ç½®æ–‡ä»¶ä¸­ï¼Œæ ¹æ®éœ€è¦å»å¼€å¯ã€å…³é—­æˆ–ä¿®æ”¹åŒ¹é…èŒƒå›´ã€è§„åˆ™å³å¯ã€‚</p><ul><li><p>ç¦æ­¢å¾ªç¯å¼•ç”¨ no-circular</p></li><li><p>ç¦æ­¢å¼•ç”¨ä¸å­˜åœ¨çš„æ¨¡å—ï¼ˆå¹½çµä¾èµ–ï¼‰ not-to-unresolvable</p></li><li><p>æ£€æµ‹æœªè¢«ä½¿ç”¨çš„æ¨¡å— no-orphans</p></li><li><p>ç¦æ­¢ç”Ÿäº§ç¯å¢ƒä»£ç ä½¿ç”¨å¼€å‘ä¾èµ– not-to-dev-dep</p></li><li><p>â€¦â€¦</p></li></ul><h3 id="è‡ªå®šä¹‰è§„åˆ™"><a href="#è‡ªå®šä¹‰è§„åˆ™" class="headerlink" title="è‡ªå®šä¹‰è§„åˆ™"></a>è‡ªå®šä¹‰è§„åˆ™</h3><p>å€ŸåŠ©å¼ºå¤§çš„å¯é…ç½®èƒ½åŠ›ï¼Œå‡ ä¹å¯ä»¥åˆ¶å®šå‡ºä»»ä½•æƒ³è¦çš„ä¾èµ–é™åˆ¶è§„åˆ™ï¼Œä»¥ä¸‹ä¸¾å‡ ä¸ªæ —å­ã€‚</p><ol><li><p>æŒ‡å®šèŒƒå›´ç¦æ­¢å¼•ç”¨æŸäº›ä¸‰æ–¹æ¨¡å—</p><pre><code class="json">&#123;  name: &#39;not-to-import-src-node&#39;,  comment: &#39;src/node ç¦æ­¢å¼•ç”¨çš„æ¨¡å—&#39;,  severity: &#39;error&#39;,  // from: &#123;&#125;, // ä¸å¡«ï¼Œæ‰€æœ‰å¼•ç”¨  from: &#123;    path: &#39;^src/node&#39;,  &#125;,  to: &#123;    path: [      &#39;antd&#39;,      &#39;react-dnd&#39;,      &#39;react-dnd-html5-backend&#39;,      &#39;moment&#39;,    ],  &#125;,&#125;;</code></pre></li><li><p>ç¦æ­¢è·¨æ¨¡å—å¼•ç”¨</p><p>é™åˆ¶ src ä¸‹æŸä¸ªå¤§æ¨¡å—ï¼Œåªèƒ½å¼•ç”¨æ¨¡å—å†…éƒ¨ä¾èµ–æˆ–å…¬å…±æ¨¡å—</p><pre><code class="json">&#123;  // ----- è§„åˆ™åŸºæœ¬é…ç½® -----  name: &#39;no-cross-module-import&#39;,  severity: &#39;error&#39;, // ä¸¥é‡ç­‰çº§  comment: &#39;ç¦æ­¢è·¨æ¨¡å—å¼•ç”¨&#39;,  // ----- è§„åˆ™å†…å®¹ -----  from: &#123;    path: &#39;^src/pageA&#39;,  &#125;,  to: &#123;    pathNot: [      // åªèƒ½å¼•å…¥è‡ªå·±æˆ–å…¬å…±çš„æ¨¡å—      &#39;^src/pageA&#39;,      &#39;^src/utils&#39;,    ]  &#125;,&#125;,</code></pre></li><li><p>å¶å­ä¾èµ–ç¦æ­¢å†ä¾èµ–å…¶å®ƒæ¨¡å—</p><p>ä¾‹å¦‚ï¼Œé¡¹ç›®å°è£…äº†æŸä¸ªæ¨¡å—ï¼Œå®Œå…¨ä½¿ç”¨æµè§ˆå™¨åŸç”Ÿ APIï¼Œç¦æ­¢ä½¿ç”¨å…¶å®ƒç›¸å…³çš„ç¤¾åŒºä¾èµ–ï¼Œå¯ä»¥åšå¦‚ä¸‹é™åˆ¶ã€‚</p><pre><code class="json">&#123;  // ----- è§„åˆ™åŸºæœ¬é…ç½® -----  name: &#39;cookies-leaf&#39;,  comment: &#39;cookies åº“ä¸åº”è¯¥æœ‰å…¶å®ƒä¾èµ–&#39;,  severity: &#39;error&#39;,  // ----- è§„åˆ™å†…å®¹ -----  from: &#123;    path: &#39;^src/libs/cookies&#39;,  &#125;,  to: &#123;&#125;, // ä¸èƒ½å¼•ç”¨ä»»ä½•å…¶å®ƒä¾èµ–&#125;,</code></pre></li></ol><h3 id="é›†æˆåˆ°-NodeJS-è„šæœ¬"><a href="#é›†æˆåˆ°-NodeJS-è„šæœ¬" class="headerlink" title="é›†æˆåˆ° NodeJS è„šæœ¬"></a>é›†æˆåˆ° NodeJS è„šæœ¬</h3><p><a href="https://github.com/sverweij/dependency-cruiser/blob/develop/doc/api.md">https://github.com/sverweij/dependency-cruiser/blob/develop/doc/api.md</a></p><p>å¯¹äºä¸€äº›è¾ƒä¸ºå¤æ‚çš„é¡¹ç›®ï¼Œå°¤å…¶æœ‰è¯¸å¤šè§„åˆ™é™åˆ¶çš„é¡¹ç›®ï¼Œè€ƒè™‘å°†å…¶é›†æˆåˆ°è„šæœ¬ä¸­åšé»˜è®¤æ ¡éªŒä¼šï¼Œå°†æ˜¯ä¸€ä¸ªå¥½é€‰æ‹©ã€‚</p><pre><code class="typescript">import &#123; cruise &#125; from &quot;dependency-cruiser&quot;;import type &#123; IReporterOutput, ICruiseOptions &#125; from &quot;dependency-cruiser&quot;;const ARRAY_OF_FILES_AND_DIRS_TO_CRUISE: string[] = [&quot;src&quot;];const cruiseOptions: ICruiseOptions = &#123;  includeOnly: &quot;src&quot;,&#125;;try &#123;  const cruiseResult: IReporterOutput = cruise(    ARRAY_OF_FILES_AND_DIRS_TO_CRUISE,    cruiseOptions  );  console.dir(cruiseResult.output, &#123; depth: 10 &#125;);&#125; catch (error) &#123;  console.error(error);&#125;</code></pre><h2 id="å…¶å®ƒ"><a href="#å…¶å®ƒ" class="headerlink" title="å…¶å®ƒ"></a>å…¶å®ƒ</h2><ol><li><p>è·Ÿ ESLint æœ‰ä»€ä¹ˆåŒºåˆ«ä¹ˆï¼Ÿ</p><p>Aï¼šäºŒè€…æ²¡æœ‰ç›´æ¥è”ç³»ï¼Œä¸€èˆ¬æ¨èæ­é…èµ·æ¥ä¸€èµ·ä½¿ç”¨ã€‚eslint è´Ÿè´£ä»£ç æ£€æŸ¥ï¼Œdependency-cruiser è´Ÿè´£ä¾èµ–æ£€æŸ¥ã€‚</p></li><li><p>èƒ½é›†æˆåˆ° eslint ä¸­ï¼Œä½œä¸º eslint plugin ä½¿ç”¨ä¹ˆï¼Ÿ</p><p>Aï¼šæš‚æ—¶ä¸èƒ½</p><ul><li><p>ç›¸å…³è®¨è®ºï¼š<a href="https://github.com/sverweij/dependency-cruiser/issues/529">https://github.com/sverweij/dependency-cruiser/issues/529</a></p></li><li><p>æœ‰äººåšäº†å°è¯•ï¼š<a href="https://github.com/sverweij/eslint-plugin-budapestian">https://github.com/sverweij/eslint-plugin-budapestian</a></p></li></ul></li><li><p>èƒ½é›†æˆåˆ° webpack ç­‰ç¼–è¯‘å·¥å…·ä¸­ï¼Œè¾¾åˆ°ç¼–ç ä¸­è‡ªåŠ¨ watch åé¦ˆçš„ä½“éªŒä¹ˆï¼Ÿ</p><p>Aï¼šæš‚æ—¶ä¸èƒ½ã€‚ä¸»è¦æ˜¯æ€§èƒ½æ–¹é¢çš„è€ƒè™‘ï¼Œä¸å¤ªé€‚åˆæä¾›è¿™æ ·çš„èƒ½åŠ›ã€‚</p></li></ol><p>æ›´å¤šé—®é¢˜çš„å®˜æ–¹ FAQï¼š<a href="https://github.com/sverweij/dependency-cruiser/blob/develop/doc/faq.md">https://github.com/sverweij/dependency-cruiser/blob/develop/doc/faq.md</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>vscode è°ƒè¯•æŠ€å·§</title>
      <link href="/2022/02/23/vscode/dev/"/>
      <url>/2022/02/23/vscode/dev/</url>
      
        <content type="html"><![CDATA[<p>Web å¼€å‘ä¸­ï¼Œå¤§å¤šæ•°äººéƒ½ä¼šä¹ æƒ¯åœ¨æµè§ˆå™¨ç«¯è°ƒè¯•ä»£ç ï¼Œè€Œå€ŸåŠ© vscodeï¼Œå¯ä»¥å¸¦æ¥ä¸ä¸€æ ·çš„è°ƒè¯•ä½“éªŒï¼Œè¯•æƒ³åœ¨ä»£ç ç¼–å†™å¤„ï¼Œç›´æ¥æ‰“ä¸€ä¸ªæ–­ç‚¹ï¼Œå®æ—¶ debuggerï¼Œä½“éªŒæ˜¯ä¸æ˜¯æ›´é¡ºç•…äº†ä¸€ç‚¹ï¼Ÿ</p><p>ä»¥ä¸‹ç®€å•ä»‹ç»æ—¥å¸¸ SPA å•é¡µåº”ç”¨ã€nodejs åº”ç”¨çš„è°ƒè¯•ã€‚</p><h2 id="è°ƒè¯•-SPA-åº”ç”¨"><a href="#è°ƒè¯•-SPA-åº”ç”¨" class="headerlink" title="è°ƒè¯• SPA åº”ç”¨"></a>è°ƒè¯• SPA åº”ç”¨</h2><h3 id="launch-æ¨¡å¼"><a href="#launch-æ¨¡å¼" class="headerlink" title="launch æ¨¡å¼"></a>launch æ¨¡å¼</h3><p>1ã€é¡¹ç›®ä¸­æ·»åŠ è°ƒè¯•é…ç½®</p><p>æ“ä½œâ€œè¿è¡Œ - æ·»åŠ é…ç½®â€ï¼Œä¸‹æ‹‰é€‰æ‹© chrome è‡ªåŠ¨æ·»åŠ å³å¯ï¼Œæ ¹æ®éœ€è¦ä¿®æ”¹å‚æ•°å€¼</p><p>ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><pre><code class="JSON">&#123;  // ä½¿ç”¨ IntelliSense äº†è§£ç›¸å…³å±æ€§ã€‚  // æ‚¬åœä»¥æŸ¥çœ‹ç°æœ‰å±æ€§çš„æè¿°ã€‚  // æ¬²äº†è§£æ›´å¤šä¿¡æ¯ï¼Œè¯·è®¿é—®: https://go.microsoft.com/fwlink/?linkid=830387  &quot;version&quot;: &quot;0.2.0&quot;,  &quot;configurations&quot;: [    &#123;      &quot;name&quot;: &quot;Launch Chrome against localhost&quot;,      &quot;type&quot;: &quot;pwa-chrome&quot;,      &quot;request&quot;: &quot;launch&quot;,      // é»˜è®¤å¯åŠ¨ url      &quot;url&quot;: &quot;http://localhost:3000&quot;,      // æŒ‡å®šç»ˆç«¯      &quot;console&quot;: &quot;integratedTerminal&quot;,      &quot;webRoot&quot;: &quot;$&#123;workspaceFolder&#125;&quot;,      &quot;sourceMaps&quot;: true    &#125;  ]&#125;</code></pre><p>2ã€å¯åŠ¨åº”ç”¨</p><p>3ã€æŒ‰ <code>F5</code> å¯åŠ¨ vscode è°ƒè¯•ï¼Œå³å¯è‡ªåŠ¨æ‹‰èµ· chrome è®¿é—® urlï¼Œå¼€å§‹è°ƒè¯•ã€‚</p><h3 id="attach-æ¨¡å¼"><a href="#attach-æ¨¡å¼" class="headerlink" title="attach æ¨¡å¼"></a>attach æ¨¡å¼</h3><p>attach æ¨¡å¼ä¸ä¼šè‡ªåŠ¨æ‹‰èµ· chromeï¼Œå¯ä»¥è‡ªå·±é€‰æ‹©è®¿é—®ï¼Œç›¸æ¯” launch æ¨¡å¼è€Œè¨€ï¼Œè‡ªç”±åº¦æ›´é«˜ä¸€ç‚¹ï¼Œå¹¶ä¸”å·²å®‰è£…çš„æµè§ˆå™¨æ’ä»¶å¯ä»¥ä½¿ç”¨ï¼ˆlaunch æ¨¡å¼ä¸èƒ½ï¼‰ã€‚</p><p>1ã€é€šè¿‡ç»ˆç«¯å¯åŠ¨ chromeï¼ŒæŒ‡å®š vscode å’Œ chrome è°ƒè¯•è¿æ¥çš„ç«¯å£ï¼ˆ<code>--remote-debugging-port</code>ï¼‰ï¼Œä¸ä¸‹æ–¹é…ç½®ä¸­çš„ <code>port</code> ä¿æŒä¸€è‡´ã€‚</p><blockquote><p>å‘½ä»¤è¡Œå¯åŠ¨æ—¶ï¼Œå¦‚æœ chrome å·²ç»åœ¨è¿è¡Œï¼Œéœ€è¦ command + Q å…ˆé€€å‡ºã€‚</p></blockquote><pre><code class="Bash">/Applications/Google\ Chrome.app/Contents/MacOS/Google\ Chrome --remote-debugging-port=9222</code></pre><p>è‹¥æœªé€€å‡ºå·²æœ‰çš„ chromeï¼Œç›´æ¥å¯åŠ¨ä¼šå¤±è´¥ï¼Œéœ€è¦å…ˆé€€å‡ºå†å¯åŠ¨ã€‚</p><p>2ã€é¡¹ç›®ä¸­æ·»åŠ è°ƒè¯•é…ç½®</p><p>æ“ä½œâ€œè¿è¡Œ - æ·»åŠ é…ç½®â€ï¼Œä¸‹æ‹‰é€‰æ‹© chrome è‡ªåŠ¨æ·»åŠ å³å¯ï¼Œæ ¹æ®éœ€è¦ä¿®æ”¹å‚æ•°å€¼</p><p>ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><pre><code class="JSON">&#123;  // ä½¿ç”¨ IntelliSense äº†è§£ç›¸å…³å±æ€§ã€‚  // æ‚¬åœä»¥æŸ¥çœ‹ç°æœ‰å±æ€§çš„æè¿°ã€‚  // æ¬²äº†è§£æ›´å¤šä¿¡æ¯ï¼Œè¯·è®¿é—®: https://go.microsoft.com/fwlink/?linkid=830387  &quot;version&quot;: &quot;0.2.0&quot;,  &quot;configurations&quot;: [    &#123;      &quot;name&quot;: &quot;Attach to Chrome&quot;,      &quot;type&quot;: &quot;pwa-chrome&quot;,      &quot;request&quot;: &quot;attach&quot;,      // vscode ä¸ chrome è°ƒè¯•çš„ websocket ç«¯å£      &quot;port&quot;: 9222,      // æŒ‡å®šç»ˆç«¯      &quot;console&quot;: &quot;integratedTerminal&quot;,      &quot;webRoot&quot;: &quot;$&#123;workspaceFolder&#125;&quot;,      &quot;sourceMaps&quot;: true    &#125;  ]&#125;</code></pre><p>3ã€å¯åŠ¨åº”ç”¨</p><p>4ã€æŒ‰<code>F5</code> å¯åŠ¨ vscode è°ƒè¯•</p><p>5ã€åœ¨æµè§ˆå™¨æ­£å¸¸è®¿é—®åº”ç”¨ï¼Œå³å¯åœ¨ vscode ä¸­å¼€å§‹è°ƒè¯•</p><h2 id="è°ƒè¯•-nodejs-åº”ç”¨"><a href="#è°ƒè¯•-nodejs-åº”ç”¨" class="headerlink" title="è°ƒè¯• nodejs åº”ç”¨"></a>è°ƒè¯• nodejs åº”ç”¨</h2><p>1ã€é¡¹ç›®ä¸­æ·»åŠ è°ƒè¯•é…ç½®</p><p>æ“ä½œâ€œè¿è¡Œ - æ·»åŠ é…ç½®â€ï¼Œä¸‹æ‹‰é€‰æ‹© node è‡ªåŠ¨æ·»åŠ å³å¯ï¼Œæ ¹æ®éœ€è¦ä¿®æ”¹å‚æ•°å€¼</p><p>ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><pre><code class="JSON">&#123;  // ä½¿ç”¨ IntelliSense äº†è§£ç›¸å…³å±æ€§ã€‚  // æ‚¬åœä»¥æŸ¥çœ‹ç°æœ‰å±æ€§çš„æè¿°ã€‚  // æ¬²äº†è§£æ›´å¤šä¿¡æ¯ï¼Œè¯·è®¿é—®: https://go.microsoft.com/fwlink/?linkid=830387  &quot;version&quot;: &quot;0.2.0&quot;,  &quot;configurations&quot;: [    &#123;      &quot;type&quot;: &quot;pwa-node&quot;,      &quot;request&quot;: &quot;launch&quot;,      &quot;name&quot;: &quot;create-component-app&quot;,      &quot;console&quot;: &quot;integratedTerminal&quot;,      &quot;skipFiles&quot;: [&quot;&lt;node_internals&gt;/**&quot;],      // è¿è¡Œå½“å‰æ–‡ä»¶å¼€å§‹è°ƒè¯•      &quot;program&quot;: &quot;$&#123;file&#125;&quot;,      // æŒ‡å®šæŸä¸ªå…¥å£æ–‡ä»¶å¼€å§‹è°ƒè¯•      // &quot;program&quot;: &quot;$&#123;workspaceFolder&#125;/src/index.js&quot;    &#125;  ]&#125;</code></pre><p>2ã€æŒ‰<code>F5</code> å¼€å§‹è°ƒè¯•</p><h2 id="å¤‡æ³¨"><a href="#å¤‡æ³¨" class="headerlink" title="å¤‡æ³¨"></a>å¤‡æ³¨</h2><ol><li><p>å¦‚æœåº”ç”¨ä¸­åŒæ—¶é…ç½®äº†å¤šä¸ªè°ƒè¯•æ¨¡å¼ï¼Œå»ºè®®é€šè¿‡ç‚¹å‡»â€œè¿è¡Œå’Œè°ƒè¯•â€ï¼Œå…ˆé€‰æ‹©å¯åŠ¨æ¨¡å¼ï¼Œå†å»å¯åŠ¨è°ƒè¯•ã€‚</p></li><li><p>launch.json å‚æ•°</p></li></ol><ul><li><code>name</code> - å½“å‰è°ƒè¯•é…ç½®é¡¹çš„åç§°ï¼Œå¯è¯»æ€§è¦å¥½ï¼ŒåŒºåˆ†æ¯ä¸ªè°ƒè¯•é…ç½®é¡¹</li><li><code>type</code> - ç”¨äºæ­¤å¯åŠ¨é…ç½®çš„è°ƒè¯•å™¨çš„ç±»å‹ã€‚æ¯ä¸ªå·²å®‰è£…çš„è°ƒè¯•æ‰©å±•éƒ½å¼•å…¥ä¸€ç§ç±»å‹ï¼šä¾‹å¦‚ nodeï¼Œphpï¼Œgo ç­‰ã€‚</li><li><code>request</code> - å½“å‰è°ƒè¯•é¡¹çš„ç±»å‹ï¼Œç›®å‰æ”¯æŒ launch å’Œ attach ä¸¤ç§ç±»å‹ã€‚launch é€‚åˆè°ƒè¯•æœªå¯åŠ¨çš„ç¨‹åºï¼Œattach åˆ™é€‚åˆè°ƒè¯•å·²ç»è¿è¡Œçš„ç¨‹åºã€‚</li><li><code>program</code>- å¯åŠ¨è°ƒè¯•å™¨æ—¶è¦è¿è¡Œçš„å¯æ‰§è¡Œç¨‹åºæˆ–æ–‡ä»¶</li><li><code>args</code>- ä¼ é€’ç»™ç¨‹åºè¿›è¡Œè°ƒè¯•çš„å‚æ•°</li><li><code>env</code> - è°ƒè¯•æ—¶çš„ç¯å¢ƒå˜é‡</li><li><code>envFile</code> - åŒ…å«ç¯å¢ƒå˜é‡é”®å€¼å¯¹çš„æ–‡ä»¶</li><li><code>stopOnEntry</code> - ç¨‹åºå¯åŠ¨æ—¶ç«‹å³ä¸­æ–­</li><li><code>port</code> - è¿æ¥åˆ°æ­£åœ¨è¿è¡Œçš„è°ƒè¯•å™¨çš„ç«¯å£</li><li><code>runtimeExecutable</code> - å¯ç”¨è°ƒè¯•çš„å¯æ‰§è¡Œ Runtimeï¼Œé»˜è®¤æ˜¯ Node</li></ul><h2 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="headerlink" title="å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h2><p>æ›´å¤šå¼ºæ‚çš„è°ƒè¯•èƒ½åŠ›ï¼Œæ¨èé˜…è¯»ä¸‹æ–¹æ–‡æ¡£äº†è§£ã€‚</p><ol><li><a href="https://mp.weixin.qq.com/s/9gERuxNiJaWYUeie910ALA">è¿™å‡ ä¸ª JavaScript æ–­ç‚¹è°ƒè¯•æŠ€èƒ½ä½ æœ‰å¿…è¦æŒæ¡ï¼</a></li><li><a href="https://juejin.cn/post/6844904199805730823#heading-0">Node.js æ·±åº¦è°ƒè¯•æŒ‡å—</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> VSCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è°ƒè¯•ï¼Œvscodeï¼Œ nodejs </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Charles æŠ“åŒ…/ä»£ç† websocket è¯·æ±‚</title>
      <link href="/2021/05/29/charles/websocket/"/>
      <url>/2021/05/29/charles/websocket/</url>
      
        <content type="html"><![CDATA[<p>Charles ä¸­å¦‚ä½•æŠ“åŒ…ã€ä»£ç† websocket è¯·æ±‚ï¼Ÿè¿‡ç¨‹æœ‰äº›å¤æ‚ã€å‘ç‚¹é¢‡å¤šï¼Œè¿™é‡Œæä¾›ä¸€ä»½å¯ç”¨çš„æ–¹æ¡ˆã€‚</p><p>è¯·å…ˆç¡®ä¿ä½ çš„ charles èƒ½å¤ŸæŠ“åˆ°æµè§ˆå™¨çš„è¯·æ±‚ï¼Œé€šå¸¸ä½ å¯èƒ½éœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç±»é—®é¢˜ï¼š</p><ul><li>ç¡®ä¿å·²å‹¾é€‰ charles çš„ <code>Proxy - macOS Proxy</code> é€‰é¡¹</li><li>æµè§ˆå™¨æ¨èè®¾ç½®ä¸ºâ€œç³»ç»Ÿä»£ç†â€ï¼Œå¦‚æœä½¿ç”¨äº†æŸäº›æµè§ˆå™¨çš„ä»£ç†æ’ä»¶ï¼Œè¯·è®°å¾—åˆ‡æ¢</li><li>æ˜¯å¦å·²å®‰è£…å¥½ https è¯ä¹¦ï¼Ÿ</li><li>å¦‚æœæœ‰ä½¿ç”¨æŸäº› VPN ä»£ç†å·¥å…·ï¼Œå¯èƒ½ä¼šå­˜åœ¨ä»£ç†å†²çªã€‚å¦‚æœé‡åˆ°äº†æŠ“ä¸åˆ°è¯·æ±‚çš„é—®é¢˜ï¼Œæ¨èå…ˆå…³æ‰ VPN å·¥å…·ï¼Œéšåé‡å¯ charlesï¼ˆé‡å¯æ¯”è¾ƒé‡è¦ï¼Œå®ƒä¼šé‡ç½®ç³»ç»Ÿçš„ç½‘ç»œä»£ç†é…ç½®ï¼‰</li></ul><p>å¦‚æœè¿˜æœ‰é—®é¢˜ï¼Œæ¨èé˜…è¯»è¿™ç¯‡ä½¿ç”¨æŒ‡å— â˜ <a href="https://blog.csdn.net/mxw2552261/article/details/78645118">ä¼ é€é—¨</a>ã€‚</p><p>ä¿è¯èƒ½æ­£å¸¸æŠ“åˆ°è¯·æ±‚ï¼Œå†ç»§ç»­å‘ä¸‹å»çœ‹æ€ä¹ˆæŠ“å– websocketï¼Œå½“å‰ä½¿ç”¨çš„ charles ç‰ˆæœ¬æ˜¯ v4.6.1ã€‚</p><h2 id="charles-éœ€è¦å¼€å¯è‹¥å¹²è®¾ç½®"><a href="#charles-éœ€è¦å¼€å¯è‹¥å¹²è®¾ç½®" class="headerlink" title="charles éœ€è¦å¼€å¯è‹¥å¹²è®¾ç½®"></a>charles éœ€è¦å¼€å¯è‹¥å¹²è®¾ç½®</h2><p>1ã€æ‰“å¼€ Proxy - Proxy Settingsï¼Œå‹¾é€‰ Enable SOCKS proxyï¼Œé»˜è®¤é…ç½®ä¸å¿…ä¿®æ”¹ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="/imgs/charles_01.png" alt=""></p><p>2ã€åœ¨ Proxy - Proxy Settings - macos é¢æ¿ä¸­ï¼Œç¡®ä¿å‹¾é€‰ Use SOCKS proxyï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="/imgs/charles_02.png" alt=""></p><h2 id="Mac-çš„ç½‘ç»œè®¾ç½®ä¸­å‹¾é€‰è‹¥å¹²é¡¹"><a href="#Mac-çš„ç½‘ç»œè®¾ç½®ä¸­å‹¾é€‰è‹¥å¹²é¡¹" class="headerlink" title="Mac çš„ç½‘ç»œè®¾ç½®ä¸­å‹¾é€‰è‹¥å¹²é¡¹"></a>Mac çš„ç½‘ç»œè®¾ç½®ä¸­å‹¾é€‰è‹¥å¹²é¡¹</h2><p>ç¡®ä¿å‹¾é€‰äº† SOCKS é€‰é¡¹ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="/imgs/mac_01.png" alt=""></p><p><img src="/imgs/mac_02.png" alt=""></p><p>SOCKS ä»£ç†çš„ç«¯å£ 8889 æ˜¯ charles ä»£ç† websocket çš„é»˜è®¤ç«¯å£ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä¸è¦å»ä¿®æ”¹å®ƒã€‚</p><p>ä»¥ä¸Šå·¥ä½œéƒ½å®Œæˆï¼Œé‚£ä¹ˆä½ åº”è¯¥å¯ä»¥æ„‰å¿«åœ°æŠ“å–ã€ä»£ç† websockt è¯·æ±‚äº†ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Charles </category>
          
      </categories>
      
      
        <tags>
            
            <tag> websocket </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Apple M1 èŠ¯ç‰‡é—®é¢˜æ±‡æ€»</title>
      <link href="/2021/04/14/mac/command/"/>
      <url>/2021/04/14/mac/command/</url>
      
        <content type="html"><![CDATA[<h2 id="ä½¿ç”¨-Rosetta-æ‰“å¼€"><a href="#ä½¿ç”¨-Rosetta-æ‰“å¼€" class="headerlink" title="ä½¿ç”¨ Rosetta æ‰“å¼€"></a>ä½¿ç”¨ Rosetta æ‰“å¼€</h2><p><a href="https://www.macwk.com/article/apple-silicon-m1-application-crash-repair">https://www.macwk.com/article/apple-silicon-m1-application-crash-repair</a></p><h2 id="M1-Mac-nvm-å®‰è£…-å‡çº§-å¸è½½"><a href="#M1-Mac-nvm-å®‰è£…-å‡çº§-å¸è½½" class="headerlink" title="M1 Mac nvm å®‰è£…/å‡çº§/å¸è½½"></a>M1 Mac nvm å®‰è£…/å‡çº§/å¸è½½</h2><blockquote><p>æœ€å¥½èƒ½å¤Ÿç¿»å¢™ï¼Œå¹¶ä¸”è®¾ç½®ç»ˆç«¯å¯ç¿»å¢™ï¼Œå¦åˆ™é€Ÿåº¦å¤ªæ…¢å¯èƒ½æ–­æ‰ã€‚</p></blockquote><ol><li><p>å®‰è£…</p><p>å¯¹äº M1 èŠ¯ç‰‡çš„ Macï¼Œä½ç‰ˆæœ¬çš„ nvm ä½¿ç”¨å­˜åœ¨ä¸€äº›å¥‡æ€ªçš„é—®é¢˜ï¼Œéœ€è¦å¸è½½åé‡è£…æœ€æ–°ç‰ˆæœ¬ã€‚</p><pre><code class="zsh">curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.1/install.sh | bash</code></pre><p>å®‰è£…å®Œæˆåï¼Œä¿®æ”¹ zsh ç»ˆç«¯é…ç½®ï¼Œæ‰“å¼€é…ç½®æ–‡ä»¶ï¼š</p><pre><code class="zsh">open ~/.zshrc</code></pre><p>åœ¨é…ç½®æ–‡ä»¶å°¾éƒ¨ï¼Œæ·»åŠ å¦‚ä¸‹ä»£ç ï¼š</p><pre><code class="zsh">export NVM_DIR=&quot;$HOME/.nvm&quot;[ -s &quot;$NVM_DIR/nvm.sh&quot; ] &amp;&amp; \. &quot;$NVM_DIR/nvm.sh&quot;  # This loads nvm[ -s &quot;$NVM_DIR/bash_completion&quot; ] &amp;&amp; \. &quot;$NVM_DIR/bash_completion&quot;  # This loads nvm bash_completion</code></pre><p>ä¿å­˜åå…³é—­ï¼Œå¹¶åœ¨ç»ˆç«¯è¿è¡Œä¸‹å‘å‘½ä»¤ï¼Œè®©é…ç½®ç”Ÿæ•ˆã€‚</p><pre><code class="zsh">source ~/.zshrc</code></pre><p>å®‰è£…å·¥ä½œç»“æŸï¼</p></li><li><p>å‡çº§</p><p>åˆ‡æ¢åˆ° nvm å®‰è£…ç›®å½•</p><pre><code class="zsh">cd ~/.nvm</code></pre><p>ç›´æ¥æ“ä½œæ‹‰å–æœ€æ–°ä»£ç å³å¯</p><pre><code class="zsh">git fetch</code></pre></li><li><p>å¸è½½</p><p>ç§»é™¤ .nvm ç›®å½•å³å¯ï¼Œé€šå¸¸ä½ç½®åœ¨ <code>~/.nvm</code></p><pre><code class="zsh">rm -rf ~/.nvm</code></pre></li></ol><p>å‚è€ƒæ–‡ç« ï¼š<a href="https://blog.csdn.net/longgege001/article/details/114067242">https://blog.csdn.net/longgege001/article/details/114067242</a></p><h2 id="M1-Mac-nvm-ç»ˆç«¯åˆ‡æ¢-x86-arm"><a href="#M1-Mac-nvm-ç»ˆç«¯åˆ‡æ¢-x86-arm" class="headerlink" title="M1 Mac nvm ç»ˆç«¯åˆ‡æ¢ x86/arm"></a>M1 Mac nvm ç»ˆç«¯åˆ‡æ¢ x86/arm</h2><pre><code class="zsh"># Check what version you&#39;re running:$ node --versionv14.15.4# Check architecture of the `node` binary:$ node -p process.archarm64# This confirms that the arch is for the M1 chip, which is causing the problems.# So we need to uninstall it.# We can&#39;t uninstall the version we are currently using, so switch to another version:$ nvm install v12.20.1# Now uninstall the version we want to replace:$ nvm uninstall v14.15.4# Launch a new zsh process under the 64-bit X86 architecture:$ arch -x86_64 zsh# Install node using nvm. This should download the precompiled x64 binary:$ nvm install v14.15.4# Now check that the architecture is correct:$ node -p process.archx64# It is now safe to return to the arm64 zsh process:$ exit# We&#39;re back to a native shell:$ archarm64# And the new version is now available to use:$ nvm use v14.15.4Now using node v14.15.4 (npm v6.14.10)</code></pre>]]></content>
      
      
      <categories>
          
          <category> MacOS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MacOS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Git éå¸¸è§„é—®é¢˜è®°å½•</title>
      <link href="/2021/04/07/git/questions/"/>
      <url>/2021/04/07/git/questions/</url>
      
        <content type="html"><![CDATA[<h2 id="åŒºåˆ†ç›®å½•ã€remote-æŒ‡å®šä¸åŒè®¾ç½®"><a href="#åŒºåˆ†ç›®å½•ã€remote-æŒ‡å®šä¸åŒè®¾ç½®" class="headerlink" title="åŒºåˆ†ç›®å½•ã€remote æŒ‡å®šä¸åŒè®¾ç½®"></a>åŒºåˆ†ç›®å½•ã€remote æŒ‡å®šä¸åŒè®¾ç½®</h2><p>åœ¨åŒºåˆ†ä¼ä¸šä¸ä¸ªäººé¡¹ç›®çš„æäº¤ä¿¡æ¯æ—¶è¾ƒä¸ºå¸¸ç”¨</p><pre><code class="zsh"># æ¨èå•ç‹¬åˆ›å»ºé…ç½®æ–‡ä»¶touch ~/.gitconfig-xx</code></pre><p>ä¾‹å¦‚ï¼Œéœ€è¦å•ç‹¬è®¾ç½® username/user-email</p><pre><code class="shell">[user]    name = xx    email = xxx@gmail.com</code></pre><pre><code class="zsh"># æ‰“å¼€ Git é»˜è®¤çš„é…ç½®æ–‡ä»¶ï¼Œæ·»åŠ æŒ‡å®šç›®å½•ä¸‹çš„è§„åˆ™open ~/.gitconfig</code></pre><h3 id="åŒºåˆ†ç›®å½•è®¾ç½®"><a href="#åŒºåˆ†ç›®å½•è®¾ç½®" class="headerlink" title="åŒºåˆ†ç›®å½•è®¾ç½®"></a>åŒºåˆ†ç›®å½•è®¾ç½®</h3><p>ä¾‹å¦‚ï¼ŒæŒ‡å®š <code>~/xx/xx/</code> ç›®å½•ä½¿ç”¨ä¸Šæ–¹åˆ›å»ºçš„ <code>.gitconfig-xx</code> é…ç½®ï¼Œåˆ™åœ¨ <code>~/.gitconfig</code> æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹é…ç½®ï¼š</p><pre><code class="zsh">[includeIf &quot;gitdir:~/xx/xx/&quot;]  path = ~/.gitconfig-xx</code></pre><h3 id="å•ç‹¬è®¾ç½®-GitHub"><a href="#å•ç‹¬è®¾ç½®-GitHub" class="headerlink" title="å•ç‹¬è®¾ç½® GitHub"></a>å•ç‹¬è®¾ç½® GitHub</h3><p>è‹¥ä»…å¯¹ GitHub ä½¿ç”¨ä¸åŒé…ç½®ï¼Œæ¨èæ–°å»º <code>.gitconfig-github</code> é…ç½®æ–‡ä»¶ï¼Œåœ¨ <code>~/.gitconfig</code> æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹é…ç½®ï¼š</p><pre><code class="zsh">[includeIf &quot;hasconfig:remote.*.url:git@github.com:*/**&quot;]    path = ~/.gitconfig-github</code></pre><h3 id="å•ç‹¬è®¾ç½®ä¼ä¸šç§æœ‰-GitLab"><a href="#å•ç‹¬è®¾ç½®ä¼ä¸šç§æœ‰-GitLab" class="headerlink" title="å•ç‹¬è®¾ç½®ä¼ä¸šç§æœ‰ GitLab"></a>å•ç‹¬è®¾ç½®ä¼ä¸šç§æœ‰ GitLab</h3><p>è‹¥ä»…å¯¹æŸåŸŸåçš„ä¼ä¸šç§æœ‰ GitLab ä½¿ç”¨ä¸åŒé…ç½®ï¼Œæ¨èæ–°å»º <code>.gitconfig-xx</code> é…ç½®æ–‡ä»¶ï¼Œåœ¨ <code>~/.gitconfig</code> æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹é…ç½®ï¼š</p><pre><code class="zsh"># xx.xxx.com ä¸ºç¤ºä¾‹çš„ä¼ä¸šç§æœ‰åŸŸå[includeIf &quot;hasconfig:remote.*.url:git@xx.xxx.com:*/**&quot;]    path = ~/.gitconfig-xx</code></pre><h2 id="ä¸-fork-çš„ä¸Šæ¸¸ä»“åº“ä¿æŒåŒæ­¥"><a href="#ä¸-fork-çš„ä¸Šæ¸¸ä»“åº“ä¿æŒåŒæ­¥" class="headerlink" title="ä¸ fork çš„ä¸Šæ¸¸ä»“åº“ä¿æŒåŒæ­¥"></a>ä¸ fork çš„ä¸Šæ¸¸ä»“åº“ä¿æŒåŒæ­¥</h2><p>ä¸€èˆ¬æœ‰ 3 ç§åŠæ³•å¯ç”¨ï¼š</p><ol><li>å‘½ä»¤è¡ŒåŒæ­¥ï¼ˆå®‰å…¨ï¼Œæ¨èï¼‰</li></ol><pre><code class="zsh">git remote -v# å°†ä¸Šæ¸¸ä»“åº“æ·»åŠ è¿›æ¥git remote add upstream git@github.com:xxx/xxx.git# æ‹‰å–æ›´æ–°git fetch upstream# åˆå¹¶è¿‡æ¥git merge upstream/mastergit push origin master</code></pre><p>è‹¥å¹²å¯ä»¥æ³¨æ„çš„åœ°æ–¹ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="/imgs/git_fetch_fork_repo.png" alt=""></p><ol start="2"><li><p>å€ŸåŠ©ç¬¬ä¸‰æ–¹åº“ï¼š<a href="https://github.com/wei/pull">https://github.com/wei/pull</a> (å¦‚æœè‡ªå·±æœ‰ä¿®æ”¹ï¼Œä¼šè¢«è¦†ç›–ã€‚æ‰€ä»¥ï¼Œæ¯”è¾ƒé€‚åˆä»…å‚ä¸ PR çš„é¡¹ç›®åŒæ­¥)</p></li><li><p>å€ŸåŠ©æœºå™¨äººç¨‹åº Backstrokeï¼š<a href="https://github.com/backstrokeapp/server">https://github.com/backstrokeapp/server</a></p></li></ol><h2 id="æç¤º-hosts-é—®é¢˜"><a href="#æç¤º-hosts-é—®é¢˜" class="headerlink" title="æç¤º hosts é—®é¢˜"></a>æç¤º hosts é—®é¢˜</h2><pre><code class="zsh">Warning:Permanently added the RSA host key for IP address &#39;13.229.188.59&#39; to the list of known hosts.</code></pre><p>é‡åˆ°è¿™ç§æç¤ºï¼Œå¤šåŠæ˜¯å› ä¸ºæ–°æœºå™¨åˆšé…ç½®çš„ gitï¼Œæˆ–è€…å¸¸ç”¨çš„è¿œç¨‹ä»“åº“æ›´æ¢äº†åŸŸåã€IP ç­‰ã€‚</p><p>å¯ä»¥å°†å¯¹åº”çš„åŸŸåã€IP é…ç½®è¿›å»ï¼Œä¾‹å¦‚ï¼Œå°† github.com æ·»åŠ è¿›å»ï¼Œç¤ºä¾‹ï¼š</p><pre><code class="zsh">vi /etc/hostsinsert 13.229.188.59 github.com</code></pre><p>æˆ–è€…ï¼Œåˆ é™¤ host æ ¡éªŒ</p><pre><code class="zsh">rm -rf ~/.ssh/known_hosts # åˆ é™¤åé‡æ–°æ“ä½œå³å¯</code></pre><h2 id="Enter-passphrase-for-key-æ¯æ¬¡éƒ½éœ€è¦è¾“å…¥å¯†ç "><a href="#Enter-passphrase-for-key-æ¯æ¬¡éƒ½éœ€è¦è¾“å…¥å¯†ç " class="headerlink" title="Enter passphrase for key æ¯æ¬¡éƒ½éœ€è¦è¾“å…¥å¯†ç "></a>Enter passphrase for key æ¯æ¬¡éƒ½éœ€è¦è¾“å…¥å¯†ç </h2><pre><code class="zsh">ssh-add ~/.ssh/id_rsa</code></pre><h2 id="è®¾ç½®æŸæ–‡ä»¶ã€ç›®å½•ä¸è¢«è·Ÿè¸ª"><a href="#è®¾ç½®æŸæ–‡ä»¶ã€ç›®å½•ä¸è¢«è·Ÿè¸ª" class="headerlink" title="è®¾ç½®æŸæ–‡ä»¶ã€ç›®å½•ä¸è¢«è·Ÿè¸ª"></a>è®¾ç½®æŸæ–‡ä»¶ã€ç›®å½•ä¸è¢«è·Ÿè¸ª</h2><pre><code class="zsh">git update-index --assume-unchanged &lt;PATH&gt;</code></pre><p>å¯¹åº”çš„ï¼Œå…è®¸æŸæ–‡ä»¶ã€ç›®å½•è¢«è·Ÿè¸ª</p><pre><code class="zsh">git update-index --no-assume-unchanged &lt;PATH&gt;</code></pre>]]></content>
      
      
      <categories>
          
          <category> Git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>yarn workspaces ä¾èµ–å®‰è£…æŠ¥é”™</title>
      <link href="/2021/04/07/yarn/workspaces-version/"/>
      <url>/2021/04/07/yarn/workspaces-version/</url>
      
        <content type="html"><![CDATA[<p>yarn workspaces ç»“æ„çš„é¡¹ç›®ï¼Œåœ¨æ‰§è¡Œå‘½ä»¤å®‰è£…å­åŒ…ä¾èµ–æ—¶ï¼Œå¯èƒ½ä¼šçœ‹åˆ°å¦‚ä¸‹é”™è¯¯ï¼š</p><pre><code class="zsh">Failed to install dependencies in workspace: expected workspace package to exist</code></pre><p>yarn issues ä¸‹çš„ç›¸å…³é—®é¢˜è®¨è®ºï¼š<a href="https://github.com/yarnpkg/yarn/issues/7807">https://github.com/yarnpkg/yarn/issues/7807</a></p><p>ç›®å‰æ¯”è¾ƒç®€å•çš„å¤„ç†åŠæ³•æ˜¯é™çº§ yarn åˆ° v1.18.0</p><pre><code class="zsh">yarn policies set-version 1.18.0</code></pre><p>åç»­è¿˜éœ€è¦ç­‰å¾… yarn å®˜æ–¹æ¥è§£å†³æ­¤é—®é¢˜ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Yarn </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Yarn </tag>
            
            <tag> Yarn Workspaces </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€Œè½¬ã€H5ç›´æ’­æµåŸç†ä¸å®è·µæ–¹æ¡ˆ</title>
      <link href="/2021/03/28/video/live/"/>
      <url>/2021/03/28/video/live/</url>
      
        <content type="html"><![CDATA[<blockquote><p>è½¬è‡ª DuPei åŒå­¦çš„æ–‡æ¡£ï¼Œè¿™æ˜¯æ¯”è¾ƒå…¨é¢çš„æ–¹æ¡ˆè°ƒç ”ï¼Œè½¬è½½åˆ†äº«ç»™æ›´å¤šäººï¼Œå¾…å°†æ¥éœ€è¦æ—¶ç»†ç»†ç ”ç©¶ã€‚</p></blockquote><h2 id="HLS-æ–¹æ¡ˆ"><a href="#HLS-æ–¹æ¡ˆ" class="headerlink" title="HLS æ–¹æ¡ˆ"></a>HLS æ–¹æ¡ˆ</h2><p>HLS å…¨ç§° HTTP Live Streamingï¼Œé¡¾åæ€ä¹‰æ˜¯ä¸€ä¸ªåŸºäº HTTP çš„æµåª’ä½“ä¼ è¾“åè®®ã€‚æ˜¯ç”±è‹¹æœå…¬å¸æå‡ºï¼Œåœ¨è‹¹æœå®¶æ—çš„æ•´ä¸ªäº§å“éƒ½å¾—åˆ°äº†æ¯”è¾ƒå¥½çš„æ”¯æŒï¼Œåæ¥è°·æ­Œåœ¨ Chrome æµè§ˆå™¨å’Œç§»åŠ¨ç«¯æµè§ˆå™¨ä¹Ÿè¿›è¡Œäº†åŸç”Ÿæ”¯æŒï¼Œæ‰€ä»¥ç›®å‰æ— è®ºä½ æ˜¯åœ¨ PC è¿˜æ˜¯ç§»åŠ¨ç«¯çš„æµè§ˆå™¨åŸºæœ¬éƒ½åŸç”Ÿæ”¯æŒ HLS åè®®è¿›è¡Œæ’­æ”¾è§†é¢‘ï¼Œç®—æ˜¯ä¸€ä¸ªåœ¨ç§»åŠ¨ç«¯æ¯”è¾ƒå¥½çš„è·¨å¹³å°æ–¹æ¡ˆï¼ŒåŒæ—¶å¾®ä¿¡å†…åµŒçš„æµè§ˆå™¨ä¹Ÿéƒ½æ˜¯åŸç”Ÿæ”¯æŒçš„ã€‚</p><p>å®ƒå…è®¸ç”¨æˆ·ä»ä¸åŒçš„å¤‡ç”¨æºä»¥ä¸åŒçš„é€Ÿç‡ä¸‹è½½åŒæ ·çš„èµ„æºç‰‡æ®µã€‚å…è®¸æµåª’ä½“ä¼šè¯é€‚åº”ä¸åŒçš„æ•°æ®é€Ÿç‡ã€‚</p><h3 id="å·¥ä½œåŸç†"><a href="#å·¥ä½œåŸç†" class="headerlink" title="å·¥ä½œåŸç†"></a>å·¥ä½œåŸç†</h3><p>å®ƒçš„å·¥ä½œåŸç†æ˜¯æŠŠæ•´ä¸ªæµåˆ‡åˆ†æˆä¸€ç‰‡ç‰‡å°çš„åŸºäº HTTP çš„æ–‡ä»¶æ¥ä¸‹è½½ã€‚<br>æµè§ˆå™¨ä½¿ç”¨çš„æ˜¯ m3u8 æ–‡ä»¶ï¼Œå¯ä»¥ç®€å•çš„è®¤ä¸º m3u8 å°±æ˜¯åŒ…å«å¤šä¸ª ts æ–‡ä»¶çš„æ’­æ”¾åˆ—è¡¨ã€‚æ’­æ”¾å™¨æŒ‰é¡ºåºé€ä¸ªæ’­æ”¾ï¼Œå…¨éƒ¨æ”¾å®Œå†è¯·æ±‚ä¸€ä¸‹ m3u8 æ–‡ä»¶ï¼Œè·å¾—åŒ…å«æœ€æ–° ts æ–‡ä»¶çš„æ’­æ”¾åˆ—è¡¨ç»§ç»­æ’­ï¼Œå‘¨è€Œå¤å§‹ã€‚æ•´ä¸ªç›´æ’­è¿‡ç¨‹å°±æ˜¯ä¾é ä¸€ä¸ªä¸æ–­æ›´æ–°çš„ m3u8 å’Œä¸€å †å°çš„ ts æ–‡ä»¶ç»„æˆï¼Œm3u8 å¿…é¡»åŠ¨æ€æ›´æ–°ï¼Œts å¯ä»¥èµ° CDNã€‚</p><p><img src="/imgs/video_live_hls.png" alt=""></p><h3 id="æµè¯´æ˜"><a href="#æµè¯´æ˜" class="headerlink" title="æµè¯´æ˜"></a>æµè¯´æ˜</h3><p>åˆ‡ç‰‡æµï¼Œéœ€è¦ä¸æ–­å»è¯·æ±‚æ–°çš„ ts æ–‡ä»¶æ‰èƒ½ç»­æ’­ã€‚</p><ul><li>è§†é¢‘çš„å°è£…æ ¼å¼æ˜¯ TSã€‚</li><li>è§†é¢‘çš„ç¼–ç æ ¼å¼ä¸º H264,éŸ³é¢‘ç¼–ç æ ¼å¼ä¸º MP3ã€AAC æˆ–è€… AC-3ã€‚</li><li>é™¤äº† TS è§†é¢‘æ–‡ä»¶æœ¬èº«ï¼Œè¿˜å®šä¹‰äº†ç”¨æ¥æ§åˆ¶æ’­æ”¾çš„ m3u8 æ–‡ä»¶ï¼ˆæ–‡æœ¬æ–‡ä»¶ï¼‰</li></ul><p>m3u8 æ–‡ä»¶åŒ…å«çš„å†…å®¹å¦‚ä¸‹ï¼š</p><ul><li>EXTM3U<br>æ¯ä¸€ä¸ª m3u8 æ–‡ä»¶å¼€å¤´å¿…é¡»ä¸ºè¿™ä¸ª tagï¼Œç”¨ä½œæ ‡ç¤ºã€‚</li><li>EXT-X-VERSION<br>ç”¨äºæ ‡ç¤ºç‰ˆæœ¬ï¼Œå½“å‰ç‰ˆæœ¬ä¸º 3ï¼Œæœ‰ä¸”åªèƒ½æœ‰ä¸€ä¸ªï¼Œé»˜è®¤ä¸º 1ã€‚</li><li>EXT-X-TARGETDURATION<br>æ¯ä¸€ç‰‡çš„æœ€å¤§é•¿åº¦ï¼Œéƒ¨åˆ† iphone è®¾å¤‡æ­¤å‚æ•°ä¸æ­£ç¡®ä¼šå¯¼è‡´æ— æ³•æ’­æ”¾ã€‚</li><li>EXT-X-MEDIA-SEQUENCE<br>åˆ‡ç‰‡çš„å¼€å§‹åºå·ï¼Œä¸”æ¯ä¸€ç‰‡çš„åºå·å…·æœ‰å”¯ä¸€æ€§ï¼Œç›¸é‚»åºå·é€’å¢ä»¥ä¿æŒæµçš„è¿ç»­æ€§ã€‚</li><li>EXTINF<br>åˆ‡ç‰‡çš„å®é™…æ—¶é•¿ã€‚</li><li>EXT-X-PLAYLIST-TYPE<br>ç±»å‹</li><li>EXT-X-ENDLIST<br>ç»“æŸç¬¦å·ã€‚</li></ul><h3 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h3><p>å…¼å®¹æ€§å¾ˆä¸é”™ï¼Œå°¤å…¶æ˜¯åœ¨ç§»åŠ¨ç«¯ï¼Œå¯ä½œä¸ºå…œåº•æ–¹æ¡ˆã€‚</p><h3 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h3><ol><li>å»¶æ—¶æ¯”è¾ƒå¤§ã€‚ç”±äº HLS åè®®æœ¬èº«çš„åˆ‡ç‰‡åŸç†ï¼ŒåŸºæœ¬å»¶è¿Ÿéƒ½åœ¨ 10s ä»¥ä¸Šã€‚</li><li>æ–‡ä»¶ç¢ç‰‡ï¼Œts åˆ‡ç‰‡è¾ƒå°ï¼Œä¼šé€ æˆæµ·é‡æ–‡ä»¶ï¼Œå¯¹å­˜å‚¨å’Œç¼“å­˜éƒ½æœ‰ä¸€å®šçš„æŒ‘æˆ˜ã€‚</li></ol><h2 id="HTTP-FLV-æ–¹æ¡ˆ"><a href="#HTTP-FLV-æ–¹æ¡ˆ" class="headerlink" title="HTTP FLV æ–¹æ¡ˆ"></a>HTTP FLV æ–¹æ¡ˆ</h2><p>HTTP-FLV å³å°†æµåª’ä½“æ•°æ®å°è£…æˆ FLV æ ¼å¼ï¼Œç„¶åé€šè¿‡ HTTP åè®®ä¼ è¾“ç»™å®¢æˆ·ç«¯ã€‚</p><p>æ’­æ”¾çš„èƒ½åŠ›åŸºäº Media Source Extensions(MSE)ï¼Œæ˜¯ä¸€ä¸ª W3C è‰æ¡ˆï¼ŒMSE æ‰©å±•äº† HTML5 çš„ Video å’Œ Audio æ ‡ç­¾èƒ½åŠ›ï¼Œå…è®¸å¼€å‘è€…é€šè¿‡ JS æ¥ä»æœåŠ¡ç«¯æ‹‰æµæä¾›åˆ° HTML5 çš„ Video å’Œ Audio æ ‡ç­¾è¿›è¡Œæ’­æ”¾ã€‚</p><p><a href="https://caniuse.com/?search=Media%20Source%20Extensions">ç›®å‰ MSE çš„å…¼å®¹æƒ…å†µ</a></p><h3 id="å·¥ä½œåŸç†-1"><a href="#å·¥ä½œåŸç†-1" class="headerlink" title="å·¥ä½œåŸç†"></a>å·¥ä½œåŸç†</h3><p>MSE ç›®å‰æ”¯æŒçš„è§†é¢‘å°è£…æ ¼å¼æ˜¯ MP4ï¼Œæ”¯æŒçš„è§†é¢‘ç¼–ç æ˜¯ H.264 å’Œ MPEG4ï¼Œæ”¯æŒçš„éŸ³é¢‘ç¼–ç æ˜¯ AAC å’Œ MP3ã€‚<br>å°è£…æ ¼å¼çš„å¤„ç†</p><ol><li>ä»æœåŠ¡ç«¯æ‹‰è£¸æµ(flv)è¿‡æ¥ï¼Œåœ¨å‰ç«¯å°† flv åˆæˆ MP4 ç‰‡æ®µè¿›è¡Œæ’­æ”¾ã€‚</li><li>åœ¨æœåŠ¡ç«¯æå‰è½¬å°è£…å¥½æˆ MP4 æ ¼å¼ä¼ è¾“ï¼Œåœ¨å‰ç«¯ç›´æ¥é€šè¿‡ MSE æ¥å£æ¥æ’­æ”¾ã€‚</li></ol><h3 id="æµè¯´æ˜-1"><a href="#æµè¯´æ˜-1" class="headerlink" title="æµè¯´æ˜"></a>æµè¯´æ˜</h3><p>è¿ç»­æµã€‚</p><p>ä¸€èˆ¬æ–¹æ¡ˆéƒ½æ˜¯æœåŠ¡ç«¯ç»æ‘„åƒå¤´æ¨æµè½¬æˆ FLVï¼Œç„¶åå®¢æˆ·ç«¯æ‹‰æµï¼Œæ‹‰è¿‡æ¥çš„æµè§£å°è£…ä¸º FLVï¼Œç„¶åå†è½¬æˆ MP4 ç‰‡æ®µï¼Œå†ç»ç”± MSE æ’­æ”¾å³å¯ã€‚<br>è¿™ä¸ªè§£å°è£…å’Œè½¬ä¸º mp4 æ ¼å¼çš„è¿‡ç¨‹ï¼Œ<a href="https://github.com/bilibili/flv.js">flv.js</a> å¸®å¿™å®ç°äº†ã€‚</p><h3 id="ä¼˜ç‚¹-1"><a href="#ä¼˜ç‚¹-1" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h3><p>å»¶æ—¶ä½ã€‚</p><h3 id="ç¼ºç‚¹-1"><a href="#ç¼ºç‚¹-1" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h3><p>ç§»åŠ¨ç«¯çš„å…¼å®¹æ€§ä¸å¥½ï¼ŒiOS Safari æµè§ˆå™¨æ²¡æœ‰æ”¯æŒï¼Œéƒ¨åˆ†ä½ç‰ˆæœ¬çš„ iOS å¾®ä¿¡ç«¯ä¹Ÿä¸æ”¯æŒã€‚</p><h2 id="RTMP-æ–¹æ¡ˆ"><a href="#RTMP-æ–¹æ¡ˆ" class="headerlink" title="RTMP æ–¹æ¡ˆ"></a>RTMP æ–¹æ¡ˆ</h2><p>Real Time Messaging Protocolï¼ˆç®€ç§° RTMPï¼‰æ˜¯ Macromedia å¼€å‘çš„ä¸€å¥—è§†é¢‘ç›´æ’­åè®®ï¼Œç°åœ¨å±äº Adobeã€‚</p><p>åŸºäº TCP åè®®ä¼ è¾“ï¼Œè¿™å¥—æ–¹æ¡ˆéœ€è¦æ­å»ºä¸“é—¨çš„ RTMP æµåª’ä½“æœåŠ¡å¦‚ Adobe Media Serverï¼Œå¹¶ä¸”åœ¨æµè§ˆå™¨ä¸­åªèƒ½ä½¿ç”¨ Flash å®ç°æ’­æ”¾å™¨ã€‚å®ƒçš„å®æ—¶æ€§éå¸¸å¥½ï¼Œå»¶è¿Ÿå¾ˆå°ï¼Œ<strong>ä½†æ— æ³•æ”¯æŒç§»åŠ¨ç«¯ WEB æ’­æ”¾æ˜¯å®ƒçš„ç¡¬ä¼¤</strong>ã€‚</p><p>æµè§ˆå™¨ç«¯ï¼ŒHTML5 video æ ‡ç­¾æ— æ³•æ’­æ”¾ RTMP åè®®çš„è§†é¢‘ï¼Œå¯ä»¥é€šè¿‡ video.js æ¥å®ç°ã€‚<a href="https://blog.csdn.net/impingo/article/details/103077380?spm=1001.2014.3001.5502">https://blog.csdn.net/impingo/article/details/103077380?spm=1001.2014.3001.5502</a></p><h2 id="ä»¥ä¸Šä¸‰ç§æ–¹æ¡ˆæ¯”è¾ƒ"><a href="#ä»¥ä¸Šä¸‰ç§æ–¹æ¡ˆæ¯”è¾ƒ" class="headerlink" title="ä»¥ä¸Šä¸‰ç§æ–¹æ¡ˆæ¯”è¾ƒ"></a>ä»¥ä¸Šä¸‰ç§æ–¹æ¡ˆæ¯”è¾ƒ</h2><table><thead><tr><th></th><th>Http flv</th><th>rtmp</th><th>hls</th></tr></thead><tbody><tr><td>ä¼ è¾“åè®®</td><td>http</td><td>tcp</td><td>http</td></tr><tr><td>è§†é¢‘å°è£…æ ¼å¼</td><td>flv</td><td>Flv tag</td><td>ts</td></tr><tr><td>å»¶æ—¶</td><td>ä½</td><td>ä½</td><td>é«˜</td></tr><tr><td>æ•°æ®åˆ†æ®µ</td><td>è¿ç»­æµ</td><td>è¿ç»­æµ</td><td>åˆ‡ç‰‡æ–‡ä»¶</td></tr><tr><td>Html5 æ’­æ”¾</td><td>å¯é€šè¿‡ h5 è§£å°æ•°æ®åŒ…æ’­æ”¾ flv.js</td><td>ä¸æ”¯æŒ</td><td>å¯é€šè¿‡ h5 è§£å°æ•°æ®åŒ…æ’­æ”¾ hls.js</td></tr></tbody></table><h2 id="å…¶å®ƒæ–¹æ¡ˆ"><a href="#å…¶å®ƒæ–¹æ¡ˆ" class="headerlink" title="å…¶å®ƒæ–¹æ¡ˆ"></a>å…¶å®ƒæ–¹æ¡ˆ</h2><h3 id="WebRTC-æ–¹æ¡ˆ"><a href="#WebRTC-æ–¹æ¡ˆ" class="headerlink" title="WebRTC æ–¹æ¡ˆ"></a>WebRTC æ–¹æ¡ˆ</h3><p>WebRTC æ˜¯ä¸€æ•´å¥— APIï¼Œå…¶ä¸­ä¸€éƒ¨åˆ†ä¾› Web å¼€å‘è€…ä½¿ç”¨ï¼Œå¦å¤–ä¸€éƒ¨åˆ†å±äºè¦æ±‚æµè§ˆå™¨å‚å•†å®ç°çš„æ¥å£è§„èŒƒã€‚WebRTC è§£å†³è¯¸å¦‚å®¢æˆ·ç«¯æµåª’ä½“å‘é€ã€ç‚¹å¯¹ç‚¹é€šä¿¡ã€è§†é¢‘ç¼–ç ç­‰é—®é¢˜ã€‚<br>æ¡Œé¢æµè§ˆå™¨å¯¹ WebRTC çš„æ”¯æŒè¾ƒå¥½ï¼ŒWebRTC ä¹Ÿå¾ˆå®¹æ˜“å’Œ Native åº”ç”¨é›†æˆã€‚</p><h3 id="WebSocket-FLV"><a href="#WebSocket-FLV" class="headerlink" title="WebSocket-FLV"></a>WebSocket-FLV</h3><p>åŸºäº WebSocket ä¼ è¾“ FLVï¼Œä¾èµ–æµè§ˆå™¨æ”¯æŒæ’­æ”¾ FLVã€‚<br>WebSocket å»ºç«‹åœ¨ HTTP ä¹‹ä¸Šï¼Œå»ºç«‹ WebSocket è¿æ¥å‰è¿˜è¦å…ˆå»ºç«‹ HTTP è¿æ¥ã€‚</p><h3 id="RTP"><a href="#RTP" class="headerlink" title="RTP"></a>RTP</h3><p>åŸºäº UDPï¼Œå»¶è¿Ÿ 1 ç§’ï¼Œæµè§ˆå™¨ä¸æ”¯æŒã€‚</p><h2 id="æ¸…æ™°åº¦åˆ‡æ¢æ”¯æŒ"><a href="#æ¸…æ™°åº¦åˆ‡æ¢æ”¯æŒ" class="headerlink" title="æ¸…æ™°åº¦åˆ‡æ¢æ”¯æŒ"></a>æ¸…æ™°åº¦åˆ‡æ¢æ”¯æŒ</h2><p><a href="https://cloud.tencent.com/document/product/454/7503#.E5.8A.9F.E8.83.BD.E4.BB.8B.E7.BB.8D">æ¸…æ™°åº¦åˆ‡æ¢æ”¯æŒ</a></p><p><strong>æ’­æ”¾å™¨æœ¬èº«æ˜¯æ²¡æœ‰èƒ½åŠ›å»æ”¹å˜è§†é¢‘æ¸…æ™°åº¦çš„</strong>ï¼Œè§†é¢‘æºåªæœ‰ä¸€ç§æ¸…æ™°åº¦ï¼Œç§°ä¹‹ä¸ºåŸç”»ï¼Œè€ŒåŸç”»è§†é¢‘çš„ç¼–ç æ ¼å¼å’Œå°è£…æ ¼å¼å¤šç§ï¼ŒWeb ç«¯æ— æ³•æ”¯æŒæ’­æ”¾æ‰€æœ‰çš„è§†é¢‘æ ¼å¼ï¼Œå¦‚ç‚¹æ’­æ”¯æŒä»¥ H.264 ä¸ºè§†é¢‘ç¼–ç ï¼ŒMP4 å’Œ FLV ä¸ºå°è£…æ ¼å¼çš„è§†é¢‘ã€‚</p><p>å¤šæ¸…æ™°åº¦çš„å®ç°ä¾èµ–äºæœåŠ¡ç«¯ï¼Œè¿›è¡Œå®æ—¶è½¬ç ï¼Œåˆ†å‡ºå¤šè·¯è½¬ç åçš„è§†é¢‘ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Video </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç›´æ’­ </tag>
            
            <tag> Video </tag>
            
            <tag> Live </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¦‚ä½•ç®¡ç†åº”ç”¨å†…çš„è¯·æ±‚?</title>
      <link href="/2021/03/27/react/query/"/>
      <url>/2021/03/27/react/query/</url>
      
        <content type="html"><![CDATA[<p>å¦‚ä½•ç®¡ç†åº”ç”¨å†…çš„æ¥å£è¯·æ±‚ï¼Ÿ</p><p>è¿™æ˜¯ä¸€ä¸ªå€¼å¾—è®¨è®ºçš„é—®é¢˜ï¼Œæ¶‰åŠå¦‚ä¸‹è‹¥å¹²æ–¹é¢ï¼š</p><ol><li>é¿å…å¤šæ¬¡è°ƒç”¨åŒä¸€ä¸ªè¯·æ±‚ï¼ˆä¸åŒé¡µé¢æˆ–ä¸åŒç»„ä»¶ï¼‰ï¼Ÿ</li><li>å¤±è´¥äº†è‡ªåŠ¨é‡è¯•ï¼Ÿ</li><li>åˆ‡æ¢æµè§ˆå™¨ tab è¿”å›é¡µé¢æ—¶ï¼Œè‡ªåŠ¨å‘é€è¯·æ±‚æ›´æ–°æ•°æ®ï¼Ÿ</li><li>åˆ—è¡¨æ»šåŠ¨ä½ç½®æ¢å¤ï¼Ÿ</li><li>â€¦â€¦.</li></ol><p>è¿™äº›é—®é¢˜å¯ä»¥åœ¨ä»¥ä¸‹å‡ ä¸ªç¤¾åŒºæ–¹æ¡ˆé‡Œæ‰¾åˆ°ç­”æ¡ˆï¼ˆreact-query ä¼¼ä¹æ›´èƒœä¸€ç­¹ï¼‰ï¼š</p><ul><li>reacrt-queryï¼š<a href="https://zhuanlan.zhihu.com/p/261146977">https://zhuanlan.zhihu.com/p/261146977</a></li><li>swrï¼š<a href="https://swr.vercel.app/zh-CN">https://swr.vercel.app/zh-CN</a></li><li>ahooks/useRequestï¼š<a href="https://ahooks.js.org/zh-CN/hooks/async">https://ahooks.js.org/zh-CN/hooks/async</a></li></ul><p>è®¸å¤šäººä¼šå°†å¤šå¤„ä½¿ç”¨çš„æ¥å£æ•°æ®ï¼Œå­˜å‚¨åˆ° Redux ç­‰å…¨å±€çŠ¶æ€å»ç®¡ç†ï¼Œä»¥å‡å°‘é‡å¤çš„è¯·æ±‚ã€‚ç†è®ºä¸Šæ¥è¯´è¿™æ˜¯ä¸åˆç†çš„ï¼ŒçŠ¶æ€ç®¡ç†ä¼šå› æ­¤è€Œå˜å¾—æ··ä¹±ã€è‡ƒè‚¿ï¼Œä¹Ÿç»™ä»£ç ç¼–å†™å¸¦æ¥äº†é¢å¤–çš„è´Ÿæ‹…ã€‚</p><p>ä½¿ç”¨ä»¥ä¸Šæ–¹æ¡ˆåï¼Œç±»åº“å†…éƒ¨è‡ªåŠ¨ç®¡ç†æ¥å£æ•°æ®çš„çŠ¶æ€ï¼Œæš‚ä¸”ç§°ä¹‹ä¸ºâ€œæœåŠ¡ç«¯çŠ¶æ€â€ï¼Œåœ¨ä»»æ„çš„é¡µé¢ã€ç»„ä»¶éƒ½å¯ä»¥ä¿æŒç›¸åŒçš„ Hooks æ–¹å¼è°ƒç”¨ï¼Œè€Œå…¨å±€åªä¼šå‘é€ä¸€æ¬¡è¯·æ±‚ï¼Œå› æ­¤ï¼ŒçŠ¶æ€ç®¡ç†éœ€è¦å­˜å‚¨çš„æ•°æ®å¯ä»¥å¤§å¹…å‡å°‘ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰è‡ªåŠ¨é‡è¯•ã€åˆ‡å±æ›´æ–°æ•°æ®ç­‰å¼ºå¤§çš„å°è£…åŠŸèƒ½ï¼Œæ˜¯æ—¥å¸¸åº”ç”¨å¼€å‘çš„åˆ©å™¨ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> React </category>
          
      </categories>
      
      
        <tags>
            
            <tag> React </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Babel ç¼–è¯‘è¯¯ä¼¤ core-jsï¼Ÿ</title>
      <link href="/2021/03/26/core-js/babel-compile/"/>
      <url>/2021/03/26/core-js/babel-compile/</url>
      
        <content type="html"><![CDATA[<p>ä¸€ä¸ªä¸å¤ªå¸¸è§ï¼Œä½†å¾ˆé‡è¦çš„ core-js bug è®¨è®ºï¼š<a href="https://github.com/zloirock/core-js/issues/514">https://github.com/zloirock/core-js/issues/514</a></p><h2 id="é—®é¢˜ç°è±¡"><a href="#é—®é¢˜ç°è±¡" class="headerlink" title="é—®é¢˜ç°è±¡"></a>é—®é¢˜ç°è±¡</h2><p>core-js æ˜¯ es3 çš„ä»£ç ï¼Œåº”å½“æ˜¯ä¸éœ€è¦ babel ç¼–è¯‘çš„ï¼Œä½†æ˜¯ï¼Œå› ä¸ºæŸç§åŸå› ï¼ˆæš‚ä¸æ¸…æ¥šï¼‰ï¼Œbabel ä¼šå¯¹ core-js è¿›è¡Œå¤„ç†ï¼Œå¹¶ä¸”ä¼šå½±å“å…¶ä¸­çš„ä»£ç ï¼Œè¿›è€Œä¼šå‘ç° Symbol åœ¨ Android 6.0 ç­‰ä½ç‰ˆæœ¬æµè§ˆå™¨çš„å…¼å®¹æ€§å‡ºé—®é¢˜ã€‚</p><p>åœ¨ç§»åŠ¨ç«¯é¡µé¢ï¼Œå°ä¼™ä¼´å®é™…é­é‡åˆ°äº†è¿™ç§ç°è±¡ï¼Œä¾èµ–çš„ç¬¬ä¸‰æ–¹åŒ…ä½¿ç”¨äº† Symbol è¯­æ³•ï¼Œå³ä½¿å¼•å…¥å…¨é‡çš„ core-jsï¼Œä¾ç„¶æ— æ³•è§£å†³å…¼å®¹æ€§æŠ¥é”™é—®é¢˜ï¼Œæœ€ç»ˆå°ä¼™ä¼´è¿½è¸ªåˆ°äº†ä¸Šæ–¹çš„ github issuesã€‚</p><h2 id="è§£å†³åŠæ³•"><a href="#è§£å†³åŠæ³•" class="headerlink" title="è§£å†³åŠæ³•"></a>è§£å†³åŠæ³•</h2><p>æš‚æ—¶éœ€è¦æ‰‹åŠ¨å°† core-js æ·»åŠ åˆ° <code>babel-loader</code> çš„ <code>exclude</code> é…ç½®ä¸­ï¼ŒæŒ‡å®š babel ä¸è¦å»å¤„ç†å®ƒã€‚</p><pre><code class="js">/** * Babel ç¼–è¯‘æ—¶ï¼Œä¼šå¤„ç† core-jsï¼ˆæœªæ¥å¯èƒ½ä¼šè¢«ä¿®å¤ï¼‰ï¼Œ * å¯¼è‡´ polyfill å†…éƒ¨ä»£ç å‘ç”Ÿäº†å˜åŒ–ï¼Œäº§ç”Ÿä¸€äº›å¾®å°çš„å½±å“ï¼Œå¦‚ Symbol é—®é¢˜ã€‚ * æš‚æ—¶æˆ‘ä»¬æ‰‹åŠ¨å£°æ˜ç•¥è¿‡ã€‚ * https://github.com/zloirock/core-js/issues/514 * https://github.com/rails/webpacker/pull/2031 */exclude: [  /node_modules[\\/]core-js/,],</code></pre>]]></content>
      
      
      <categories>
          
          <category> Babel </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Babel </tag>
            
            <tag> Webpack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ—  eject é‡å†™ CRA é…ç½® â€” Craco è¯¦è§£</title>
      <link href="/2020/09/11/cra/craco/"/>
      <url>/2020/09/11/cra/craco/</url>
      
        <content type="html"><![CDATA[<blockquote><p>å†…ç½® craco æ‰©å±•é…ç½®çš„ CRA Templateï¼Œå¯ç›´æ¥ä½¿ç”¨ã€‚<br>TS ç‰ˆæœ¬ï¼š<a href="https://www.npmjs.com/package/@eleven.fe/cra-template-typescript">@eleven.fe/cra-template-typescript</a><br>ES ç‰ˆæœ¬ï¼š<a href="https://www.npmjs.com/package/@eleven.fe/cra-template">@eleven.fe/cra-template</a></p></blockquote><p>ä½¿ç”¨ CRA è„šæ‰‹æ¶åˆ›å»ºçš„é¡¹ç›®ï¼Œå¦‚æœæƒ³è¦ä¿®æ”¹ç¼–è¯‘é…ç½®ï¼Œé€šå¸¸å¯èƒ½ä¼šé€‰æ‹© <code>npm run eject</code> å¼¹å‡ºé…ç½®åé­”æ”¹ã€‚ä½†æ˜¯ï¼Œeject æ˜¯ä¸å¯é€†æ“ä½œï¼Œå¼¹å‡ºé…ç½®åï¼Œä½ å°†æ— æ³•è·Ÿéšå®˜æ–¹çš„è„šæ­¥å»å‡çº§é¡¹ç›®çš„ react-scripts ç‰ˆæœ¬ã€‚</p><p>å¦‚æœæƒ³è¦æ—  eject é‡å†™ CRA é…ç½®ï¼Œä¸€èˆ¬å¯ä»¥æœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼</p><ol><li>é€šè¿‡ CRA å®˜æ–¹æ”¯æŒçš„ <code>--scripts-version</code> å‚æ•°ï¼Œåˆ›å»ºé¡¹ç›®æ—¶ä½¿ç”¨è‡ªå·±é‡å†™è¿‡çš„ react-scripts åŒ…</li><li>ä½¿ç”¨ <a href="https://github.com/timarney/react-app-rewired">react-app-rewired</a> + <a href="https://github.com/arackaf/customize-cra">customize-cra</a> ç»„åˆè¦†ç›–é…ç½®</li><li>ä½¿ç”¨ <a href="https://github.com/gsoft-inc/craco">craco</a> è¦†ç›–é…ç½®</li></ol><p>ç¬¬ä¸€ç§æ–¹å¼å¾ˆæ£’ï¼Œä½†è¿™é‡Œæš‚æ—¶ä¸åšè®¨è®ºï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥ä»ä¸‹æ–¹é“¾æ¥äº†è§£æ›´å¤šï¼š</p><ol><li>CRA å®˜æ–¹çš„ä»‹ç»ï¼š<a href="https://create-react-app.dev/docs/alternatives-to-ejecting/">Alternatives to Ejecting</a></li><li><a href="https://auth0.com/blog/how-to-configure-create-react-app/">Customizing create-react-app: How to Make Your Own Template</a></li></ol><p>ç¬¬äºŒç§æ–¹å¼ç›¸å¯¹ç¬¬ä¸‰ç§ç•¥å¤æ‚ä¸€äº›ï¼Œå¹¶ä¸”æˆ‘æ³¨æ„åˆ° AntDesign å®˜æ–¹ä¹Ÿå¼€å§‹æ¨è <a href="https://github.com/gsoft-inc/craco">craco</a> äº†ï¼Œè¿™é‡Œè¯¦ç»†è®¨è®ºä¸€ä¸‹ç¬¬ä¸‰ç§ <a href="https://github.com/gsoft-inc/craco">craco</a> çš„ä½¿ç”¨ï¼Œç»è¿‡é¡¹ç›®çš„å®æµ‹ï¼Œç”¨èµ·æ¥è¿˜ç®—é¡ºæ‰‹ã€‚</p><h2 id="åŸºç¡€é…ç½®"><a href="#åŸºç¡€é…ç½®" class="headerlink" title="åŸºç¡€é…ç½®"></a>åŸºç¡€é…ç½®</h2><ol><li><p>å®‰è£…åŒ…</p><pre><code class="sh">yarn add @craco/craco</code></pre></li><li><p>é¡¹ç›®æ ¹ç›®å½•åˆ›å»º <code>craco.config.js</code> æ–‡ä»¶</p><pre><code class="js">/* craco.config.js */module.exports = &#123;  ...&#125;</code></pre></li><li><p>ä¿®æ”¹ package.json çš„ scripts å‘½ä»¤</p><pre><code class="json">/* package.json */&quot;scripts&quot;: &#123;-   &quot;start&quot;: &quot;react-scripts start&quot;,+   &quot;start&quot;: &quot;craco start&quot;,-   &quot;build&quot;: &quot;react-scripts build&quot;,+   &quot;build&quot;: &quot;craco build&quot;-   &quot;test&quot;: &quot;react-scripts test&quot;,+   &quot;test&quot;: &quot;craco test&quot;&#125;</code></pre></li></ol><p>åŸºç¡€çš„é…ç½®åˆ°æ­¤å®Œæˆäº†ï¼Œæ¥ä¸‹æ¥æ˜¯å¤„ç†å„ç§é…ç½®çš„è¦†ç›–ï¼Œå®Œæ•´çš„ craco.config.js é…ç½®æ–‡ä»¶ç»“æ„ï¼Œå¯ä»¥åœ¨ craco å®˜æ–¹çš„æ–‡æ¡£ä¸­è¯¦ç»†æŸ¥è¯¢ï¼š<a href="https://github.com/gsoft-inc/craco/blob/master/packages/craco/README.md#configuration-overview">Configuration Overview</a> ã€‚</p><h2 id="åŒºåˆ†ç¯å¢ƒ"><a href="#åŒºåˆ†ç¯å¢ƒ" class="headerlink" title="åŒºåˆ†ç¯å¢ƒ"></a>åŒºåˆ†ç¯å¢ƒ</h2><p>@craco/craco æä¾›äº† <code>whenDevã€whenProdã€whenTestã€when</code> å‡½æ•°ï¼Œç”¨äºåœ¨ä¹¦å†™ craco.config.js é…ç½®æ–‡ä»¶æ—¶æ ¹æ®ä¸åŒçš„ç¼–è¯‘ç¯å¢ƒç¡®å®šé…ç½®ï¼Œå…ˆçœ‹ä¸€ä¸‹ craco ç›¸å…³çš„æºç ï¼š</p><pre><code class="js">function when(condition, fct, unmetValue) &#123;  if (condition) &#123;    return fct();  &#125;  return unmetValue;&#125;function whenDev(fct, unmetValue) &#123;  return when(process.env.NODE_ENV === &#39;development&#39;, fct, unmetValue);&#125;function whenProd(fct, unmetValue) &#123;  return when(process.env.NODE_ENV === &#39;production&#39;, fct, unmetValue);&#125;function whenTest(fct, unmetValue) &#123;  return when(process.env.NODE_ENV === &#39;test&#39;, fct, unmetValue);&#125;module.exports = &#123;  when,  whenDev,  whenProd,  whenTest,&#125;;</code></pre><ul><li><p><code>whenDevã€whenProdã€whenTest</code> åˆ†åˆ«å¯¹åº”çš„æ˜¯ <code>process.env.NODE_ENV</code> çš„ 3 ç§å€¼ï¼ˆ<code>development</code>ã€<code>production</code>ã€<code>test</code>ï¼‰ï¼Œæ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼š</p><ul><li>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ functionï¼Œå¯¹åº”è¯¥ç¼–è¯‘ç¯å¢ƒä¸‹ï¼Œæ‰§è¡Œå‡½æ•°ï¼Œå‡½æ•°ä¸€èˆ¬åº”å½“å°†éœ€è¦çš„é…ç½®ä½œä¸ºè¿”å›å€¼ã€‚</li><li>ç¬¬äºŒä¸ªå‚æ•°æ˜¯é»˜è®¤å€¼ï¼ŒéæŒ‡å®šç¼–è¯‘ç¯å¢ƒæ—¶ï¼Œè¿”å›è¯¥é»˜è®¤å€¼ã€‚</li></ul></li><li><p><code>when</code> æ˜¯åŒºåˆ†ç¯å¢ƒçš„ä¸‡é‡‘æ²¹å‡½æ•°ï¼Œæ¥æ”¶ 3 ä¸ªå‚æ•°ï¼š</p><ul><li>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯åˆ¤æ–­çš„å˜é‡ã€‚</li><li>ç¬¬äºŒä¸ªå‚æ•°æ˜¯ functionï¼Œå‚æ•°ä¸€çš„å˜é‡ä¸º true æ—¶ï¼Œæ‰§è¡Œè¯¥å‡½æ•°ï¼Œå‡½æ•°ä¸€èˆ¬åº”å½“å°†éœ€è¦çš„é…ç½®ä½œä¸ºè¿”å›å€¼ã€‚</li><li>ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯é»˜è®¤å€¼ï¼Œå‚æ•°ä¸€çš„å˜é‡ä¸º false æ—¶ï¼Œè¿”å›è¯¥é»˜è®¤å€¼ã€‚</li></ul></li></ul><p>å¼•ç”¨æ–¹å¼ï¼š</p><pre><code class="js">const &#123; whenDev, whenProd, when &#125; = require(&#39;@craco/craco&#39;);</code></pre><p>ä¸‹æ–¹çš„ç¤ºä¾‹ä¸­æœ‰å¤šå¤„ä½¿ç”¨ï¼Œå¯ä»¥å‚ç…§äº†è§£å…¶ç”¨é€”ã€‚</p><h2 id="å¸¸ç”¨é…ç½®"><a href="#å¸¸ç”¨é…ç½®" class="headerlink" title="å¸¸ç”¨é…ç½®"></a>å¸¸ç”¨é…ç½®</h2><p>craco æœ‰æä¾›ä¸€äº› <a href="https://github.com/gsoft-inc/craco#community-maintained-plugins">plugins</a>ï¼Œé›†æˆäº†è¯¸å¤šåŠŸèƒ½ï¼Œè®©è¦†ç›–é…ç½®å˜å¾—æ›´åŠ å®¹æ˜“ã€‚</p><p>é™¤æ­¤ä¹‹å¤–ï¼Œåˆ™éœ€è¦æˆ‘ä»¬å¯¹ webpack çš„é…ç½®æœ‰ä¸€å®šçš„äº†è§£ï¼Œæ ¹æ® craco.config.js çš„æ–‡ä»¶ç»“æ„å»å¢åŠ é…ç½®ã€‚</p><h3 id="é€šè¿‡-configure-å‡½æ•°æ‰©å±•-webpack-é…ç½®"><a href="#é€šè¿‡-configure-å‡½æ•°æ‰©å±•-webpack-é…ç½®" class="headerlink" title="é€šè¿‡ configure å‡½æ•°æ‰©å±• webpack é…ç½®"></a>é€šè¿‡ configure å‡½æ•°æ‰©å±• webpack é…ç½®</h3><p>å‡ ä¹æ‰€æœ‰çš„ webpack é…ç½®å‡å¯ä»¥åœ¨ configure å‡½æ•°ä¸­è¯»å–ã€è¦†ç›–ï¼Œwebpack è¯¦ç»†çš„é…ç½®å‚æ•°ç»“æ„å¯ä»¥æŸ¥é˜… webpack å®˜æ–¹çš„æ–‡æ¡£ï¼š<a href="https://webpack.js.org/configuration/">https://webpack.js.org/configuration/</a> ã€‚</p><p>éœ€è¦æ³¨æ„ä¸€ç‚¹ï¼Œconfigure æ—¢å¯ä»¥å®šä¹‰ä¸ºå¯¹è±¡ï¼Œä¹Ÿå¯ä»¥å®šä¹‰ä¸ºå‡½æ•°ï¼Œä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œæˆ‘å‘ç°äºŒè€…æ˜¯äº’æ–¥çš„å…³ç³»ã€‚è¿™é‡Œæ¨èä½¿ç”¨å‡½æ•°å½¢å¼ï¼Œå› ä¸ºå½“æˆ‘æƒ³è¦è¦†ç›– <code>mini-css-extract-plugin</code> çš„é…ç½®æ—¶ï¼Œå‘ç°å¯¹è±¡å½¢å¼çš„ configure å®šä¹‰ï¼Œä¸èƒ½è¾¾åˆ°ç›®çš„ã€‚</p><p>configure å¯ä»¥æ‰©å±•æ‰€æœ‰çš„ webpack é…ç½®ï¼Œä½ å¯ä»¥å°†æ‰€æœ‰çš„é…ç½®éƒ½åœ¨ configure ä¸­å†™å®Œï¼Œä½†æ˜¯ï¼Œcraco æä¾›äº†è‹¥å¹²å¿«æ·çš„æ–¹å¼å»å®šä¹‰æŒ‡å®šçš„é…ç½®ï¼Œä¾‹å¦‚ï¼šbabelã€aliasã€webpack çš„ plugins ç­‰ã€‚å› æ­¤ï¼Œæ¨èæœ‰å¿«æ·çš„æ–¹å¼å°½é‡ç”¨å¿«æ·æ–¹å¼ï¼Œæä¸å®šçš„æ‰æ”¾åˆ° configure ä¸­å»å®šä¹‰ã€‚</p><pre><code class="js">/* craco.config.js */const &#123; whenDev, whenProd, when &#125; = require(&#39;@craco/craco&#39;);module.exports = &#123;  babel: &#123;&#125;,  webpack: &#123;    /**     * é‡å†™ webpack ä»»æ„é…ç½®     *  - ä¸ç›´æ¥å®šä¹‰ configure å¯¹è±¡æ–¹å¼äº’æ–¥     *  - å‡ ä¹æ‰€æœ‰çš„ webpack é…ç½®å‡å¯ä»¥åœ¨ configure å‡½æ•°ä¸­è¯»å–ï¼Œç„¶åè¦†ç›–     */    configure: (webpackConfig, &#123; env, paths &#125;) =&gt; &#123;      // ä¿®æ”¹ output      webpackConfig.output = &#123;        ...webpackConfig.output,        ...&#123;          filename: whenDev(() =&gt; &#39;static/js/bundle.js&#39;, &#39;static/js/[name].js&#39;),          chunkFilename: &#39;static/js/[name].js&#39;,        &#125;,      &#125;;      // å…³é—­ devtool      webpackConfig.devtool = false;      // é…ç½®æ‰©å±•æ‰©å±•å      webpackConfig.resolve.extensions = [        ...webpackConfig.resolve.extensions,        ...[&#39;.scss&#39;, &#39;.less&#39;],      ];      // é…ç½® splitChunks      webpackConfig.optimization.splitChunks = &#123;        ...webpackConfig.optimization.splitChunks,        ...&#123;          chunks: &#39;all&#39;,          name: true,        &#125;,      &#125;;      // è¦†ç›–å·²ç»å†…ç½®çš„ plugin é…ç½®      webpackConfig.plugins.map((plugin) =&gt; &#123;        whenProd(() =&gt; &#123;          if (plugin instanceof MiniCssExtractPlugin) &#123;            Object.assign(plugin.options, &#123;              filename: &#39;static/css/[name].css&#39;,              chunkFilename: &#39;static/css/[name].css&#39;,            &#125;);          &#125;        &#125;);        return plugin;      &#125;);      return webpackConfig;    &#125;,  &#125;,&#125;;</code></pre><h3 id="æ‰©å±•-babel-é…ç½®"><a href="#æ‰©å±•-babel-é…ç½®" class="headerlink" title="æ‰©å±• babel é…ç½®"></a>æ‰©å±• babel é…ç½®</h3><p>è™½ç„¶å¯ä»¥åœ¨ configure ä¸­å®šä¹‰ babel é…ç½®ï¼Œä½† craco ä¹Ÿæä¾›äº†å¿«æ·çš„æ–¹å¼å•ç‹¬å»ä¹¦å†™ï¼Œæ·»åŠ  <code>@babel/preset-env</code> é…ç½®ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><pre><code class="js">/* craco.config.js */module.exports = &#123;  babel: &#123;    presets: [      [        &#39;@babel/preset-env&#39;,        &#123;          modules: false, // å¯¹ES6çš„æ¨¡å—æ–‡ä»¶ä¸åšè½¬åŒ–ï¼Œä»¥ä¾¿ä½¿ç”¨tree shakingã€sideEffectsç­‰          useBuiltIns: &#39;entry&#39;, // browserslistç¯å¢ƒä¸æ”¯æŒçš„æ‰€æœ‰å«ç‰‡éƒ½å¯¼å…¥          // https://babeljs.io/docs/en/babel-preset-env#usebuiltins          // https://github.com/zloirock/core-js/blob/master/docs/2019-03-19-core-js-3-babel-and-a-look-into-the-future.md          corejs: &#123;            version: 3, // ä½¿ç”¨core-js@3            proposals: true,          &#125;,        &#125;,      ],    ],    plugins: [],  &#125;,&#125;;</code></pre><p>æ›´è¯¦ç»†çš„ babel ç›¸å…³é…ç½®ï¼Œæ¨èæˆ‘ä¹‹å‰æ•´ç†çš„ï¼š<a href="https://webpack.eleven.net.cn/content/babel/">https://webpack.eleven.net.cn/content/babel/</a> ã€‚</p><h3 id="æ‰©å±•-webpack-aliasï¼ˆåˆ«åï¼‰"><a href="#æ‰©å±•-webpack-aliasï¼ˆåˆ«åï¼‰" class="headerlink" title="æ‰©å±• webpack aliasï¼ˆåˆ«åï¼‰"></a>æ‰©å±• webpack aliasï¼ˆåˆ«åï¼‰</h3><p>è™½ç„¶å¯ä»¥åœ¨ configure ä¸­å®šä¹‰ aliasï¼Œä½† craco ä¹Ÿæä¾›äº†å¿«æ·çš„æ–¹å¼å•ç‹¬å»ä¹¦å†™ã€‚</p><pre><code class="js">/* craco.config.js */module.exports = &#123;  babel: &#123;&#125;,  webpack: &#123;    configure: (webpackConfig, &#123; env, paths &#125;) =&gt; &#123;&#125;,    alias: &#123;      &#39;@&#39;: path.resolve(__dirname, &#39;src&#39;),    &#125;,  &#125;,&#125;;</code></pre><p>è¿™é‡Œæœ‰ä¸€ä¸ªå‘ç‚¹ï¼Œå¦‚æœä½ ä½¿ç”¨çš„æ˜¯ cra åˆ›å»ºçš„ typescript é¡¹ç›®ï¼Œæ·»åŠ å®Œ alias åï¼Œä½ è¿˜éœ€è¦åœ¨ tsconfig.json æ–‡ä»¶ä¸­æ–°å¢é…ç½®ï¼Œå¦åˆ™ä¼šæç¤ºå‡ºé”™ã€‚å¹¶ä¸”ï¼Œæ–°ç‰ˆæœ¬ cra åˆ›å»ºçš„é¡¹ç›®ï¼Œåœ¨ç¼–è¯‘æ—¶ä¼šè‡ªåŠ¨æ ¼å¼åŒ– tsconfig.jsonï¼Œä½ å‘é‡Œé¢æ·»åŠ çš„è‹¥å¹²é…ç½®ï¼Œå¯èƒ½ä¼šè‡ªåŠ¨è¢«æ¸…é™¤æ‰ã€‚</p><p>æ€ä¹ˆåŠï¼Ÿè¿™é‡Œå¯»æ‰¾åˆ°ä¸€ä¸ªæœºæ™ºçš„åŠæ³•ï¼Œåˆ©ç”¨ tsconfig çš„ extends å‚æ•°å»æ‰©å±•éœ€è¦çš„é…ç½®ã€‚</p><p>tsconfig.json</p><pre><code class="json">&#123;  &quot;extends&quot;: &quot;./tsconfig.edit.json&quot;,  &quot;compilerOptions&quot;: &#123;    &quot;target&quot;: &quot;es5&quot;,    &quot;lib&quot;: [&quot;dom&quot;, &quot;dom.iterable&quot;, &quot;esnext&quot;],    &quot;allowJs&quot;: true,    &quot;skipLibCheck&quot;: true,    &quot;esModuleInterop&quot;: true,    &quot;allowSyntheticDefaultImports&quot;: true,    &quot;strict&quot;: true,    &quot;forceConsistentCasingInFileNames&quot;: true,    &quot;module&quot;: &quot;esnext&quot;,    &quot;moduleResolution&quot;: &quot;node&quot;,    &quot;resolveJsonModule&quot;: true,    &quot;isolatedModules&quot;: true,    &quot;noEmit&quot;: true,    &quot;jsx&quot;: &quot;react&quot;  &#125;,  &quot;include&quot;: [&quot;src&quot;]&#125;</code></pre><p>tsconfig.edit.json</p><pre><code class="json">&#123;  &quot;compilerOptions&quot;: &#123;    &quot;baseUrl&quot;: &quot;.&quot;,    &quot;paths&quot;: &#123;      &quot;@/*&quot;: [&quot;src/*&quot;]    &#125;  &#125;&#125;</code></pre><p>é€šè¿‡ç»§æ‰¿çš„æ–¹å¼ï¼Œæ·»åŠ å¦‚ä¸Šé…ç½®ï¼Œalias ä¿®æ”¹å³å¯å®Œæˆã€‚</p><p>å¦å¤–ï¼Œcraco ä¹Ÿæä¾›äº†ä¸€ä¸ª plugin ä¸“é—¨ç”¨äºä¿®æ”¹ aliasï¼Œä»¥åŠå¤„ç† tsconfig çš„é—®é¢˜ï¼Œ<a href="https://github.com/risenforces/craco-alias">ä¼ é€é—¨</a>ï¼Œè¯¥é¡µé¢ä¸‹æ–¹çš„ Examples ä¸­ï¼Œè¯¦ç»†è¯´æ˜äº† tsconfig çš„æ–¹æ¡ˆï¼Œæ¨èä½¿ç”¨ã€‚</p><h3 id="æ–°å¢-webpack-plugins"><a href="#æ–°å¢-webpack-plugins" class="headerlink" title="æ–°å¢ webpack plugins"></a>æ–°å¢ webpack plugins</h3><p>å¦‚æœæƒ³è¦æ–°å¢ä¸€äº› webpack pluginsï¼Œå¯ä»¥ç›´æ¥åœ¨ä¸ configure å¹³çº§çš„ä½ç½®æ·»åŠ ã€‚å½“ç„¶ï¼Œä½ åœ¨ configure é‡Œæ·»åŠ ä¹Ÿå¯ä»¥ï¼Œä½†ä¸æ¨èã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœä½ æƒ³ä¿®æ”¹å†…ç½®çš„æŸäº› webpack plugin å‚æ•°ï¼Œå¿…é¡»åˆ° configure é‡Œå»ä¿®æ”¹ï¼Œç¤ºä¾‹è§ä¸Šæ–¹çš„ configure ä»‹ç»ã€‚</p><p>ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><pre><code class="js">/* craco.config.js */const &#123; whenDev, whenProd, when &#125; = require(&#39;@craco/craco&#39;);const CircularDependencyPlugin = require(&#39;circular-dependency-plugin&#39;);const &#123; BundleAnalyzerPlugin &#125; = require(&#39;webpack-bundle-analyzer&#39;);module.exports = &#123;  babel: &#123;&#125;,  webpack: &#123;    configure: (webpackConfig, &#123; env, paths &#125;) =&gt; &#123;&#125;,    alias: &#123;      &#39;@&#39;: path.resolve(__dirname, &#39;src&#39;),    &#125;,    plugins: [      // æ–°å¢ webpack plugin      // æ–°å¢æ¨¡å—å¾ªç¯ä¾èµ–æ£€æµ‹æ’ä»¶      ...whenDev(        () =&gt; [          new CircularDependencyPlugin(&#123;            exclude: /node_modules/,            include: /src/,            failOnError: true,            allowAsyncCycles: false,            cwd: process.cwd(),          &#125;),        ],        [],      ),      // æ–°å¢æ‰“åŒ…äº§ç‰©åˆ†ææ’ä»¶      ...whenProd(        () =&gt; [          // https://www.npmjs.com/package/webpack-bundle-analyzer          new BundleAnalyzerPlugin(&#123;            analyzerMode: &#39;static&#39;, // html æ–‡ä»¶æ–¹å¼è¾“å‡ºç¼–è¯‘åˆ†æ            openAnalyzer: false,            reportFilename: path.resolve(__dirname, `analyzer/index.html`),          &#125;),        ],        [],      ),    ],  &#125;,&#125;;</code></pre><h3 id="æ‰©å±•-react-hot-loader"><a href="#æ‰©å±•-react-hot-loader" class="headerlink" title="æ‰©å±• react-hot-loader"></a>æ‰©å±• react-hot-loader</h3><blockquote><p>CRA v4.0 å¼€å§‹å·²ç»å†…ç½®äº† fast refresh â€”â€” <a href="https://github.com/facebook/create-react-app/releases/tag/v4.0.0">https://github.com/facebook/create-react-app/releases/tag/v4.0.0</a> ï¼Œä¸å¿…è‡ªå·±æ‰©å±• hot loaderã€‚</p></blockquote><p>å¸¸ç”¨çš„çƒ­æ›´æ–°æ–¹æ¡ˆ react-hot-loaderï¼Œcraco æä¾›äº†ä¸“é—¨çš„ craco pluginï¼ˆ<a href="https://github.com/HasanAyan/craco-plugin-react-hot-reload">ä¼ é€é—¨</a>ï¼‰ï¼Œé…ç½®å¦‚ä¸‹ï¼š</p><pre><code class="sh">yarn add craco-plugin-react-hot-reload -D</code></pre><pre><code class="js">/* craco.config.js */const &#123; whenDev, whenProd, when &#125; = require(&#39;@craco/craco&#39;);const reactHotReloadPlugin = require(&#39;craco-plugin-react-hot-reload&#39;);module.exports = &#123;  babel: &#123;&#125;,  webpack: &#123;&#125;,  // craco æä¾›çš„æ’ä»¶  plugins: [    // æ–°å¢ craco-plugin-react-hot-reload    ...whenDev(      () =&gt; [        &#123;          plugin: reactHotReloadPlugin,        &#125;,      ],      [],    ),  ],&#125;;</code></pre><p>æ·»åŠ å®Œé…ç½®ï¼Œè¿˜éœ€åœ¨å…¥å£æ–‡ä»¶ä¸­ä¿®æ”¹ä¸€ä¸‹ renderã€‚</p><pre><code class="sh">yarn add react-hot-loader -D</code></pre><pre><code class="js">/* å…¥å£ index.ts */import React from &#39;react&#39;import ReactDOM from &#39;react-dom&#39;+ import &#123; hot &#125; from &#39;react-hot-loader&#39;+ import &#123; isDev &#125; from &#39;@/utils&#39; // isDev ä½ å¯ä»¥è‡ªå·±ç¼–å†™å®šä¹‰ï¼Œä¾‹å¦‚ï¼šconst isDev = process.env.NODE_ENV === &#39;development&#39;import App from &#39;./App&#39;+ const Root = isDev ? hot(module)(App) : App- ReactDOM.render(&lt;App /&gt;, document.getElementById(&#39;root&#39;))+ ReactDOM.render(&lt;Root /&gt;, document.getElementById(&#39;root&#39;))</code></pre><h3 id="æ¯”-react-hot-loader-æ›´å¥½çš„æ–¹æ¡ˆ-craco-fast-refresh"><a href="#æ¯”-react-hot-loader-æ›´å¥½çš„æ–¹æ¡ˆ-craco-fast-refresh" class="headerlink" title="æ¯” react-hot-loader æ›´å¥½çš„æ–¹æ¡ˆ craco-fast-refresh"></a>æ¯” react-hot-loader æ›´å¥½çš„æ–¹æ¡ˆ craco-fast-refresh</h3><blockquote><p>CRA v4.0 å¼€å§‹å·²ç»å†…ç½®äº† fast refresh â€”â€” <a href="https://github.com/facebook/create-react-app/releases/tag/v4.0.0">https://github.com/facebook/create-react-app/releases/tag/v4.0.0</a> ï¼Œä¸å¿…è‡ªå·±æ‰©å±• hot loaderã€‚</p></blockquote><p>è¿™æ˜¯æœ€è¿‘å‘ç°çš„æ–° craco pluginï¼Œç›¸å¯¹äº react-hot-loader å¥½ç”¨å¾—å¤šï¼Œé›¶é…ç½®ï¼Œä¸éœ€è¦ä¿®æ”¹é¡¹ç›®ä»£ç ï¼Œæ®è¯´æ€§èƒ½ä¹Ÿæ›´å¥½ã€‚</p><pre><code class="sh">yarn add craco-fast-refresh -D</code></pre><pre><code class="js">/* craco.config.js */const &#123; whenDev &#125; = require(&#39;@craco/craco&#39;);const fastRefreshCracoPlugin = require(&#39;craco-fast-refresh&#39;);module.exports = &#123;  babel: &#123;&#125;,  webpack: &#123;&#125;,  // craco æä¾›çš„æ’ä»¶  plugins: [    ...whenDev(      () =&gt; [        &#123;          plugin: fastRefreshCracoPlugin,        &#125;,      ],      [],    ),  ],&#125;;</code></pre><h3 id="AntDesign-è‡ªå®šä¹‰ä¸»é¢˜-amp-æŒ‰éœ€åŠ è½½"><a href="#AntDesign-è‡ªå®šä¹‰ä¸»é¢˜-amp-æŒ‰éœ€åŠ è½½" class="headerlink" title="AntDesign è‡ªå®šä¹‰ä¸»é¢˜ &amp; æŒ‰éœ€åŠ è½½"></a>AntDesign è‡ªå®šä¹‰ä¸»é¢˜ &amp; æŒ‰éœ€åŠ è½½</h3><ul><li>åœ¨ bebel é…ç½®ä¸­æ–°å¢ <code>babel-plugin-import</code>ï¼Œæå®š AntDesign æŒ‰éœ€åŠ è½½</li><li>æ–°å¢ craco æä¾›çš„ plugin <code>craco-less</code>ï¼Œæå®šè‡ªå®šä¹‰ä¸»é¢˜</li></ul><pre><code class="sh">yarn add babel-plugin-import craco-less -D</code></pre><pre><code class="js">/* craco.config.js */const CracoLessPlugin = require(&#39;craco-less&#39;);module.exports = &#123;  babel: &#123;    plugins: [      // é…ç½® babel-plugin-import      [        &#39;import&#39;,        &#123;          libraryName: &#39;antd&#39;,          libraryDirectory: &#39;es&#39;,          style: &#39;css&#39;,        &#125;,        &#39;antd&#39;,      ],    ],  &#125;,  webpack: &#123;&#125;,  // craco æä¾›çš„æ’ä»¶  plugins: [    // é…ç½® less    &#123;      plugin: CracoLessPlugin,      options: &#123;        lessLoaderOptions: &#123;          lessOptions: &#123;            modifyVars: &#123;              // è‡ªå®šä¹‰ä¸»é¢˜ï¼ˆå¦‚æœæœ‰éœ€è¦ï¼Œå•ç‹¬æ–‡ä»¶å®šä¹‰æ›´å¥½ä¸€äº›ï¼‰              &#39;@primary-color&#39;: &#39;#1DA57A&#39;,            &#125;,            javascriptEnabled: true,          &#125;,        &#125;,      &#125;,    &#125;,  ],&#125;;</code></pre><p>craco ä¹Ÿæä¾›äº†ä¸“é—¨çš„ plugin æ¥å¤„ç† antd çš„é›†æˆï¼ˆ<a href="https://github.com/DocSpring/craco-antd">ä¼ é€é—¨</a>ï¼‰ï¼Œä¸ä¸Šæ–¹çš„é…ç½®æ–¹å¼æœ‰åŒºåˆ«ã€‚ä» github çš„ä»‹ç»ä¸­èƒ½å¤Ÿçœ‹åˆ°å¦‚ä¸‹ä»‹ç»ï¼š</p><p>craco-antd includes:</p><ul><li>Less (provided by craco-less)</li><li>babel-plugin-import to only import the required CSS, instead of everything</li><li>An easy way to customize the theme. Set your custom variables in ./antd.customize.less</li></ul><p>ç›¸å¯¹æ¥è®²ä½¿ç”¨ä¼šæ›´ç®€æ´ä¸€äº›ï¼Œæ¨èä½¿ç”¨ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ç»è¿‡é¡¹ç›®ä¸­çš„è¯•ç”¨ï¼Œç¡®å®èƒ½å¤Ÿåœ¨ä¸ eject å¼¹å‡ºé…ç½®çš„æƒ…å†µä¸‹ï¼Œè‡ªå®šä¹‰æ‰€æœ‰çš„ cra æ„å»ºé…ç½®ï¼Œå› æ­¤ï¼Œåœ¨åç»­çš„ç¼–ç ä¸­ï¼Œæˆ‘åº”è¯¥è¿˜ä¼šç»§ç»­ä½¿ç”¨ã€‚</p><p>ä¸Šæ–¹æ˜¯æœ€è¿‘åœ¨é¡¹ç›®ä¸­ï¼Œä½¿ç”¨åˆ°çš„ä¸€äº›é…ç½®ï¼Œæ›´å¤šçš„ä½¿ç”¨æ–¹å¼å»ºè®®é€šè¿‡é˜…è¯»å®˜æ–¹çš„æ–‡æ¡£ï¼ˆ<a href="https://github.com/gsoft-inc/craco/blob/master/packages/craco/README.md">ä¼ é€é—¨</a>ï¼‰å»äº†è§£ï¼Œå°¤å…¶éœ€è¦è¯¦ç»†äº†è§£ craco.config.js æ–‡ä»¶çš„é…ç½®åˆ—è¡¨ï¼ˆ<a href="https://github.com/gsoft-inc/craco/blob/master/packages/craco/README.md#configuration-overview">Configuration Overview</a>ï¼‰ã€‚</p><p>æœ‰å‡ ç‚¹å»ºè®®å¦‚ä¸‹ï¼š</p><ol><li><p>craco æœ‰æä¾›ä¸€äº›å¥½ç”¨çš„ pluginï¼ˆ<a href="https://github.com/gsoft-inc/craco#community-maintained-plugins">ä¼ é€é—¨</a>ï¼‰ï¼Œæ¨èä¼˜å…ˆè€ƒè™‘ä½¿ç”¨ç°æˆçš„æ’ä»¶å»è§£å†³é—®é¢˜ã€‚</p><p>æ³¨æ„ craco çš„ plugin ä¸ webpack plugin ä¸æ˜¯åŒä¸€æ¦‚å¿µï¼ŒäºŒè€…é…ç½®çš„ä½ç½®ä¹Ÿä¸åŒã€‚</p></li><li><p>webpack ç›¸å…³çš„é…ç½®è¦†ç›–ï¼Œä¼˜å…ˆä½¿ç”¨ craco æä¾›çš„å¿«æ·æ–¹å¼å»é…ç½®ã€‚</p><p>è§£å†³ä¸äº†çš„é—®é¢˜ï¼Œåœ¨ configure å‡½æ•°ä¸­é…ç½®ï¼Œå¹¶ä¸”ï¼Œæ¨è configure ä½¿ç”¨å‡½æ•°å½¢å¼ï¼Œè€Œéå¯¹è±¡å½¢å¼ã€‚è™½ç„¶ï¼Œå‡½æ•°å½¢å¼æ›´å¤æ‚äº†ä¸€ç‚¹ï¼Œä½†æ˜¯äºŒè€…æ˜¯äº’æ–¥çš„ï¼Œåªå¥½é€‰æ‹©å…¶ä¸­ä¸€ç§ã€‚</p></li></ol><p>æœ€åï¼Œè¿™é‡Œï¼ˆ â˜ <a href="https://github.com/eleven-net-cn/create-react-app/blob/master/packages/cra-template-typescript/template/craco.config.js">ä¼ é€é—¨</a> ï¼‰æœ‰ä¸€ä»½å®Œæ•´çš„ craco.config.js é…ç½®æ–‡ä»¶ï¼Œæ–¹ä¾¿å‚ç…§ã€‚</p><p>ç‰ˆæœ¬æ˜¯ webpack v4ã€create-react-app v4ï¼Œå…¶å®ƒä¸åŒçš„ç‰ˆæœ¬ï¼Œå¯èƒ½éœ€è¦ç•¥åŠ è°ƒæ•´ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> React </category>
          
      </categories>
      
      
        <tags>
            
            <tag> create-react-app </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>1px ç»†çº¿å®ç°</title>
      <link href="/2020/08/26/css/border/"/>
      <url>/2020/08/26/css/border/</url>
      
        <content type="html"><![CDATA[<p>é‡‡ç”¨ç¼©æ”¾æ–¹æ¡ˆï¼Œå•æ¡è¾¹çº¿å¥½å¤„ç†ä¸€ç‚¹ï¼›å¦‚æœéœ€è¦å››è¾¹éƒ½æœ‰è¾¹çº¿ï¼Œä¼šæœ‰ç‚¹éº»çƒ¦ï¼Œä½¿ç”¨ç¼©æ”¾æ–¹æ¡ˆï¼Œè™½ç„¶å¯è¡Œï¼Œä½†æ˜¯åœ¨éƒ¨åˆ†è®¾å¤‡ä¸Šæœ‰é—´éš™é—®é¢˜ï¼Œå»ºè®®æ”¾å¼ƒï¼Œæˆ–è€…ä½¿ç”¨ svg æ¥åš background-imageã€‚</p><p>ä»¥ä¸‹æ˜¯ less/sass çš„ç®€å•å®ç°ç¤ºä¾‹ã€‚</p><h3 id="LESS-ä¸Šè¾¹çº¿-1px"><a href="#LESS-ä¸Šè¾¹çº¿-1px" class="headerlink" title="LESS ä¸Šè¾¹çº¿ 1px"></a>LESS ä¸Šè¾¹çº¿ 1px</h3><pre><code class="less">.border-top(@color) &#123;  position: relative;  &amp;:before &#123;    position: absolute;    top: 0;    left: 0;    content: &#39;\0020&#39;;    width: 100%;    height: 1px;    border-top: 1px solid @color;    transform-origin: 0 0;    overflow: hidden;  &#125;  @media (-webkit-min-device-pixel-ratio: 1.5) and (-webkit-max-device-pixel-ratio: 2.49) &#123;    &amp;:before &#123;      transform: scaleY(0.5);    &#125;  &#125;  @media (-webkit-min-device-pixel-ratio: 2.5) &#123;    &amp;:before &#123;      transform: scaleY(0.33333);    &#125;  &#125;&#125;// ä½¿ç”¨.test &#123;  .border-top(#eee);&#125;</code></pre><h3 id="SASS-ä¸Šä¸‹-1px-ç»†çº¿"><a href="#SASS-ä¸Šä¸‹-1px-ç»†çº¿" class="headerlink" title="SASS ä¸Šä¸‹ 1px ç»†çº¿"></a>SASS ä¸Šä¸‹ 1px ç»†çº¿</h3><pre><code class="scss">/** * 1pxç»†çº¿ *  $position top/bottom */@mixin border-1px($position, $color) &#123;  position: relative;  &amp;:before &#123;    position: absolute;    @if $position == top &#123;      top: 0;    &#125;    @if $position == bottom &#123;      bottom: 0;    &#125;    left: 0;    content: &#39;\0020&#39;;    width: 100%;    height: 1px;    border-#&#123;$position&#125;: 1px solid $color;    transform-origin: 0 0;    overflow: hidden;  &#125;  @media (-webkit-min-device-pixel-ratio: 1.5) and (-webkit-max-device-pixel-ratio: 2.49) &#123;    &amp;:before &#123;      transform: scaleY(0.5);    &#125;  &#125;  @media (-webkit-min-device-pixel-ratio: 2.5) &#123;    &amp;:before &#123;      transform: scaleY(0.33333);    &#125;  &#125;&#125;// ä½¿ç”¨.test &#123;  // ä¸Šè¾¹çº¿  @include border-1px(top, #e9e9e9);  // ä¸‹è¾¹çº¿  @include border-1px(bottom, #e9e9e9);&#125;</code></pre>]]></content>
      
      
      <categories>
          
          <category> CSS3 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 1px-border </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ¨¡å—é—´å¾ªç¯å¼•ç”¨é—®é¢˜</title>
      <link href="/2020/06/11/nodejs/circular-deps/"/>
      <url>/2020/06/11/nodejs/circular-deps/</url>
      
        <content type="html"><![CDATA[<p>æœ‰æ—¶å€™å¯èƒ½ä¼šé‡è§è¿™æ ·çš„åœºæ™¯ï¼šæ¨¡å—Aå¼•ç”¨äº†æ¨¡å—Bé‡Œçš„func1æ–¹æ³•ï¼Œè€Œæ¨¡å—Båˆå¼•ç”¨äº†æ¨¡å—Aé‡Œçš„func2æ–¹æ³•ã€‚</p><p>ç±»ä¼¼ä¸Šé¢çš„åœºæ™¯ï¼Œæˆ–è€…å…¶å®ƒæ›´å¤æ‚çš„å¦‚ï¼šA å¼•ç”¨ Bï¼ŒB å¼•ç”¨ Cï¼ŒC åˆå¼•ç”¨äº† Aï¼Œåœ¨ä¸ç»æ„é—´å¯èƒ½ä¼šé‡åˆ°ä¸€äº›è¯¡å¼‚é—®é¢˜ï¼Œå¦‚ï¼šæ˜æ˜ä»£ç æ²¡é—®é¢˜ï¼Œå´è¯»ä¸åˆ°å¯¼å…¥çš„æ¨¡å—â€¦â€¦</p><p>ä¸ºäº†æ›´å¥½åœ°é¿å…è¿™æ ·çš„é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨ <a href="https://github.com/aackerman/circular-dependency-plugin">circular-dependency-plugin</a> æ’ä»¶æ¥åšå¾ªç¯å¼•ç”¨çš„æ£€æµ‹:</p><p>åŸºæœ¬ç”¨æ³•å¦‚ä¸‹ï¼Œå¤åˆ¶ã€ç²˜è´´å³å¯ç”Ÿæ•ˆï¼š</p><pre><code class="js">// webpack.config.jsconst CircularDependencyPlugin = require(&#39;circular-dependency-plugin&#39;)module.exports = &#123;  plugins: [    new CircularDependencyPlugin(&#123;      // exclude detection of files based on a RegExp      exclude: /node_modules/,      // include specific files based on a RegExp      include: /src/,      // add errors to webpack instead of warnings      failOnError: true,      // allow import cycles that include an asyncronous import,      // e.g. via import(/* webpackMode: &quot;weak&quot; */ &#39;./file.js&#39;)      allowAsyncCycles: false,      // set the current working directory for displaying module paths      cwd: process.cwd(),    &#125;)  ]&#125;</code></pre><p>æ£€æµ‹åˆ°é—®é¢˜æ—¶ï¼Œä¼šçœ‹åˆ°å¦‚ä¸‹å›¾çš„ç¼–è¯‘æç¤ºï¼š</p><p><img src="https://user-gold-cdn.xitu.io/2019/12/10/16eefa622ebb1ebf?w=1060&h=230&f=png&s=51565" alt=""></p><p>å¦‚ä½•è§£å†³å¾ªç¯å¼•ç”¨çš„é—®é¢˜ï¼Ÿå°†è¢«å¾ªç¯å¼•ç”¨åˆ°çš„æ¨¡å—æå–æ”¾åˆ°å¦å¤–çš„æ¨¡å—ï¼Œæ‰“ç ´è¿™ä¸ªå¾ªç¯å³å¯ï¼</p><h4 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="headerlink" title="å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h4><ol><li><a href="https://www.imooc.com/article/260265">webpack ä¸å¾ªç¯å¼•ç”¨</a></li><li><a href="http://www.ruanyifeng.com/blog/2015/11/circular-dependency.html">JavaScript æ¨¡å—çš„å¾ªç¯åŠ è½½</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> NodeJS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Webpack </tag>
            
            <tag> NodeJS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è‡ªåŠ¨ä¿®æ”¹ node_moduels æºç </title>
      <link href="/2020/06/11/nodejs/patch-package/"/>
      <url>/2020/06/11/nodejs/patch-package/</url>
      
        <content type="html"><![CDATA[<p>æœ‰æ—¶å€™ node_modules ä¸­çš„ç¬¬ä¸‰æ–¹åŒ…æœ‰é—®é¢˜æˆ–éœ€è¦ä¿®æ”¹å‡ è¡Œæºç ï¼Œæˆ‘ä»¬å¯ä»¥æ€ä¹ˆåŠï¼Ÿ</p><ol><li><p>å»ç»™ä½œè€…æ issuesï¼Ÿå¯èƒ½å¾—ä¸åˆ°å›å¤ã€‚</p></li><li><p>è‡ªå·±åœ¨ node_modules é‡Œç›´æ¥ä¿®æ”¹æºç ï¼Ÿä¸‹ä¸€æ¬¡é‡æ–°å®‰è£…åŒ…ï¼Œæˆ–è€…å…¶ä»–åŒäº‹ install çš„æ—¶å€™ï¼Œè¢«ä¿®æ”¹è¿‡çš„æºç åˆæ¢å¤å¦‚åˆäº†ã€‚</p></li><li><p>ä¸ç”¨ä»–çš„åŒ…ï¼Œè‡ªå·±å†™ä¸€ä¸ªï¼Ÿâ€¦â€¦</p></li></ol><p>ç¤¾åŒºæä¾›äº†ä¸€ä¸ªå·¥å…·ï¼š<a href="https://github.com/ds300/patch-package">patch-package</a>ï¼Œä¸“é—¨ç”¨æ¥å¤„ç†ä¿®æ”¹ node_modules åŒ…æºç çš„é—®é¢˜ã€‚</p><h2 id="åŸºæœ¬ä½¿ç”¨"><a href="#åŸºæœ¬ä½¿ç”¨" class="headerlink" title="åŸºæœ¬ä½¿ç”¨"></a>åŸºæœ¬ä½¿ç”¨</h2><p>ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼Œæ³¨æ„ yarnã€npm ä½¿ç”¨æ—¶çš„å·®å¼‚ï¼Œæ¨èä½¿ç”¨ yarnã€‚</p><ol><li><p>å®‰è£… patch-package</p><pre><code class="sh"># yarn éœ€è¦å¤šå®‰è£…ä¸€ä¸ªåŒ… postinstall-postinstallï¼Œhttps://github.com/ds300/patch-package#why-use-postinstall-postinstall-with-yarnyarn add patch-package postinstall-postinstall -D# or# npmnpm i patch-package -D</code></pre></li><li><p>åœ¨ package.json çš„ scripts ä¸­å¢åŠ å¦‚ä¸‹å‘½ä»¤ï¼š</p><pre><code class="json">&quot;scripts&quot;: &#123;+  &quot;postinstall&quot;: &quot;patch-package&quot;&#125;</code></pre><p><code>postinstall</code> æ˜¯ npm çš„é’©å­ï¼Œä¼šåœ¨ä¾èµ–åŒ…è¢« <code>install</code> ä¹‹åè¢«æ‰§è¡Œã€‚</p></li><li><p>ä¸Šé¢ä¸¤æ­¥éƒ½åšäº†ï¼Œå°±å¯ä»¥å»ä¿®æ”¹ node_modules é‡Œä»»æ„ç¬¬ä¸‰æ–¹åŒ…çš„æºç äº†ã€‚</p></li><li><p>ä¿®æ”¹äº†æºç ï¼Œéšåéœ€è¦æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p><pre><code class="sh"># [package-name] æ˜¯åŒ…åï¼Œä¸éœ€è¦å†™è·¯å¾„ã€‚yarn patch-package [package-name]# ornpx patch-package [package-name]</code></pre><p>å‘½ä»¤æ‰§è¡ŒæˆåŠŸåï¼Œä¼šå‘ç°é¡¹ç›®æ ¹ç›®å½•ä¸‹å¤šäº†ä¸€ä¸ªæ–‡ä»¶å¤¹ <code>patches</code>ï¼Œè¯¥ç›®å½•ä¸‹å¤šäº†æ–‡ä»¶ï¼Œå³ä¸ºè®°å½•æºç ä¿®æ”¹çš„æ–‡ä»¶ã€‚</p><p><img src="https://user-gold-cdn.xitu.io/2020/3/27/1711bce8d8e01745?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt=""></p><p>å°† <code>patches</code> ç›®å½•åŠæ–‡ä»¶ï¼Œé€šè¿‡ git æäº¤åˆ°ä»£ç ä»“åº“ã€‚</p></li><li><p>Overï¼Œåç»­å…¶ä»–åŒå­¦ä¸éœ€è¦åšé¢å¤–æ“ä½œï¼Œç›´æ¥å®‰è£…å³å¯ï¼Œnode_modules ä¸‹çš„æºç ä¿®æ”¹ä¼šè‡ªåŠ¨æ›´æ–°ã€‚</p><p>ä¹‹å‰å·²ç»å®‰è£…è¿‡è¯¥ç¬¬ä¸‰æ–¹åŒ…çš„åŒå­¦ï¼Œéœ€è¦å¸è½½ï¼Œé‡æ–°å®‰è£…ä¸€æ¬¡ã€‚</p></li><li><p>å¦‚æœåç»­è¿˜æœ‰å…¶å®ƒåŒ…ä¹Ÿéœ€è¦ä¿®æ”¹æºç ï¼Œä¿®æ”¹è¿‡åï¼Œå†æ‰§è¡Œä¸€æ¬¡å‘½ä»¤ï¼š</p><pre><code class="sh">yarn patch-package [package-name]# ornpx patch-package [package-name]</code></pre></li></ol><h2 id="ç›´æ¥æäº¤-issues"><a href="#ç›´æ¥æäº¤-issues" class="headerlink" title="ç›´æ¥æäº¤ issues"></a>ç›´æ¥æäº¤ issues</h2><p>å®Œæˆä¸Šè¿°æ­¥éª¤åï¼Œä½ ç”šè‡³å¯ä»¥é€šè¿‡ä¸€è¡Œå‘½ä»¤å‘ç¬¬ä¸‰æ–¹åŒ…æäº¤ issuesã€‚</p><p>ç¤ºä¾‹æˆªå›¾ï¼š</p><p><img src="/imgs/patch_pkg_create_issues.png" alt=""></p><h2 id="å…¶å®ƒ"><a href="#å…¶å®ƒ" class="headerlink" title="å…¶å®ƒ"></a>å…¶å®ƒ</h2><ol><li><p>è¿‡ç¨‹ä¸­é‡åˆ°ä¸€ä¸ªé”™è¯¯ï¼Œè®°å½•ä¸€ä¸‹ï¼Œå…¶ä»–äººä¸ä¸€å®šä¼šé‡åˆ°ã€‚</p><p>macos åœ¨ç»ˆç«¯æŠ¥å¦‚ä¸‹é”™è¯¯:</p><p><img src="https://user-gold-cdn.xitu.io/2020/3/27/1711bcf316c96916?w=2240&h=288&f=png&s=90956" alt=""></p><p>å¯ä»¥å‚ç…§è¿™ä¸ªæ–‡æ¡£è§£å†³ï¼š<a href="https://www.cnblogs.com/start-fxw/p/10192226.html">https://www.cnblogs.com/start-fxw/p/10192226.html</a></p><p>ç»ˆç«¯è¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p><pre><code class="bash">xcode-select --install</code></pre><p>æ›´æ–°ä¸€ä¸‹ xcode å³å¯ã€‚</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> NPM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NPM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NPM åŒ…å‘å¸ƒæŒ‡å—</title>
      <link href="/2020/05/10/npm/publish/"/>
      <url>/2020/05/10/npm/publish/</url>
      
        <content type="html"><![CDATA[<h2 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h2><ol><li><p>åœ¨ NPM å®˜ç½‘æ³¨å†Œè´¦å·ï¼Œ<a href="https://www.npmjs.com">https://www.npmjs.com</a></p><p>é‚®ä»¶éªŒè¯çš„æ—¶å€™å¯èƒ½éœ€è¦ç¿»å¢™è®¿é—®ã€‚</p></li><li><p>æœ¬æœºå®‰è£… nodejs</p></li><li><p>æ¨èä¹Ÿå®‰è£…ä¸€ä¸‹ nrmï¼Œæ–¹ä¾¿éšæ—¶åˆ‡æ¢ npm æº</p><pre><code class="sh">sudo npm i nrm -g</code></pre><p>nrm å¸¸ç”¨å‘½ä»¤</p><pre><code class="sh">nrm ls                  # æŸ¥çœ‹æ‰€æœ‰nrm use [ç›®æ ‡æº]         # åˆ‡æ¢è‡³ç›®æ ‡æº</code></pre></li></ol><h2 id="package-json-æ–‡ä»¶"><a href="#package-json-æ–‡ä»¶" class="headerlink" title="package.json æ–‡ä»¶"></a>package.json æ–‡ä»¶</h2><p>åŒ…çš„<strong>æ ¹ç›®å½•</strong>éœ€è¦æœ‰ä¸€ä¸ª package.json æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡ <code>npm init</code> å‘½ä»¤å»åˆ›å»ºï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p><pre><code class="json">&#123;  &quot;name&quot;: &quot;@eleven.fe/reset.css&quot;,  &quot;version&quot;: &quot;1.0.6&quot;,  &quot;description&quot;: &quot;H5 ç½‘é¡µ reset æ–¹æ¡ˆï¼ŒPC&amp;mobile&quot;,  &quot;main&quot;: &quot;lib/reset.css&quot;,  &quot;scripts&quot;: &#123;    &quot;release&quot;: &quot;npm publish . --access=public&quot;  &#125;,  &quot;repository&quot;: &#123;    &quot;type&quot;: &quot;git&quot;,    &quot;url&quot;: &quot;git+https://github.com/eleven-net-cn/reset.css.git&quot;  &#125;,  &quot;keywords&quot;: [&quot;reset.css&quot;],  &quot;author&quot;: &quot;Eleven&quot;,  &quot;license&quot;: &quot;ISC&quot;,  &quot;bugs&quot;: &#123;    &quot;url&quot;: &quot;https://github.com/eleven-net-cn/reset.css/issues&quot;  &#125;,  &quot;homepage&quot;: &quot;https://github.com/eleven-net-cn/reset.css#readme&quot;,  &quot;files&quot;: [&quot;lib&quot;, &quot;ReadMe.md&quot;]&#125;</code></pre><p><strong>é‡ç‚¹æ³¨æ„ä»¥ä¸‹å‡ é¡¹ï¼š</strong></p><ol><li><p>mainï¼šæŒ‡å®šåŒ…çš„å…¥å£æ–‡ä»¶</p></li><li><p>nameï¼šæŒ‡å®šåŒ…å</p><ul><li>å‘å¸ƒä¹‹å‰éƒ½è¦å»<a href="https://www.npmjs.com">NPM å®˜ç½‘</a>ä¸Šæœç´¢ä¸€éï¼Œç¡®è®¤æƒ³è¦ä½¿ç”¨çš„åŒ…åï¼Œæ˜¯å¦å·²ç»è¢«å ç”¨ã€‚</li><li>åŒ…åæ”¯æŒ [@scope]/[package name] çš„å½¢å¼ï¼Œ[@scope] ç±»ä¼¼äºå‘½åç©ºé—´çš„ä½œç”¨ï¼ŒNPM é»˜è®¤å…è®¸ä½ ä½¿ç”¨è‡ªå·±æ³¨å†Œçš„ç”¨æˆ·åï¼Œæˆ–è€…åœ¨è‡ªå·±çš„è´¦æˆ·ä¸‹ç”³è¯·çš„ organizationsã€‚<br>å…¸å‹çš„ä¾‹å­ï¼Œå¦‚ Babelï¼Œæ’ä»¶åŸå…ˆä½¿ç”¨çš„æ˜¯ babel-plugin-xxx çš„æ ¼å¼å‘½åï¼Œåæ¥å› ä¸ºè®¸å¤šä¸ªäººå‘å¸ƒçš„åŒ…å’Œå®˜æ–¹çš„åŒ…å‘½åæ ¼å¼ä¸€æ ·ï¼Œå¯¼è‡´éš¾ä»¥åŒºåˆ†ï¼Œç°åœ¨ babel å®˜æ–¹æ‰€æœ‰çš„åŒ…éƒ½æ›´æ¢æˆäº† @babel/xxx çš„æ ¼å¼ã€‚</li></ul></li><li><p>versionï¼šåŒ…çš„ç‰ˆæœ¬</p><ul><li>æ ¼å¼ <code>æ•°å­—.æ•°å­—.æ•°å­—</code>ï¼Œæ¯ä¸€æ¬¡å‘å¸ƒï¼Œç‰ˆæœ¬éƒ½å¿…é¡»è¦æ›´æ–°ï¼Œåªèƒ½å¾€ä¸Šå¢åŠ ã€‚</li></ul></li><li><p>keywordsï¼šå…³é”®è¯</p><ul><li>å¸Œæœ›åˆ«äººé€šè¿‡å“ªäº›å…³é”®è¯æœç´¢åˆ°ä½ çš„åŒ…ï¼Œå¯ä»¥åœ¨è¿™é‡Œæ·»åŠ ã€‚</li></ul></li><li><p>filesï¼šæŒ‡å®šå“ªäº›æ–‡ä»¶å¤¹ã€æ–‡ä»¶å°†è¢«å‘å¸ƒ</p><ul><li><p>å¦‚æœä½ çš„é¡¹ç›®ç›®å½•ä¸‹åŒ…å«äº†ä¸€äº›éšç§æ–‡ä»¶ï¼Œä¸å¸Œæœ›è¢«å‘å¸ƒå‡ºå»ï¼Œä¸€å®šè¦æ³¨æ„é…ç½®æ­¤é¡¹ï¼Œä»…åŒ…å«å¯ä»¥è¢«å‘å¸ƒçš„æ–‡ä»¶å¤¹ã€æ–‡ä»¶ã€‚</p></li><li><p>å¯ä»¥åœ¨åŒ…çš„æ ¹ç›®å½•ä¸‹æ–°å»ºæ–‡ä»¶ <code>.npmignore</code>ï¼ŒæŒ‡å®šå“ªäº›æ–‡ä»¶ä¸è¢«å‘å¸ƒï¼Œä¹¦å†™æ ¼å¼ä¸ <code>.gitignore</code> æ–‡ä»¶ä¸€è‡´ã€‚</p></li></ul></li><li><p>licenseï¼šåè®®ï¼Œæ¨èé˜…è¯»äº†è§£å‡ ç§å¼€æºçš„åè®®ï¼š</p><ul><li><p><a href="https://www.jianshu.com/p/86251523e898">ä¸ƒç§å¼€æºè®¸å¯è¯</a></p></li><li><p><a href="https://spdx.org/licenses/">SPDX License List</a></p></li></ul></li><li><p>descriptionã€repositoryã€authorã€bugsã€homepage ç­‰é¡¹ï¼Œé€šå¸¸ä¹Ÿæ¨èå¡«å†™å®Œæ•´ï¼Œè¯¦ç»†çš„ package.json æ¯ä¸€é¡¹çš„å«ä¹‰ï¼Œæ¨èé˜…è¯»è¿™ä¸€ç¯‡ï¼š<a href="https://blog.csdn.net/zhengxiuchen86/article/details/81285030">npm package.json å±æ€§è¯¦è§£</a> ã€‚</p></li></ol><h2 id="å¾…å‘å¸ƒçš„åŒ…ç»“æ„"><a href="#å¾…å‘å¸ƒçš„åŒ…ç»“æ„" class="headerlink" title="å¾…å‘å¸ƒçš„åŒ…ç»“æ„"></a>å¾…å‘å¸ƒçš„åŒ…ç»“æ„</h2><ol><li><p>ç§»é™¤ä¸å¿…è¦çš„ä»£ç </p><p>å‘å¸ƒå‡ºå»çš„åŒ…ï¼Œä¸€èˆ¬åªéœ€è¦åŒ…å«ç”¨æˆ·ä½¿ç”¨æ—¶å¿…é¡»è¦ <code>install</code> ä¸‹è½½çš„æ–‡ä»¶å³å¯ï¼Œä¾‹å¦‚ä¸€äº›æ„å»ºè„šæœ¬ç­‰æ— å…³çš„ä»£ç æ–‡ä»¶ï¼Œä¸å¿…å‘å¸ƒå‡ºå»ã€‚</p><p>ä¾‹å¦‚ï¼šä½ æœ‰ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼ŒåŒæ—¶ï¼Œè¯¥é¡¹ç›®ä¹Ÿæä¾›äº†åŒ…ä¾›å¼€å‘è€…ä½¿ç”¨ï¼Œæœ€ä½³æ–¹å¼åº”è¯¥æ˜¯å°†è¯¥é¡¹ç›®æºç æ¨é€åˆ° GitHub ä¸Šå¼€æºï¼Œè€Œå‘å¸ƒåˆ° NPM ä»“åº“çš„åŒ…ï¼Œå°½é‡ä¸è¦æŠŠé¡¹ç›®æºç ç›®å½•ã€æ„å»ºè„šæœ¬ç­‰éå¿…è¦çš„æ–‡ä»¶å‘å¸ƒåˆ° NPM ä»“åº“ï¼Œä¼šå¢å¤§åŒ…çš„ä½“ç§¯ï¼Œå¯¼è‡´å®‰è£…æ—¶é—´å˜é•¿ã€‚</p></li><li><p>å‘å¸ƒçš„åŒ…å°½é‡è¦åšå¥½è¯­æ³•è½¬è¯‘ï¼Œå¦åˆ™è¦åœ¨æ–‡æ¡£ä¸­è¯´æ˜ï¼Œæé†’ä½¿ç”¨è€…è‡ªå·±å®Œæˆã€‚</p></li><li><p>ä¿æŠ¤éšç§</p><p>å¦‚æœå¾…å‘å¸ƒçš„åŒ…ï¼Œå¹¶éå¼€æºé¡¹ç›®ï¼Œè€Œä»…ä»…æ˜¯ä¸ºäº†æä¾›å¼€å‘è€… NPM å®‰è£…ã€ä½¿ç”¨ï¼Œä¸€å®šè¦åšå¥½éšç§ä¿æŠ¤å·¥ä½œï¼Œé˜²æ­¢æºç ã€éšç§çš„æ–‡æ¡£ç­‰éšç§˜ä¿¡æ¯è¢«å‘å¸ƒåˆ° NPM ä»“åº“ã€‚</p><p>å¯ä»¥é€‰ç”¨çš„æ–¹æ³•å¦‚ä¸‹ï¼š</p><ol><li><p><code>.gitignore</code> è®¾ç½®å¿½ç•¥å“ªäº›æ–‡ä»¶</p><p>.gitignore è®¾ç½®çš„å¿½ç•¥æ–‡ä»¶ï¼Œåœ¨ git ä»£ç ç®¡ç†å’Œ npm publish éƒ½ä¼šè¢«å¿½ç•¥ã€‚</p></li><li><p>.npmignore è®¾ç½®å¿½ç•¥å“ªäº›æ–‡ä»¶</p><p>.npmignore ä¼˜å…ˆçº§æ›´é«˜ï¼Œå¦‚æœåŒæ—¶ä½¿ç”¨äº† .npmignore å’Œ .gitignoreï¼Œåªæœ‰ .npmignore ä¼šç”Ÿæ•ˆã€‚</p></li><li><p>package.json æ–‡ä»¶çš„ files å­—æ®µ</p><p>ç›´æ¥åœ¨ package.json æ–‡ä»¶ä¸­é…ç½® <code>files</code>ï¼ŒæŒ‡å®šå‘å¸ƒå“ªäº›æ–‡ä»¶ã€ç›®å½•ï¼Œä¼˜å…ˆçº§é«˜äº .npmignore å’Œ .gitignoreã€‚</p></li></ol></li><li><p>ä»¥ä¸‹æ–‡ä»¶ã€ç›®å½•åœ¨å‘å¸ƒæ—¶ï¼Œé»˜è®¤ä¼šè¢«å¿½ç•¥</p><pre><code class="txt">.*.swp._*.DS_Store.git.hg.npmrc.lock-wscript.svn.wafpickle-*config.gypiCVSnpm-debug.lognode_modules/</code></pre></li><li><p>ä»¥ä¸‹æ–‡ä»¶ã€ç›®å½•åœ¨å‘å¸ƒæ—¶ï¼Œé»˜è®¤ä¼šè¢«åŒ…å«ï¼Œæ— æ³•å¿½ç•¥æ‰</p><pre><code class="txt">package.jsonREADME (and its variants)CHANGELOG (and its variants)LICENSE / LICENCE</code></pre></li></ol><h2 id="æ­£å¼å‘å¸ƒ"><a href="#æ­£å¼å‘å¸ƒ" class="headerlink" title="æ­£å¼å‘å¸ƒ"></a>æ­£å¼å‘å¸ƒ</h2><ol><li><p>ç™»å½• NPM è´¦å·</p><ol><li><p>åœ¨ç»ˆç«¯è¿è¡Œå‘½ä»¤ï¼Œå¡«å†™è´¦å·ã€å¯†ç åŠé‚®ç®±ã€‚</p><pre><code class="sh">npm adduser / npm login</code></pre></li><li><p>æŸ¥çœ‹æ˜¯å¦ç™»å½•ä¸Šäº†ï¼Ÿ</p><pre><code class="sh">npm who am i</code></pre></li><li><p>é€šå¸¸åªæœ‰ä¸€ä¸ªäººå¯ä»¥å‘å¸ƒï¼Œä¹Ÿå¯ä»¥æ·»åŠ å¤šäººï¼Œç›¸å…³å‘½ä»¤å¦‚ä¸‹ï¼š</p><pre><code class="sh">npm owner ls &lt;package name&gt;             # æŸ¥çœ‹npm owner add &lt;user&gt; &lt;package name&gt;     # æ·»åŠ npm owner rm &lt;user&gt; &lt;package name&gt;      # åˆ é™¤</code></pre></li></ol></li><li><p>å‘å¸ƒ</p><pre><code class="sh">npm publish . --access=public</code></pre><ol><li><p>è¿™é‡Œæ³¨æ„ä¸€ä¸‹å‘å¸ƒå‘½ä»¤ä¸­çš„ç‚¹ <code>.</code> ï¼Œå¦‚æœä¸å¸¦ <code>.</code> ï¼Œå¶å°”ç¢°åˆ°å‘å¸ƒä¼šå‡ºé”™ã€‚</p></li><li><p>åŒ…åé‡å¤ï¼ˆæˆ–è€…è¯´å·²è¢«å ç”¨ï¼‰ã€æœªç™»å½•ï¼Œéƒ½ä¼šå¯¼è‡´å‘å¸ƒå¤±è´¥ï¼Œæ³¨æ„çœ‹æç¤ºä¿¡æ¯ã€‚</p></li><li><p>æ³¨æ„ç‰ˆæœ¬å·å¿…é¡»è¦é€’å¢ï¼Œç›¸åŒçš„ç‰ˆæœ¬å·æˆ–ç‰ˆæœ¬å·é€’å‡ä¼šå‘å¸ƒå¤±è´¥ã€‚</p></li></ol></li></ol><h2 id="æ’¤å›å·²å‘å¸ƒçš„ç‰ˆæœ¬"><a href="#æ’¤å›å·²å‘å¸ƒçš„ç‰ˆæœ¬" class="headerlink" title="æ’¤å›å·²å‘å¸ƒçš„ç‰ˆæœ¬"></a>æ’¤å›å·²å‘å¸ƒçš„ç‰ˆæœ¬</h2><pre><code class="sh">npm unpublish -f &lt;package name&gt;@&lt;package version&gt;</code></pre><ol><li><p>åŒ…å‘å¸ƒåçš„ 72 å°æ—¶å†…ï¼Œå¯ä»¥æ’¤å›ã€‚</p></li><li><p>å·²æ’¤å›çš„ç‰ˆæœ¬ï¼Œè¯¥ç‰ˆæœ¬å·å°±ä¸èƒ½å†é‡æ–°å‘å¸ƒäº†ï¼Œå› ä¸ºåœ¨ NPM çš„ä»“åº“ä¸­å·²ç»æœ‰äº†è®°å½•ã€‚</p></li></ol><h2 id="å…¶å®ƒé—®é¢˜"><a href="#å…¶å®ƒé—®é¢˜" class="headerlink" title="å…¶å®ƒé—®é¢˜"></a>å…¶å®ƒé—®é¢˜</h2><ol><li><p>å¶å°”å¯èƒ½ä¼šçœ‹åˆ°å¦‚ä¸‹é”™è¯¯:</p><pre><code class="sh">no_perms Private mode enable, only admin can publish this module</code></pre><p>è§£å†³åŠæ³•ï¼š</p><pre><code class="sh">npm config set registry http://registry.npmjs.org</code></pre></li><li><p>NPM å®˜æ–¹æä¾›äº†å‘å¸ƒçš„æŒ‡å¯¼ï¼š<a href="https://docs.npmjs.com/misc/developers">https://docs.npmjs.com/misc/developers</a> ï¼Œå¦‚æœé‡åˆ°ä¸€äº›å¥‡æ€ªçš„é—®é¢˜ï¼Œå»ºè®®å‰å¾€é˜…è¯»ã€‚</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> NPM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NPM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è§„èŒƒ git commit</title>
      <link href="/2020/03/25/git/commit/"/>
      <url>/2020/03/25/git/commit/</url>
      
        <content type="html"><![CDATA[<p>å¦‚ä½•è®© <code>git commit</code> æäº¤æ—¶æ›´åŠ è§„èŒƒï¼Ÿä¾‹å¦‚ï¼švueã€angularï¼Œå¦‚ä¸‹å›¾ã€‚è§„èŒƒåŒ–åœ°æäº¤è®°å½•ï¼Œä¼šè®©å°†æ¥çš„å›æº¯æŸ¥æ‰¾æ›´å®¹æ˜“ï¼Œä¹Ÿè®©å…¶ä»–äººé˜…è¯»èµ·æ¥æ›´åŠ ç®€ä¾¿ã€‚</p><p><img src="https://user-gold-cdn.xitu.io/2020/5/12/172081ff77566188?w=996&h=1021&f=png&s=251160" alt=""></p><p>æœ€è¿‘è¯»åˆ°ä¸€ç¯‡ä¸é”™çš„æ–‡ç« ï¼ˆ<a href="https://juejin.im/post/5e0c82a15188253a907111dc">ä½ å¯èƒ½å·²ç»å¿½ç•¥çš„ git commit è§„èŒƒ</a>ï¼‰ï¼Œå¸å–ä¸‹å…»åˆ†ï¼Œé¡ºä¾¿åšä¸ªè®°å½•ã€‚æ–‡ç« ä»‹ç»å¾—å¾ˆæ¸…æ¥šï¼Œå»ºè®®é˜…è¯»åŸæ–‡ï¼Œä¸åšé¢å¤–èµ˜è¿°ï¼Œä»¥ä¸‹ä¸ºé›†æˆåˆ°é¡¹ç›®çš„å¿«é€ŸæŒ‡å—ã€‚</p><h2 id="å¿«é€ŸæŒ‡å—"><a href="#å¿«é€ŸæŒ‡å—" class="headerlink" title="å¿«é€ŸæŒ‡å—"></a>å¿«é€ŸæŒ‡å—</h2><p>ä½¿ç”¨åˆ°çš„å·¥å…· <a href="https://github.com/commitizen/cz-cli">commitizen</a>ã€<a href="https://github.com/typicode/husky">husky</a>ã€<a href="https://github.com/carloscuesta/gitmoji-cli">gitmoji-cli</a>ï¼Œcz-conventional-changelog æ˜¯ angular çš„ commit message æ ¼å¼ã€‚</p><p>æ‰€æœ‰åŒ…ä¸æ¨è global å®‰è£…ï¼Œè€Œä»…é¡¹ç›®æœ¬åœ°å®‰è£…ï¼Œæ–¹ä¾¿å¤šäººå¼€å‘æ—¶ï¼Œå‡å°‘å…¶ä»–äººçš„é¢å¤–æ“ä½œã€‚</p><ol><li><p>å®‰è£…å·¥å…·</p><pre><code class="bash"> yarn add commitizen cz-conventional-changelog -D</code></pre></li><li><p>åœ¨é¡¹ç›®æ ¹ç›®å½•çš„ package.json ä¸­æ·»åŠ é…ç½®</p><pre><code class="json"> &#123;   &quot;scripts&quot;: &#123;     &quot;commit&quot;: &quot;git-cz&quot;   &#125;,   &quot;config&quot;: &#123;     &quot;commitizen&quot;: &#123;       &quot;path&quot;: &quot;./node_modules/cz-conventional-changelog&quot;     &#125;   &#125; &#125;</code></pre><p> å®˜æ–¹æ¨èçš„æ˜¯ global å®‰è£… commitizenï¼Œç„¶åæ‰§è¡Œ <code>commitizen init cz-conventional-changelog --yarn --dev --exact</code> å»è‡ªåŠ¨æ·»åŠ  cz-conventional-changelogï¼Œè‡ªåŠ¨åœ¨ package.json ä¸­æ·»åŠ  config é…ç½®ï¼Œä¸å¤ªæ¨èè¿™ç§æ–¹å¼ã€‚</p></li><li><p>ä½¿ç”¨</p><ul><li><p><code>git commit</code> ä»ç„¶æ˜¯æ™®é€šçš„ git æäº¤æ¨¡å¼</p></li><li><p><code>yarn commit</code> ä¼šæ‰§è¡Œäº¤äº’å¼ commit æäº¤ï¼Œåœ¨ç»ˆç«¯è·Ÿç€æç¤ºä¸€æ­¥æ­¥è¾“å…¥å³å¯ã€‚</p></li></ul></li><li><p>é™åˆ¶æ¯ä¸€æ¬¡ <code>git commit</code> éƒ½æ‰§è¡Œäº¤äº’å¼æäº¤</p><p> å¦‚æœæƒ³è¦æ›´æš´åŠ›ä¸€ç‚¹ï¼Œé™åˆ¶æ¯ä¸€æ¬¡ <code>git commit</code> éƒ½è‡ªåŠ¨æ‰§è¡Œè§„èŒƒåŒ–åœ°æäº¤ï¼Œå¯ä»¥é…ç½® git æäº¤çš„é’©å­ï¼Œå€ŸåŠ© husky æ›´æ–¹ä¾¿ä¸€ç‚¹ï¼ˆä¸ç”¨ husky å½“ç„¶ä¹Ÿå¯ä»¥ï¼‰ã€‚</p><p> å…ˆå°† scripts ä¸­é…ç½®çš„ commit å‘½ä»¤åˆ é™¤ï¼Œä¸å†éœ€è¦äº†ã€‚</p><p> å®‰è£… husky</p><pre><code class="bash"> yarn add husky -D</code></pre><p> åœ¨ package.json ä¸­å¢åŠ é…ç½®</p><pre><code class="json"> &#123;   &quot;husky&quot;: &#123;     &quot;hooks&quot;: &#123;       &quot;prepare-commit-msg&quot;: &quot;exec &lt; /dev/tty &amp;&amp; git cz --hook || true&quot;     &#125;   &#125;, &#125;</code></pre><p> æœ‰äº›æ—¶å€™å¯èƒ½ä¸å¤ªéœ€è¦æ‰€æœ‰çš„ commit éƒ½æ‰§è¡Œè§„èŒƒåŒ–çš„æäº¤æµç¨‹ï¼Œå› æ­¤ï¼Œæ¨èä¸è¦è¿™ä¹ˆæš´åŠ›é™åˆ¶ï¼Œè€Œæ˜¯ä»…åœ¨å…³é”®æ€§çš„æäº¤æ­¥éª¤æ‰æ‰§è¡Œã€‚</p></li></ol><h2 id="åœ¨æäº¤ä¸­æ”¯æŒè¡¨æƒ…ç¬¦å·"><a href="#åœ¨æäº¤ä¸­æ”¯æŒè¡¨æƒ…ç¬¦å·" class="headerlink" title="åœ¨æäº¤ä¸­æ”¯æŒè¡¨æƒ…ç¬¦å·"></a>åœ¨æäº¤ä¸­æ”¯æŒè¡¨æƒ…ç¬¦å·</h2><p>å¦‚æœæƒ³è¦åœ¨æäº¤ä¸­ä½¿ç”¨ä¸€äº›è¡¨æƒ…ç¬¦å·ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="https://user-gold-cdn.xitu.io/2020/5/12/172086dbf52c646f?w=2016&h=1570&f=png&s=405106" alt=""></p><p>åœ¨æäº¤æ—¶æŒ‰ç…§çº¦å®šæ ¼å¼è¾“å…¥è¡¨æƒ…å­—ç¬¦å³å¯ï¼ˆå·¦å³ä¸¤è¾¹è‹±æ–‡å†’å·å¤¹ç€å­—ç¬¦ï¼Œä¾‹å¦‚bug â˜ <code>:bug:</code>ï¼‰ï¼Œæäº¤åä¼šè‡ªåŠ¨è¢«æ˜¾ç¤ºï¼ˆè€Œæ— éœ€å®‰è£…<a href="https://github.com/carloscuesta/gitmoji-cli">gitmoji-cli</a>ç­‰å·¥å…·ï¼‰ï¼Œç¤ºä¾‹ï¼š</p><pre><code class="bash">git commit -m &quot;fix(src): :bug: ä¿®å¤åˆ—è¡¨æ˜¾ç¤ºé—®é¢˜&quot;</code></pre><p>å¦‚æœæƒ³è¦æŸ¥çœ‹æ‰€æœ‰çš„è¡¨æƒ…ç¬¦å·åŠä»‹ç»ï¼Œå¯ä»¥<a href="https://gitmoji.carloscuesta.me/">å»å®˜æ–¹æ–‡æ¡£æŸ¥é˜…</a>ã€‚</p><h2 id="å¸¸è§çš„-commit-ç±»å‹"><a href="#å¸¸è§çš„-commit-ç±»å‹" class="headerlink" title="å¸¸è§çš„ commit ç±»å‹"></a>å¸¸è§çš„ commit ç±»å‹</h2><ul><li>feat: æ–°å¢feature</li><li>fix: ä¿®å¤bug</li><li>docs: ä»…ä»…ä¿®æ”¹äº†æ–‡æ¡£ï¼Œå¦‚readme.md</li><li>style: ä»…ä»…æ˜¯å¯¹æ ¼å¼è¿›è¡Œä¿®æ”¹ï¼Œå¦‚é€—å·ã€ç¼©è¿›ã€ç©ºæ ¼ç­‰ã€‚ä¸æ”¹å˜ä»£ç é€»è¾‘ã€‚</li><li>refactor: ä»£ç é‡æ„ï¼Œæ²¡æœ‰æ–°å¢åŠŸèƒ½æˆ–ä¿®å¤bug</li><li>perf: ä¼˜åŒ–ç›¸å…³ï¼Œå¦‚æå‡æ€§èƒ½ã€ç”¨æˆ·ä½“éªŒç­‰ã€‚</li><li>test: æµ‹è¯•ç”¨ä¾‹ï¼ŒåŒ…æ‹¬å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ã€‚</li><li>chore: æ”¹å˜æ„å»ºæµç¨‹ã€æˆ–è€…å¢åŠ ä¾èµ–åº“ã€å·¥å…·ç­‰ã€‚</li><li>revert: ç‰ˆæœ¬å›æ»š</li></ul><h2 id="æ‰‹å†™-commit-çš„æ¨èå†™æ³•"><a href="#æ‰‹å†™-commit-çš„æ¨èå†™æ³•" class="headerlink" title="æ‰‹å†™ commit çš„æ¨èå†™æ³•"></a>æ‰‹å†™ commit çš„æ¨èå†™æ³•</h2><p>å¦‚æœé€šè¿‡ç®€å•çš„ git commit -m â€œâ€ æäº¤ï¼Œä½ å¤§æ¦‚å¯ä»¥è¿™æ ·å†™ï¼š</p><pre><code class="bash">git commit -m &quot;feat(player): æ’­æ”¾åŠŸèƒ½å¼€å‘å®Œæˆ&quot;</code></pre><p>å¼•å·å†…å³ commit çš„ message:</p><ul><li>feat è¡¨æ˜æœ¬æ¬¡æäº¤çš„ç±»å‹</li><li>æ‹¬å·å†…å®¹æ˜¯æœ¬æ¬¡ä»£ç çš„å½±å“ç›®å½•/æ–‡ä»¶</li><li>å†’å·åé¢æ˜¯æœ¬æ¬¡æäº¤çš„ç®€çŸ­æè¿°ï¼ˆå†’å·åé¢æ¨èæ¥ä¸ªç©ºæ ¼ï¼‰  </li></ul><p>åŠ ç‚¹è¡¨æƒ…ç¬¦å·ï¼ˆå½“ç„¶ï¼Œä½ è¦å…ˆå®‰è£… gitmoji-cliï¼‰ï¼š</p><pre><code class="bash">git commit -m &quot;feat(player): :rocket: æ’­æ”¾åŠŸèƒ½å¼€å‘å®Œæˆ&quot;</code></pre>]]></content>
      
      
      <categories>
          
          <category> Git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Git Hook æäº¤æ—¶ä¿®æ”¹ç‰ˆæœ¬å·</title>
      <link href="/2020/03/12/nodejs/check-version/"/>
      <url>/2020/03/12/nodejs/check-version/</url>
      
        <content type="html"><![CDATA[<p>å‰ç«¯é¡¹ç›®åœ¨ Git æäº¤æ—¶ï¼Œå¾€å¾€ä¼šé—å¿˜æ›´æ–°é¡¹ç›®æ ¹ç›®å½•çš„ package.json æ–‡ä»¶çš„ versionï¼Œé€šå¸¸ä¸ä¿®æ”¹ä¹Ÿä¸ä¼šæœ‰å•¥é—®é¢˜ï¼Œä½†å¯¹äºå¼ºè¿«ç—‡æ¥è¯´ï¼Œä¸èƒ½å¿ï¼å’±è¦æ”¹æ‰å®ƒâ€¦â€¦</p><h4 id="ç¼–å†™ä¸€ä¸ªç®€å•çš„-node-è„šæœ¬-check-version-js"><a href="#ç¼–å†™ä¸€ä¸ªç®€å•çš„-node-è„šæœ¬-check-version-js" class="headerlink" title="ç¼–å†™ä¸€ä¸ªç®€å•çš„ node è„šæœ¬ check-version.js"></a>ç¼–å†™ä¸€ä¸ªç®€å•çš„ node è„šæœ¬ <code>check-version.js</code></h4><p>å…ˆå®‰è£…å‡ ä¸ªä¾èµ–åŒ… <code>yarn add inquirer chalk child_process -D</code></p><pre><code class="js">// /scripts/check-version.jsconst inquirer = require(&#39;inquirer&#39;);const chalk = require(&#39;chalk&#39;);const &#123; exec &#125; = require(&#39;child_process&#39;);const &#123; name: projectName, version: versionCurrent &#125; = require(&#39;../package&#39;);const regVersion = /^[1-9]&#123;1&#125;\d*\.\d+\.\d+$/; // ç¤ºä¾‹: 1.0.0// const regVersion = /^\d+\.\d+\.\d+$/ // ç¤ºä¾‹: 0.0.1 / 1.0.1// const regVersion = /^\d+\.\d+\.\d+(-beta.?\d*)?$/ // ç¤ºä¾‹: 1.0.3 / 0.0.1-beta / 1.0.0-beta.3console.log(&#39;\n&#39;);// ç¡®è®¤ package.json ç‰ˆæœ¬å·inquirer  .prompt([    &#123;      type: &#39;input&#39;,      name: &#39;version&#39;,      message: `è¯·ç¡®è®¤ $&#123;projectName&#125;/package.json/version ç‰ˆæœ¬å·ï¼ˆå½“å‰ï¼š$&#123;versionCurrent&#125;ï¼‰ï¼š\n`,      default: versionCurrent,      validate(version) &#123;        // æ ¡éªŒç‰ˆæœ¬å·çš„æ ¼å¼        if (!regVersion.test(version)) &#123;          console.log(chalk.yellow(&#39;è¾“å…¥çš„ç‰ˆæœ¬å·æ— æ•ˆï¼Œè¯·æ£€æŸ¥æ ¼å¼ï¼ˆç¤ºä¾‹ï¼š1.0.0ã€2.3.2ï¼‰&#39;));          return false;        &#125;        return true;      &#125;,    &#125;,  ])  .then((&#123; version: versionNew &#125;) =&gt; &#123;    if (versionNew !== versionCurrent) &#123;      // æ›´æ–° package.json versionï¼Œæ›´æ–°æ—¶ä¸è‡ªåŠ¨ç”Ÿæˆ tag      command(`npm --no-git-tag-version version $&#123;versionNew&#125;`, &#123;&#125;, (error, stdout, stderr) =&gt; &#123;        if (!error) &#123;          console.log(            chalk.green(              `\n$&#123;projectName&#125; ç‰ˆæœ¬å·ï¼ˆé¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ package.json/versionï¼‰æ›´æ–°æˆåŠŸï¼Œversion: $&#123;versionNew&#125; ï¼`,            ),          );          command(            `git add package.json &amp;&amp; git commit -m &#39;ci(package.json): æ›´æ–°é¡¹ç›®ç‰ˆæœ¬å·ä¸ºï¼š$&#123;versionNew&#125;&#39;`,          );          console.log(`\n`);          process.exit(0);        &#125; else &#123;          console.log(chalk.yellow(`\næ›´æ–°ç‰ˆæœ¬å·ï¼ˆ$&#123;versionNew&#125;ï¼‰å¤±è´¥äº†~\n`));          process.exit(1);        &#125;      &#125;);    &#125; else &#123;      console.log(chalk.green(`\næœ¬æ¬¡ç‰ˆæœ¬å·æœªåšä¿®æ”¹ï¼Œversion: $&#123;versionNew&#125; ï¼\n`));    &#125;  &#125;);function command(cmd, options, callback) &#123;  console.log(&#39;\n&#39;);  console.log(chalk.cyan(cmd.toString()));  return exec(cmd, &#123; ...options &#125;, callback);&#125;</code></pre><h4 id="é…ç½®-Git-é’©å­"><a href="#é…ç½®-Git-é’©å­" class="headerlink" title="é…ç½® Git é’©å­"></a>é…ç½® Git é’©å­</h4><ol><li><p>å…ˆå®‰è£… <code>yorkie</code>ï¼Œç”¨äºç®¡ç† git é’©å­ï¼Œå½“ç„¶ï¼Œä½¿ç”¨åŸç”Ÿçš„ä¹Ÿå¯ä»¥ã€‚</p><pre><code class="bash">yarn add yorkie -D</code></pre></li><li><p>åœ¨é¡¹ç›®çš„ package.json æ–‡ä»¶ä¸­å¢åŠ ä»¥ä¸‹é…ç½®ï¼š</p><pre><code class="json">&quot;gitHooks&quot;: &#123;  &quot;post-commit&quot;: &quot;exec &lt; /dev/tty &amp;&amp; node scripts/check-version.js&quot;&#125;,</code></pre></li></ol><h4 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h4><p>å®Œæˆä»¥ä¸Šé…ç½®åï¼Œåç»­åœ¨æ‰§è¡Œ git commit æäº¤ä»£ç æ—¶ï¼Œä¼šè‡ªåŠ¨åœ¨ç»ˆç«¯å¼¹å‡ºäº¤äº’ï¼Œæç¤ºä¿®æ”¹ package.json æ–‡ä»¶çš„ versionï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="https://user-gold-cdn.xitu.io/2020/6/10/1729d6b37f7e5254?w=1326&h=348&f=png&s=55796" alt=""></p><p>å¦‚æœä¸éœ€è¦ä¿®æ”¹ç›´æ¥æ•²å‡» Enter è·³è¿‡ï¼Œéœ€è¦åˆ™è¾“å…¥æ–°çš„ç‰ˆæœ¬å·ï¼Œä¼šè‡ªåŠ¨æ‰§è¡Œå‘½ä»¤ä¿®æ”¹ package.json æ–‡ä»¶çš„ versionï¼Œå¹¶è‡ªåŠ¨æäº¤åˆšåˆšçš„ä¿®æ”¹ï¼Œæ¥ä¸‹æ¥ <code>git push</code> æ¨é€ä»£ç å³å¯ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> NodeJS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Git </tag>
            
            <tag> NPM </tag>
            
            <tag> NodeJS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Git å‘½ä»¤æ¸…å•</title>
      <link href="/2020/03/02/git/command/"/>
      <url>/2020/03/02/git/command/</url>
      
        <content type="html"><![CDATA[<p>Git å¸¸ç”¨å‘½ä»¤åšä¸€æ³¢æ•´ç†ï¼Œæ–¹ä¾¿éšæ—¶æŸ¥é˜…ã€‚</p><blockquote><p>ä¸»è¦å†…å®¹å‡ºè‡ªé˜®ä¸€å³°å¤§ä½¬çš„ç§‘æ™®æ–‡ç« ï¼š<a href="http://www.ruanyifeng.com/blog/2015/12/git-cheat-sheet.html">http://www.ruanyifeng.com/blog/2015/12/git-cheat-sheet.html</a> ã€‚</p></blockquote><p><img src="https://www.ruanyifeng.com/blogimg/asset/2015/bg2015120901.png" alt=""></p><p>å‡ ä¸ªä¸“ç”¨åè¯çš„è¯‘åå¦‚ä¸‹ï¼š</p><ul><li>Workspaceï¼šå·¥ä½œåŒº</li><li>Index / Stageï¼šæš‚å­˜åŒº</li><li>Repositoryï¼šä»“åº“åŒºï¼ˆæˆ–æœ¬åœ°ä»“åº“ï¼‰</li><li>Remoteï¼šè¿œç¨‹ä»“åº“</li></ul><h2 id="ä¸€ã€æ–°å»ºä»£ç åº“"><a href="#ä¸€ã€æ–°å»ºä»£ç åº“" class="headerlink" title="ä¸€ã€æ–°å»ºä»£ç åº“"></a>ä¸€ã€æ–°å»ºä»£ç åº“</h2><pre><code class="zsh"># åœ¨å½“å‰ç›®å½•æ–°å»ºä¸€ä¸ª Git ä»£ç åº“$ git init# æ–°å»ºä¸€ä¸ªç›®å½•ï¼Œå°†å…¶åˆå§‹åŒ–ä¸º Git ä»£ç åº“$ git init [project-name]# ä¸‹è½½ä¸€ä¸ªé¡¹ç›®å’Œå®ƒçš„æ•´ä¸ªä»£ç å†å²$ git clone [url]</code></pre><h2 id="äºŒã€é…ç½®"><a href="#äºŒã€é…ç½®" class="headerlink" title="äºŒã€é…ç½®"></a>äºŒã€é…ç½®</h2><p>Git çš„è®¾ç½®æ–‡ä»¶ä¸º <code>.gitconfig</code>ï¼Œå®ƒå¯ä»¥åœ¨ç”¨æˆ·ä¸»ç›®å½•ä¸‹ï¼ˆå…¨å±€é…ç½®ï¼‰ï¼Œä¹Ÿå¯ä»¥åœ¨é¡¹ç›®ç›®å½•ä¸‹ï¼ˆé¡¹ç›®é…ç½®ï¼‰ã€‚</p><pre><code class="zsh"># æ˜¾ç¤ºå½“å‰çš„ Git é…ç½®$ git config --list# ç¼–è¾‘ Git é…ç½®æ–‡ä»¶$ git config -e [--global]# è®¾ç½®æäº¤ä»£ç æ—¶çš„ç”¨æˆ·ä¿¡æ¯(è®¾ç½®æœ¬æœºçš„ç”¨æˆ·åï¼Œé‚®ç®±)$ git config [--global] user.name &quot;[name]&quot;$ git config [--global] user.email &quot;[email address]&quot;# æŸ¥çœ‹ç”¨æˆ·ä¿¡æ¯$ git config user.name -g$ git config user.email -g# æŸ¥çœ‹å…¬å¼€å¯†é’¥$ cat ~/.ssh/id_rsa.pub# éªŒè¯å¯†é’¥æ˜¯å¦å·²è¿æ¥æˆåŠŸ(ä»¥ github ä¸ºä¾‹)$ ssh -T git@github.com# åˆ›å»º SSH Key$ ssh-keygen -t rsa -C &quot;youremail@example&quot;# è§£å†³æ¯æ¬¡è¦æ±‚è¾“å…¥ç”¨æˆ·å/å¯†ç çš„é—®é¢˜$ git config --global credential.helper store# è®¾ç½® http ä»£ç†$ git config --global http.proxy 10.100.10.100:3128# è®¾ç½® Git å¯¹æ–‡ä»¶/æ–‡ä»¶å¤¹å¤§å°å†™æ•æ„Ÿ$ git config core.ignorecase false# è®¾ç½®å…¨å±€ pull rebase$ git config --global pull.rebase true# gitlab ip å˜åŒ–å$ rm -rf ~/.ssh/known_hosts åˆ é™¤åé‡æ–°æ“ä½œå³å¯</code></pre><h2 id="ä¸‰ã€å¢åŠ -åˆ é™¤æ–‡ä»¶"><a href="#ä¸‰ã€å¢åŠ -åˆ é™¤æ–‡ä»¶" class="headerlink" title="ä¸‰ã€å¢åŠ /åˆ é™¤æ–‡ä»¶"></a>ä¸‰ã€å¢åŠ /åˆ é™¤æ–‡ä»¶</h2><pre><code class="zsh"># æ·»åŠ æŒ‡å®šæ–‡ä»¶åˆ°æš‚å­˜åŒº$ git add [file1] [file2] ...# æ·»åŠ æŒ‡å®šç›®å½•åˆ°æš‚å­˜åŒºï¼ŒåŒ…æ‹¬å­ç›®å½•$ git add [dir]# æ·»åŠ å½“å‰ç›®å½•çš„æ‰€æœ‰æ–‡ä»¶åˆ°æš‚å­˜åŒº$ git add .$ git add -A æ·»åŠ æ‰€æœ‰æ–‡ä»¶# æ·»åŠ æ¯ä¸ªå˜åŒ–å‰ï¼Œéƒ½ä¼šè¦æ±‚ç¡®è®¤# å¯¹äºåŒä¸€ä¸ªæ–‡ä»¶çš„å¤šå¤„å˜åŒ–ï¼Œå¯ä»¥å®ç°åˆ†æ¬¡æäº¤$ git add -p# åˆ é™¤å·¥ä½œåŒºæ–‡ä»¶ï¼Œå¹¶ä¸”å°†è¿™æ¬¡åˆ é™¤æ”¾å…¥æš‚å­˜åŒº$ git rm [file1] [file2] ...# åœæ­¢è¿½è¸ªæŒ‡å®šæ–‡ä»¶ï¼Œä½†è¯¥æ–‡ä»¶ä¼šä¿ç•™åœ¨å·¥ä½œåŒº$ git rm --cached [file]# æ”¹åæ–‡ä»¶ï¼Œå¹¶ä¸”å°†è¿™ä¸ªæ”¹åæ”¾å…¥æš‚å­˜åŒº$ git mv [file-original] [file-renamed]</code></pre><h2 id="å››ã€ä»£ç æäº¤"><a href="#å››ã€ä»£ç æäº¤" class="headerlink" title="å››ã€ä»£ç æäº¤"></a>å››ã€ä»£ç æäº¤</h2><pre><code class="zsh"># æäº¤æš‚å­˜åŒºåˆ°ä»“åº“åŒº$ git commit -m [message]# æäº¤æš‚å­˜åŒºçš„æŒ‡å®šæ–‡ä»¶åˆ°ä»“åº“åŒº$ git commit [file1] [file2] ... -m [message]# æäº¤å·¥ä½œåŒºè‡ªä¸Šæ¬¡ commit ä¹‹åçš„å˜åŒ–ï¼Œç›´æ¥åˆ°ä»“åº“åŒº$ git commit -a# æäº¤æ—¶æ˜¾ç¤ºæ‰€æœ‰ diff ä¿¡æ¯$ git commit -v# ä½¿ç”¨ä¸€æ¬¡æ–°çš„ commitï¼Œæ›¿ä»£ä¸Šä¸€æ¬¡æäº¤# å¦‚æœä»£ç æ²¡æœ‰ä»»ä½•æ–°å˜åŒ–ï¼Œåˆ™ç”¨æ¥æ”¹å†™ä¸Šä¸€æ¬¡ commit çš„æäº¤ä¿¡æ¯$ git commit --amend -m [message]# é‡åšä¸Šä¸€æ¬¡ commitï¼Œå¹¶åŒ…æ‹¬æŒ‡å®šæ–‡ä»¶çš„æ–°å˜åŒ–$ git commit --amend [file1] [file2] ...</code></pre><h2 id="äº”ã€åˆ†æ”¯"><a href="#äº”ã€åˆ†æ”¯" class="headerlink" title="äº”ã€åˆ†æ”¯"></a>äº”ã€åˆ†æ”¯</h2><pre><code class="zsh"># æœ‰æ—¶å€™çœ‹ä¸åˆ°è¿œç¨‹çš„åˆ†æ”¯ï¼Œé‚£ä¹ˆæ›´æ–°ä¸‹è¿œç¨‹åº“çš„ç´¢å¼•$ git fetch# åˆ—å‡ºæ‰€æœ‰æœ¬åœ°åˆ†æ”¯$ git branch# åˆ—å‡ºæ‰€æœ‰è¿œç¨‹åˆ†æ”¯$ git branch -r# åˆ—å‡ºæ‰€æœ‰æœ¬åœ°åˆ†æ”¯å’Œè¿œç¨‹åˆ†æ”¯$ git branch -a# æ–°å»ºä¸€ä¸ªåˆ†æ”¯ï¼Œä½†ä¾ç„¶åœç•™åœ¨å½“å‰åˆ†æ”¯$ git branch [branch-name]# æ–°å»ºä¸€ä¸ªåˆ†æ”¯ï¼Œå¹¶åˆ‡æ¢åˆ°è¯¥åˆ†æ”¯$ git checkout -b [branch]# æ‹‰å–ä¸€ä¸ªæœ¬åœ°ä¸å­˜åœ¨çš„æ–°åˆ†æ”¯ï¼Œå¹¶åˆ‡æ¢åˆ°è¯¥åˆ†æ”¯$ git checkout -b [branch-name] [origin/branch-name]# æ–°å»ºä¸€ä¸ªåˆ†æ”¯ï¼ŒæŒ‡å‘æŒ‡å®š commit$ git branch [branch] [commit]# æ–°å»ºä¸€ä¸ªåˆ†æ”¯ï¼Œä¸æŒ‡å®šçš„è¿œç¨‹åˆ†æ”¯å»ºç«‹è¿½è¸ªå…³ç³»$ git branch --track [branch] [remote-branch]# åˆ‡æ¢åˆ°æŒ‡å®šåˆ†æ”¯ï¼Œå¹¶æ›´æ–°å·¥ä½œåŒº$ git checkout [branch-name]# åˆ‡æ¢åˆ°ä¸Šä¸€ä¸ªåˆ†æ”¯$ git checkout -# å»ºç«‹è¿½è¸ªå…³ç³»ï¼Œåœ¨ç°æœ‰åˆ†æ”¯ä¸æŒ‡å®šçš„è¿œç¨‹åˆ†æ”¯ä¹‹é—´$ git branch --set-upstream [branch] [remote-branch]# åˆå¹¶æŒ‡å®šåˆ†æ”¯åˆ°å½“å‰åˆ†æ”¯$ git merge [branch]# é€‰æ‹©ä¸€ä¸ª commitï¼Œåˆå¹¶è¿›å½“å‰åˆ†æ”¯$ git cherry-pick [commit]# åˆ é™¤åˆ†æ”¯$ git branch -d [branch-name]# åˆ é™¤åˆ†æ”¯(å¦‚æœè¦åˆ é™¤çš„åˆ†æ”¯ï¼Œæœ¬åœ°ä»“åº“æœ‰ä»£ç æ²¡æœ‰ push åˆ°è¿œç¨‹ä»“åº“ï¼Œ-d æ˜¯åˆ ä¸æ‰çš„ï¼Œéœ€è¦ç”¨-D; åˆ‡å›å»å…ˆ push å†åˆ ä¹Ÿè¡Œ.)$ git branch -D [branch-name]# æ‰¹é‡åˆ é™¤æœ¬åœ°åˆ†æ”¯ï¼ˆæ’é™¤ master/develop/test åˆ†æ”¯ï¼‰$ git branch -a | grep -v -E &#39;master|develop|test&#39; | xargs git branch -D# æ‰¹é‡åˆ é™¤æœ¬åœ°åˆ†æ”¯ï¼ˆä»…åŒ…å« releasesï¼‰$ git branch -a | grep &#39;releases&#39; | xargs git branch -D# æ‰¹é‡åˆ é™¤è¿œç¨‹åˆ†æ”¯ï¼ˆæ’é™¤ master/develop/test åˆ†æ”¯ï¼‰$ git branch -r| grep -v -E &#39;master|develop|test&#39; | sed &#39;s/origin\///g&#39; | xargs -I &#123;&#125; git push origin :&#123;&#125;# æ‰¹é‡åˆ é™¤è¿œç¨‹åˆ†æ”¯ï¼ˆä»…åŒ…å« releasesï¼‰$ git branch -r| grep &#39;releases&#39; | sed &#39;s/origin\///g&#39; | xargs -I &#123;&#125; git push origin :&#123;&#125;# é‡å‘½ååˆ†æ”¯(ä¸ä¼šè¦†ç›–å·²å­˜åœ¨çš„åŒååˆ†æ”¯)$ git branch -m [branch-name] [new-name]# é‡å‘½ååˆ†æ”¯(ä¼šè¦†ç›–å·²å­˜åœ¨çš„åŒååˆ†æ”¯)$ git branch -M [branch-name] [new-name]# åˆ é™¤è¿œç¨‹åˆ†æ”¯$ git push origin -d [branch-name] ï¼ˆå°†æœåŠ¡å™¨ä¸Šçš„â€œè¿œç¨‹åˆ†æ”¯â€åˆ é™¤ï¼Œåˆ é™¤è¿œç¨‹åˆ†æ”¯å¸¸ç”¨è¿™ä¸ªã€‚ï¼‰$ git branch -dr [remote/branch] ï¼ˆä»…å°†æœ¬åœ°çš„â€œè¿œç¨‹åˆ†æ”¯â€åˆ é™¤ï¼‰# å¤„ç†å·²ç»ä¸å­˜åœ¨çš„åˆ†æ”¯ï¼ˆæœ‰æ—¶ä¸å­˜åœ¨äº†ï¼Œä½†ä»ç„¶æ˜¾ç¤ºï¼‰$ git remote show origin æŸ¥çœ‹è¿œç¨‹åº“å’Œåˆ†æ”¯çš„æƒ…å†µ$ git remote prune origin å¯ä»¥ç§»é™¤ä¸€äº›å·²ç»ä¸å­˜åœ¨çš„åˆ†æ”¯# æ¯”è¾ƒä¸¤ä¸ªåˆ†æ”¯ä¸åŒ$ git diff [åˆ†æ”¯ A] [åˆ†æ”¯ B] &gt;&gt; xx.txt ï¼ˆæ¯”è¾ƒä¸¤ä¸ªåˆ†æ”¯ä¸åŒï¼Œè¾“å‡ºåˆ°æŸæ–‡æœ¬ï¼‰</code></pre><h2 id="å…­ã€æ ‡ç­¾"><a href="#å…­ã€æ ‡ç­¾" class="headerlink" title="å…­ã€æ ‡ç­¾"></a>å…­ã€æ ‡ç­¾</h2><p>tag å¯¹åº”æŸæ¬¡ commit èŠ‚ç‚¹ï¼Œæ˜¯ä¸€ä¸ªç‚¹ï¼Œæ˜¯ä¸å¯ç§»åŠ¨çš„ã€‚</p><p>branch å¯¹åº”ä¸€ç³»åˆ— commitï¼Œæ˜¯å¾ˆå¤šç‚¹è¿æˆçš„ä¸€æ ¹çº¿ï¼Œæœ‰ä¸€ä¸ª HEAD æŒ‡é’ˆï¼Œå¯ä»¥ä¾é  HEAD æŒ‡é’ˆç§»åŠ¨ã€‚</p><p>ä¸¤è€…çš„åŒºåˆ«å†³å®šäº†ä½¿ç”¨æ–¹å¼ï¼Œæ”¹åŠ¨ä»£ç ç”¨ branch ï¼Œä¸æ”¹åŠ¨åªæŸ¥çœ‹ç”¨ tagã€‚</p><blockquote><p>tag å’Œ branch çš„ç›¸äº’é…åˆä½¿ç”¨ï¼Œæœ‰æ—¶å€™èµ·åˆ°éå¸¸æ–¹ä¾¿çš„æ•ˆæœï¼Œä¾‹å¦‚ï¼šå·²ç»å‘å¸ƒäº† v1.0ã€v2.0ã€v3.0 ä¸‰ä¸ªç‰ˆæœ¬ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘çªç„¶æƒ³ä¸æ”¹ç°æœ‰ä»£ç çš„å‰æä¸‹ï¼Œåœ¨ v2.0 çš„åŸºç¡€ä¸ŠåŠ ä¸ªæ–°åŠŸèƒ½ï¼Œä½œä¸º v4.0 å‘å¸ƒã€‚å°±å¯ä»¥æ£€å‡º v2.0 çš„ä»£ç ä½œä¸ºä¸€ä¸ª branch ï¼Œç„¶åä½œä¸ºå¼€å‘åˆ†æ”¯ã€‚</p></blockquote><pre><code class="zsh"># åˆ—å‡ºæ‰€æœ‰ tag$ git tag# æ–°å»ºä¸€ä¸ª tag åœ¨å½“å‰ commit$ git tag [tag]# æ–°å»ºä¸€ä¸ª tagï¼Œå¹¶åŠ ä¸Šæ³¨é‡Šè¯´æ˜$ git tag -a [tag-name] -m &quot;some words&quot;# æ–°å»ºä¸€ä¸ª tag åœ¨æŒ‡å®š commit$ git tag [tag] [commit]# åˆ é™¤æœ¬åœ° tag$ git tag -d [tag]# åˆ é™¤è¿œç¨‹ tag$ git push origin -d [tagName]$ git push origin :refs/tags/[tagName]# æŸ¥çœ‹ tag ä¿¡æ¯$ git show [tag]# æäº¤æŒ‡å®š tag$ git push [remote] [tag]# æäº¤æ‰€æœ‰ tag$ git push [remote] --tags# æ–°å»ºä¸€ä¸ªåˆ†æ”¯ï¼ŒæŒ‡å‘æŸä¸ª tag$ git checkout -b [branch] [tag]# é‡å‘½å tag (æ–°å»º tag æŒ‡å‘åŸæ¥çš„ tag =&gt; å†åˆ é™¤æ—§çš„ tag =&gt; å¹¶åˆ é™¤è¿œç¨‹æ—§ tag)$ git tag [new-tag-name] [old-tag-name]$ git tag -d [old-tag-name]$ git push [remote] -d [old-tag-name]</code></pre><h2 id="ä¸ƒã€æŸ¥çœ‹ä¿¡æ¯"><a href="#ä¸ƒã€æŸ¥çœ‹ä¿¡æ¯" class="headerlink" title="ä¸ƒã€æŸ¥çœ‹ä¿¡æ¯"></a>ä¸ƒã€æŸ¥çœ‹ä¿¡æ¯</h2><pre><code class="zsh"># æ˜¾ç¤ºæœ‰å˜æ›´çš„æ–‡ä»¶$ git status# æ˜¾ç¤ºå½“å‰åˆ†æ”¯çš„ç‰ˆæœ¬å†å²$ git log# æ˜¾ç¤º commit å†å²ï¼Œä»¥åŠæ¯æ¬¡ commit å‘ç”Ÿå˜æ›´çš„æ–‡ä»¶$ git log --stat# æŸ¥çœ‹åˆ†æ”¯åˆå¹¶å›¾$ git log --graph# æœç´¢æäº¤å†å²ï¼Œæ ¹æ®å…³é”®è¯$ git log -S [keyword]# æ˜¾ç¤ºæŸä¸ª commit ä¹‹åçš„æ‰€æœ‰å˜åŠ¨ï¼Œæ¯ä¸ª commit å æ®ä¸€è¡Œ$ git log [tag] HEAD --pretty=format:%s# æ˜¾ç¤ºæŸä¸ª commit ä¹‹åçš„æ‰€æœ‰å˜åŠ¨ï¼Œå…¶&quot;æäº¤è¯´æ˜&quot;å¿…é¡»ç¬¦åˆæœç´¢æ¡ä»¶$ git log [tag] HEAD --grep feature# æ˜¾ç¤ºæŸä¸ªæ–‡ä»¶çš„ç‰ˆæœ¬å†å²ï¼ŒåŒ…æ‹¬æ–‡ä»¶æ”¹å$ git log --follow [file]$ git whatchanged [file]# æ˜¾ç¤ºæŒ‡å®šæ–‡ä»¶ç›¸å…³çš„æ¯ä¸€æ¬¡ diff$ git log -p [file]# æ˜¾ç¤ºè¿‡å» 5 æ¬¡æäº¤$ git log -5 --pretty --oneline# æ˜¾ç¤ºæ‰€æœ‰æäº¤è¿‡çš„ç”¨æˆ·ï¼ŒæŒ‰æäº¤æ¬¡æ•°æ’åº$ git shortlog -sn# æ˜¾ç¤ºæŒ‡å®šæ–‡ä»¶æ˜¯ä»€ä¹ˆäººåœ¨ä»€ä¹ˆæ—¶é—´ä¿®æ”¹è¿‡$ git blame [file]# æ˜¾ç¤ºæš‚å­˜åŒºå’Œå·¥ä½œåŒºçš„å·®å¼‚$ git diff# æ˜¾ç¤ºæš‚å­˜åŒºå’Œä¸Šä¸€ä¸ª commit çš„å·®å¼‚$ git diff --cached [file]# æ˜¾ç¤ºå·¥ä½œåŒºä¸å½“å‰åˆ†æ”¯æœ€æ–° commit ä¹‹é—´çš„å·®å¼‚$ git diff HEAD# æ˜¾ç¤ºä¸¤æ¬¡æäº¤ä¹‹é—´çš„å·®å¼‚$ git diff [first-branch]...[second-branch]# æ˜¾ç¤ºä»Šå¤©ä½ å†™äº†å¤šå°‘è¡Œä»£ç $ git diff --shortstat &quot;@&#123;0 day ago&#125;&quot;# æ˜¾ç¤ºæŸæ¬¡æäº¤çš„å…ƒæ•°æ®å’Œå†…å®¹å˜åŒ–$ git show [commit]# æ˜¾ç¤ºæŸæ¬¡æäº¤å‘ç”Ÿå˜åŒ–çš„æ–‡ä»¶$ git show --name-only [commit]# æ˜¾ç¤ºæŸæ¬¡æäº¤æ—¶ï¼ŒæŸä¸ªæ–‡ä»¶çš„å†…å®¹$ git show [commit]:[filename]# æ˜¾ç¤ºå½“å‰åˆ†æ”¯çš„æœ€è¿‘å‡ æ¬¡æäº¤$ git reflog</code></pre><h2 id="å…«ã€è¿œç¨‹åŒæ­¥"><a href="#å…«ã€è¿œç¨‹åŒæ­¥" class="headerlink" title="å…«ã€è¿œç¨‹åŒæ­¥"></a>å…«ã€è¿œç¨‹åŒæ­¥</h2><pre><code class="zsh"># ä¸‹è½½è¿œç¨‹ä»“åº“çš„æ‰€æœ‰å˜åŠ¨$ git fetch [remote]# æ˜¾ç¤ºæ‰€æœ‰è¿œç¨‹ä»“åº“$ git remote -v# æ˜¾ç¤ºæŸä¸ªè¿œç¨‹ä»“åº“çš„ä¿¡æ¯$ git remote show [remote]# å¢åŠ ä¸€ä¸ªæ–°çš„è¿œç¨‹ä»“åº“(æœ¬åœ°ä»“åº“ä¸è¿œç¨‹ä»“åº“å»ºç«‹è¿æ¥)ï¼Œå¹¶å‘½å(åˆ«å)$ git remote add [shortname] [url]# åˆ é™¤ä¸€ä¸ªè¿œç¨‹ä»“åº“$ git remote rm [shortname]# è¿œç¨‹ä»“åº“æ›´ååï¼Œä¿®æ”¹è¿æ¥åœ°å€$ git remote set-url [shortname] [new-url]# å–å›è¿œç¨‹ä»“åº“çš„å˜åŒ–ï¼Œå¹¶ä¸æœ¬åœ°åˆ†æ”¯åˆå¹¶$ git pull [remote] [branch]# ä¸Šä¼ æœ¬åœ°æŒ‡å®šåˆ†æ”¯åˆ°è¿œç¨‹ä»“åº“$ git push [remote] [branch]# æ¨é€åˆ†æ”¯åˆ°è¿œç¨‹ä»“åº“(ç¬¬ä¸€æ¬¡éœ€è¦-uï¼Œå»ºç«‹å…³ç³»)$ git push -u [remote] [branch]# å¼ºè¡Œæ¨é€å½“å‰åˆ†æ”¯åˆ°è¿œç¨‹ä»“åº“ï¼Œå³ä½¿æœ‰å†²çª$ git push [remote] --forcegit push [remote] -f# æ¨é€æ‰€æœ‰åˆ†æ”¯åˆ°è¿œç¨‹ä»“åº“$ git push [remote] --all</code></pre><h2 id="ä¹ã€æ’¤é”€"><a href="#ä¹ã€æ’¤é”€" class="headerlink" title="ä¹ã€æ’¤é”€"></a>ä¹ã€æ’¤é”€</h2><h3 id="Checkout"><a href="#Checkout" class="headerlink" title="Checkout"></a>Checkout</h3><p>checkoutï¼Œæ²¡æœ‰ add åˆ°æš‚å­˜åŒºçš„ï¼Œæ’¤å›åˆ°ç‰ˆæœ¬åº“çš„çŠ¶æ€; å·² add åˆ°æš‚å­˜åŒºæœª commitï¼Œå…¶åçš„ä¿®æ”¹ï¼Œæ’¤å›åˆ°æš‚å­˜åŒºçŠ¶æ€ã€‚</p><pre><code class="zsh"># æ¢å¤æš‚å­˜åŒºçš„æŒ‡å®šæ–‡ä»¶åˆ°å·¥ä½œåŒº (å›é€€æŸæ–‡ä»¶åˆ°å·¥ä½œåŒº)$ git checkout [file]# æ¢å¤æŸä¸ª commit çš„æŒ‡å®šæ–‡ä»¶åˆ°æš‚å­˜åŒºå’Œå·¥ä½œåŒº (å›é€€åˆ°æœª commit çŠ¶æ€)$ git checkout [commit] [file]# ä¾‹å¦‚: git checkout 36393f5fc07e54f6704d23d4d92bf0b3773e523c xxx/main/src/util/eg.js# æ¢å¤æš‚å­˜åŒºçš„æ‰€æœ‰æ–‡ä»¶åˆ°å·¥ä½œåŒº (å›é€€æ‰€æœ‰æ–‡ä»¶åˆ°å·¥ä½œåŒº)$ git checkout .</code></pre><h3 id="Reset"><a href="#Reset" class="headerlink" title="Reset"></a>Reset</h3><p>checkout æ˜¯æ’¤é”€ä¿®æ”¹ï¼Œreset æ˜¯åœ¨ç‰ˆæœ¬é—´ç©¿æ¢­ã€‚</p><pre><code class="zsh"># é‡ç½®æŒ‡å®šæ–‡ä»¶åˆ°æŒ‡å®šç‰ˆæœ¬$ git reset [ç‰ˆæœ¬å·] [æ–‡ä»¶è·¯å¾„(ä»é¡¶å±‚ä¸€è·¯ç›¸å¯¹ä¸‹æ¥)]# é‡ç½®æš‚å­˜åŒºçš„æŒ‡å®šæ–‡ä»¶ï¼Œä¸ä¸Šä¸€æ¬¡ commit ä¿æŒä¸€è‡´ï¼Œä½†å·¥ä½œåŒºä¸å˜$ git reset [file]# é‡ç½®æš‚å­˜åŒº$ git reset HEAD# é‡ç½®æš‚å­˜åŒºä¸å·¥ä½œåŒºï¼Œä¸ä¸Šä¸€æ¬¡ commit ä¿æŒä¸€è‡´$ git reset --hard# é‡ç½®å½“å‰åˆ†æ”¯çš„æŒ‡é’ˆä¸ºæŒ‡å®š commitï¼ŒåŒæ—¶é‡ç½®æš‚å­˜åŒºï¼Œä½†å·¥ä½œåŒºä¸å˜$ git reset [commit]# é‡ç½®å½“å‰åˆ†æ”¯çš„ HEAD ä¸ºæŒ‡å®š commitï¼ŒåŒæ—¶é‡ç½®æš‚å­˜åŒºå’Œå·¥ä½œåŒºï¼Œä¸æŒ‡å®š commit ä¸€è‡´$ git reset --hard [commit] =&gt; å›é€€åˆ°æŸä¸ªç‰ˆæœ¬$ git reset --hard HEAD~1 =&gt; å›é€€åˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬# é‡ç½®å½“å‰ HEAD ä¸ºæŒ‡å®š commitï¼Œä½†ä¿æŒæš‚å­˜åŒºå’Œå·¥ä½œåŒºä¸å˜$ git reset --keep [commit]# æ–°å»ºä¸€ä¸ª commitï¼Œç”¨æ¥æ’¤é”€æŒ‡å®š commit# åè€…çš„æ‰€æœ‰å˜åŒ–éƒ½å°†è¢«å‰è€…æŠµæ¶ˆï¼Œå¹¶ä¸”åº”ç”¨åˆ°å½“å‰åˆ†æ”¯# é€‚ç”¨åœºæ™¯ï¼š å¦‚æœæˆ‘ä»¬æƒ³æ’¤é”€ä¹‹å‰çš„æŸä¸€ç‰ˆæœ¬ï¼Œä½†æ˜¯åˆæƒ³ä¿ç•™è¯¥ç›®æ ‡ç‰ˆæœ¬åé¢çš„ç‰ˆæœ¬ï¼Œè®°å½•ä¸‹è¿™æ•´ä¸ªç‰ˆæœ¬å˜åŠ¨æµç¨‹ï¼Œå°±å¯ä»¥ç”¨è¿™ç§æ–¹æ³•ã€‚$ git revert [commit]</code></pre><p>Reset å’Œ Revert çš„å¯¹æ¯”ï¼š<a href="https://blog.csdn.net/yxlshk/article/details/79944535">https://blog.csdn.net/yxlshk/article/details/79944535</a></p><h3 id="Stash"><a href="#Stash" class="headerlink" title="Stash"></a>Stash</h3><p>stash å¯ç”¨äºä¸´æ—¶è§£å†³ bug æ—¶ï¼Œå°†çœ¼å‰çš„å·¥ä½œéšè—ï¼›éšååˆ‡æ¢åˆ°è§£å†³ bug çš„åˆ†æ”¯ï¼Œå®Œæˆ bugï¼Œæäº¤ï¼Œåˆå¹¶ï¼›<br>å›åˆ°åŸå…ˆå·¥ä½œçš„åˆ†æ”¯ï¼ŒæŸ¥çœ‹éšè—ï¼Œæ¢å¤ï¼›over!</p><pre><code class="zsh"># æš‚æ—¶å°†æœªæäº¤çš„å˜åŒ–ç§»é™¤(éšè—å·¥ä½œç°åœº)$ git stash# å°†ç§»é™¤çš„ç§»å…¥(æ¢å¤å·¥ä½œç°åœº)ï¼ŒåŒæ—¶ä¹‹å‰ stash çš„å†…å®¹ä¹Ÿå³åˆ é™¤äº†(ä¸æƒ³åˆ é™¤ï¼Œè¯·ç”¨ apply å‘½ä»¤)$ git stash pop# æŸ¥çœ‹æ‰€æœ‰éšè—çš„å·¥ä½œç°åœº$ git stash list# æ¢å¤ XXï¼ŒåŒæ—¶æŠŠ stash å†…å®¹åˆ é™¤$ git stash pop XX# æ¢å¤ xx ä½† stash å†…å®¹ä¸åˆ é™¤$ git stash apply XX# åˆ é™¤ XX$ git stash drop XX</code></pre><h2 id="åã€å…¶ä»–"><a href="#åã€å…¶ä»–" class="headerlink" title="åã€å…¶ä»–"></a>åã€å…¶ä»–</h2><pre><code class="zsh"># ç”Ÿæˆä¸€ä¸ªå¯ä¾›å‘å¸ƒçš„å‹ç¼©åŒ…$ git archive# åœæ­¢è¿½è¸ªæŸæ–‡ä»¶ï¼Œå¹¶ä¿ç•™åœ¨æœ¬åœ°$ git rm --cached XXXX# åœæ­¢è¿½è¸ªæŸæ–‡ä»¶ï¼Œå¹¶åˆ é™¤æœ¬åœ°æ–‡ä»¶$ git rm --f XXXX</code></pre>]]></content>
      
      
      <categories>
          
          <category> Git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Git </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
